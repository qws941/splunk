<dashboard version="1.1">
  <label>Threat Intelligence Dashboard</label>
  <description>Advanced threat detection and intelligence monitoring</description>

  <!-- Row 1: Threat Summary -->
  <row>
    <panel>
      <title>Malware Detections (24h)</title>
      <single>
        <search>
          <query>index=fortigate_security virus_name=* earliest=-24h | stats count</query>
          <refresh>1m</refresh>
        </search>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="underLabel">Detections</option>
      </single>
    </panel>

    <panel>
      <title>Botnet Communications</title>
      <single>
        <search>
          <query>index=fortigate_security category=botnet earliest=-24h | stats count</query>
          <refresh>1m</refresh>
        </search>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="underLabel">C&amp;C Attempts</option>
      </single>
    </panel>

    <panel>
      <title>Malicious DNS Queries</title>
      <single>
        <search>
          <query>index=fortigate_security threat_category=malicious earliest=-24h | stats count</query>
          <refresh>1m</refresh>
        </search>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="underLabel">Queries</option>
      </single>
    </panel>

    <panel>
      <title>WebFilter Blocks</title>
      <single>
        <search>
          <query>index=fortigate_security service=webfilter action=blocked earliest=-24h | stats count</query>
          <refresh>1m</refresh>
        </search>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="underLabel">Blocked</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: Malware Analysis -->
  <row>
    <panel>
      <title>Top Malware Families</title>
      <chart>
        <search>
          <query>index=fortigate_security virus_name=* earliest=-24h
| stats count as detections, dc(src_ip) as infected_hosts by virus_name
| sort -detections
| head 10</query>
          <refresh>2m</refresh>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">Malware Family</option>
        <option name="charting.axisTitleY.text">Detections</option>
      </chart>
    </panel>

    <panel>
      <title>Infected Hosts</title>
      <table>
        <search>
          <query>index=fortigate_security virus_name=* earliest=-24h
| stats count as infections, values(virus_name) as malware by src_ip
| sort -infections
| head 15
| rename src_ip as "Host IP", infections as "Infection Count", malware as "Malware Types"</query>
          <refresh>2m</refresh>
        </search>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>

  <!-- Row 3: Botnet Activity -->
  <row>
    <panel>
      <title>Botnet Command &amp; Control Servers</title>
      <table>
        <search>
          <query>index=fortigate_security category=botnet earliest=-24h
| stats count as connections, dc(src_ip) as bots by dst_ip, botnet_name
| sort -connections
| head 15
| rename dst_ip as "C&amp;C Server", connections as "Connection Attempts", bots as "Bot Count", botnet_name as "Botnet Name"</query>
          <refresh>2m</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>

    <panel>
      <title>Botnet Timeline</title>
      <chart>
        <search>
          <query>index=fortigate_security category=botnet earliest=-24h
| timechart span=1h count by botnet_name</query>
          <refresh>2m</refresh>
        </search>
        <option name="charting.chart">line</option>
      </chart>
    </panel>
  </row>

  <!-- Row 4: Web Threats -->
  <row>
    <panel>
      <title>Blocked Websites by Category</title>
      <chart>
        <search>
          <query>index=fortigate_security service=webfilter action=blocked earliest=-24h
| stats count by category
| sort -count
| head 15</query>
          <refresh>2m</refresh>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <title>Top Blocked URLs</title>
      <table>
        <search>
          <query>index=fortigate_security service=webfilter action=blocked earliest=-24h
| stats count as blocks, dc(src_ip) as users by url, category
| sort -blocks
| head 15
| rename url as "URL", blocks as "Blocks", users as "Unique Users", category as "Category"</query>
          <refresh>2m</refresh>
        </search>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>
</dashboard>