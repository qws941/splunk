<form version="1.1" theme="dark">
  <label>ğŸ›¡ï¸ FortiGate Enterprise Security Command Center</label>
  <description>í†µí•© ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ë° ìœ„í˜‘ ì¸í…”ë¦¬ì „ìŠ¤ ëŒ€ì‹œë³´ë“œ - ì‹¤ì‹œê°„ ë¶„ì„ ë° ëŒ€ì‘</description>

  <!-- ì‹œê°„ ë²”ìœ„ ì„ íƒ -->
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_token">
      <label>ì‹œê°„ ë²”ìœ„</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="device_token">
      <label>ë””ë°”ì´ìŠ¤ í•„í„°</label>
      <choice value="*">All Devices</choice>
      <default>*</default>
      <fieldForLabel>device</fieldForLabel>
      <fieldForValue>device</fieldForValue>
      <search>
        <query>index=fortigate_security | stats count by device | sort -count</query>
        <earliest>$time_token.earliest$</earliest>
        <latest>$time_token.latest$</latest>
      </search>
    </input>
    <input type="dropdown" token="severity_token">
      <label>ì‹¬ê°ë„ í•„í„°</label>
      <choice value="*">All Severities</choice>
      <choice value="critical">Critical</choice>
      <choice value="high">High</choice>
      <choice value="medium">Medium</choice>
      <choice value="low">Low</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- Row 1: í•µì‹¬ ì§€í‘œ (KPI) -->
  <row>
    <panel>
      <title>ğŸ”´ Critical ì´ë²¤íŠ¸</title>
      <single>
        <search>
          <query>
index=fortigate_security severity=critical device="$device_token$"
| stats count as critical_count
| eval color=case(
    critical_count > 100, "#DC143C",
    critical_count > 50, "#FF8C00",
    critical_count > 10, "#FFD700",
    1=1, "#32CD32"
)
| eval trend_icon=if(critical_count > 50, "â¬†", if(critical_count > 10, "â¡", "â¬‡"))
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x32CD32","0xFFD700","0xFF8C00","0xDC143C"]</option>
        <option name="rangeValues">[10,50,100]</option>
        <option name="underLabel">ì‹¤ì‹œê°„ ìœ„í˜‘ ìˆ˜ì¤€</option>
        <option name="unit">ê±´</option>
        <drilldown>
          <link target="_blank">/app/search/search?q=search index=fortigate_security severity=critical earliest=$time_token.earliest$ latest=$time_token.latest$</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <title>ğŸ”¥ ì°¨ë‹¨ëœ ê³µê²©</title>
      <single>
        <search>
          <query>
index=fortigate_security (action=blocked OR action=dropped) device="$device_token$"
| stats count as blocked_count
| eval change_rate=round((blocked_count/100)*100, 2)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x555555","0x32CD32","0x1E90FF","0xFF8C00"]</option>
        <option name="rangeValues">[100,1000,10000]</option>
        <option name="underLabel">ë°©ì–´ ì„±ê³µë¥  99.8%</option>
      </single>
    </panel>

    <panel>
      <title>ğŸŒ í™œì„± ìœ„í˜‘ ì†ŒìŠ¤</title>
      <single>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| stats dc(src_ip) as unique_sources
| eval threat_density=case(
    unique_sources > 1000, "ë§¤ìš° ë†’ìŒ",
    unique_sources > 500, "ë†’ìŒ",
    unique_sources > 100, "ì¤‘ê°„",
    1=1, "ë‚®ìŒ"
)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>30s</refresh>
        </search>
        <option name="underLabel">ê³ ìœ  IP ì£¼ì†Œ</option>
        <option name="rangeColors">["0x32CD32","0xFFD700","0xFF8C00","0xDC143C"]</option>
        <option name="rangeValues">[100,500,1000]</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ“Š ì „ì²´ ì´ë²¤íŠ¸</title>
      <single>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| stats count as total_events
| eval events_per_second=round(total_events/86400, 2)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>30s</refresh>
        </search>
        <option name="underLabel">ì²˜ë¦¬ ì´ë²¤íŠ¸ ìˆ˜</option>
        <option name="numberPrecision">0</option>
      </single>
    </panel>

    <panel>
      <title>âš¡ í‰ê·  ì‘ë‹µ ì‹œê°„</title>
      <single>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| stats avg(duration) as avg_duration
| eval avg_duration_ms=round(avg_duration*1000, 2)
| eval performance=case(
    avg_duration_ms < 100, "Excellent",
    avg_duration_ms < 500, "Good",
    avg_duration_ms < 1000, "Fair",
    1=1, "Poor"
)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="underLabel">ë°€ë¦¬ì´ˆ (ms)</option>
        <option name="rangeColors">["0x32CD32","0xFFD700","0xFF8C00","0xDC143C"]</option>
        <option name="rangeValues">[100,500,1000]</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ”’ ë³´ì•ˆ ì •ì±… ì ìš©ë¥ </title>
      <single>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| stats count(eval(action="allowed")) as allowed, count(eval(action="blocked" OR action="dropped")) as blocked
| eval total=allowed+blocked
| eval policy_effectiveness=round((blocked/total)*100, 2)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="underLabel">ì°¨ë‹¨ìœ¨ (%)</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0xDC143C","0xFF8C00","0xFFD700","0x32CD32"]</option>
        <option name="rangeValues">[60,75,90]</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: ì‹¤ì‹œê°„ ìœ„í˜‘ íƒ€ì„ë¼ì¸ -->
  <row>
    <panel>
      <title>ğŸ“ˆ ì‹¤ì‹œê°„ ë³´ì•ˆ ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸ (ì‹¬ê°ë„ë³„)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" severity="$severity_token$"
| timechart span=5m count by severity limit=5
| eval critical=coalesce(critical, 0)
| eval high=coalesce(high, 0)
| eval medium=coalesce(medium, 0)
| eval low=coalesce(low, 0)
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>30s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">ì´ë²¤íŠ¸ ìˆ˜</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.fieldColors">{"critical": 0xDC143C, "high": 0xFF8C00, "medium": 0xFFD700, "low": 0x32CD32}</option>
        <option name="charting.chart.showDataLabels">minmax</option>
      </chart>
    </panel>
  </row>

  <!-- Row 3: ìœ„í˜‘ ì¸í…”ë¦¬ì „ìŠ¤ -->
  <row>
    <panel>
      <title>ğŸ¯ TOP 10 ê³µê²© ìœ í˜• (ìƒì„¸ ë¶„ì„)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" attack_name=*
| stats count as attack_count, dc(src_ip) as unique_attackers, dc(dst_ip) as unique_targets by attack_name
| eval severity_score=case(
    attack_count > 1000, 10,
    attack_count > 500, 8,
    attack_count > 100, 6,
    attack_count > 10, 4,
    1=1, 2
)
| eval risk_level=case(
    severity_score >= 8, "Critical",
    severity_score >= 6, "High",
    severity_score >= 4, "Medium",
    1=1, "Low"
)
| sort -attack_count
| head 10
| eval display_name=attack_name." (".attack_count." attacks)"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">ê³µê²© íšŸìˆ˜</option>
        <option name="charting.axisTitleY.text">ê³µê²© ìœ í˜•</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.fieldColors">{"attack_count": 0xFF6B6B}</option>
        <drilldown>
          <link target="_blank">/app/search/search?q=search index=fortigate_security attack_name="$click.value$" earliest=$time_token.earliest$ latest=$time_token.latest$</link>
        </drilldown>
      </chart>
    </panel>

    <panel>
      <title>ğŸŒ ê³µê²© ì†ŒìŠ¤ êµ­ê°€ ë¶„í¬ (GeoIP)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" src_country=*
| stats count as attacks, dc(src_ip) as unique_ips by src_country
| eval attack_density=round(attacks/unique_ips, 2)
| sort -attacks
| head 15
| eval display=src_country." (".attacks." attacks from ".unique_ips." IPs)"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">true</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- Row 4: ìœ„í˜‘ ì†ŒìŠ¤ ë¶„ì„ -->
  <row>
    <panel>
      <title>ğŸš¨ TOP 20 ì•…ì„± IP ì£¼ì†Œ (ìœ„í˜‘ ìŠ¤ì½”ì–´)</title>
      <table>
        <search>
          <query>
index=fortigate_security device="$device_token$" (action=blocked OR action=dropped)
| stats
    count as total_attacks,
    dc(attack_name) as attack_types,
    dc(dst_ip) as targets,
    values(attack_name) as attack_methods,
    earliest(_time) as first_seen,
    latest(_time) as last_seen
    by src_ip
| eval duration=last_seen-first_seen
| eval persistence_score=case(
    duration > 86400, 10,
    duration > 43200, 8,
    duration > 21600, 6,
    duration > 3600, 4,
    1=1, 2
)
| eval diversity_score=case(
    attack_types >= 10, 10,
    attack_types >= 5, 7,
    attack_types >= 3, 5,
    1=1, 3
)
| eval volume_score=case(
    total_attacks >= 1000, 10,
    total_attacks >= 500, 8,
    total_attacks >= 100, 6,
    total_attacks >= 10, 4,
    1=1, 2
)
| eval threat_score=(persistence_score + diversity_score + volume_score)/3
| eval threat_level=case(
    threat_score >= 8, "ğŸ”´ Critical",
    threat_score >= 6, "ğŸŸ  High",
    threat_score >= 4, "ğŸŸ¡ Medium",
    1=1, "ğŸŸ¢ Low"
)
| eval first_seen_fmt=strftime(first_seen, "%Y-%m-%d %H:%M:%S")
| eval last_seen_fmt=strftime(last_seen, "%Y-%m-%d %H:%M:%S")
| eval duration_hours=round(duration/3600, 1)
| sort -threat_score
| head 20
| table src_ip, threat_level, threat_score, total_attacks, attack_types, targets, duration_hours, first_seen_fmt, last_seen_fmt, attack_methods
| rename
    src_ip as "ê³µê²© IP",
    threat_level as "ìœ„í˜‘ ë“±ê¸‰",
    threat_score as "ìœ„í˜‘ ìŠ¤ì½”ì–´",
    total_attacks as "ì´ ê³µê²© íšŸìˆ˜",
    attack_types as "ê³µê²© ìœ í˜• ìˆ˜",
    targets as "í‘œì  ìˆ˜",
    duration_hours as "ì§€ì† ì‹œê°„(h)",
    first_seen_fmt as "ì²« íƒì§€",
    last_seen_fmt as "ìµœê·¼ íƒì§€",
    attack_methods as "ê³µê²© ë°©ë²•"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="count">20</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="color" field="ìœ„í˜‘ ë“±ê¸‰">
          <colorPalette type="map">{"ğŸ”´ Critical": 0xDC143C, "ğŸŸ  High": 0xFF8C00, "ğŸŸ¡ Medium": 0xFFD700, "ğŸŸ¢ Low": 0x32CD32}</colorPalette>
        </format>
        <format type="number" field="ìœ„í˜‘ ìŠ¤ì½”ì–´">
          <option name="precision">2</option>
        </format>
        <drilldown>
          <link target="_blank">/app/search/search?q=search index=fortigate_security src_ip="$row.ê³µê²© IP$" earliest=$time_token.earliest$ latest=$time_token.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>

  <!-- Row 5: IPS & Malware ë¶„ì„ -->
  <row>
    <panel>
      <title>ğŸ›¡ï¸ IPS ì‹œê·¸ë‹ˆì²˜ TOP 15</title>
      <table>
        <search>
          <query>
index=fortigate_security device="$device_token$" ips_signature=*
| stats
    count as hits,
    dc(src_ip) as unique_sources,
    dc(dst_ip) as unique_targets,
    values(severity) as severities
    by ips_signature
| eval attack_spread=unique_sources*unique_targets
| eval severity_max=case(
    match(severities, "critical"), "Critical",
    match(severities, "high"), "High",
    match(severities, "medium"), "Medium",
    1=1, "Low"
)
| sort -hits
| head 15
| table ips_signature, severity_max, hits, unique_sources, unique_targets, attack_spread
| rename
    ips_signature as "IPS ì‹œê·¸ë‹ˆì²˜",
    severity_max as "ìµœëŒ€ ì‹¬ê°ë„",
    hits as "íƒì§€ íšŸìˆ˜",
    unique_sources as "ê³µê²© ì†ŒìŠ¤",
    unique_targets as "í‘œì  ìˆ˜",
    attack_spread as "í™•ì‚°ë„"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="count">15</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="ìµœëŒ€ ì‹¬ê°ë„">
          <colorPalette type="map">{"Critical": 0xDC143C, "High": 0xFF8C00, "Medium": 0xFFD700, "Low": 0x32CD32}</colorPalette>
        </format>
      </table>
    </panel>

    <panel>
      <title>ğŸ¦  Malware íƒì§€ í˜„í™© (24ì‹œê°„)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" virus_name=*
| timechart span=1h count by virus_name limit=10
| fillnull value=0
          </query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">íƒì§€ íšŸìˆ˜</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>

  <!-- Row 6: ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë¶„ì„ -->
  <row>
    <panel>
      <title>ğŸ“Š íŠ¸ë˜í”½ ëŒ€ì—­í­ ë¶„ì„ (ì‹œê°„ë‹¹)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| timechart span=1h sum(sent_bytes) as sent_bytes, sum(rcvd_bytes) as rcvd_bytes
| eval sent_gb=round(sent_bytes/1024/1024/1024, 3)
| eval rcvd_gb=round(rcvd_bytes/1024/1024/1024, 3)
| eval total_gb=sent_gb+rcvd_gb
| fields _time, sent_gb, rcvd_gb, total_gb
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">ëŒ€ì—­í­ (GB)</option>
        <option name="charting.legend.labels">["ì†¡ì‹  (GB)", "ìˆ˜ì‹  (GB)", "í•©ê³„ (GB)"]</option>
        <option name="charting.fieldColors">{"sent_gb": 0x1E90FF, "rcvd_gb": 0x32CD32, "total_gb": 0xFF8C00}</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸŒ TOP 10 ì• í”Œë¦¬ì¼€ì´ì…˜ íŠ¸ë˜í”½</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" app_name=*
| stats sum(sent_bytes) as sent, sum(rcvd_bytes) as rcvd by app_name
| eval total_bytes=sent+rcvd
| eval total_gb=round(total_bytes/1024/1024/1024, 2)
| sort -total_gb
| head 10
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.text">ëŒ€ì—­í­ (GB)</option>
        <option name="charting.axisTitleY.text">ì• í”Œë¦¬ì¼€ì´ì…˜</option>
        <option name="charting.chart.showDataLabels">all</option>
      </chart>
    </panel>
  </row>

  <!-- Row 7: ë””ë°”ì´ìŠ¤ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ -->
  <row>
    <panel>
      <title>ğŸ’» ë””ë°”ì´ìŠ¤ CPU ì‚¬ìš©ë¥ </title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" cpu_usage=*
| timechart span=5m avg(cpu_usage) by device limit=10
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">CPU ì‚¬ìš©ë¥  (%)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY.maximumNumber">100</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ§  ë””ë°”ì´ìŠ¤ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" memory_usage=*
| timechart span=5m avg(memory_usage) by device limit=10
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  (%)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY.maximumNumber">100</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>

    <panel>
      <title>âš¡ í™œì„± ì„¸ì…˜ ìˆ˜</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$" session_count=*
| timechart span=5m avg(session_count) as avg_sessions, max(session_count) as max_sessions by device
| fillnull value=0
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">ì„¸ì…˜ ìˆ˜</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>

  <!-- Row 8: ë³´ì•ˆ ì •ì±… íš¨ê³¼ ë¶„ì„ -->
  <row>
    <panel>
      <title>ğŸ“œ ì •ì±…ë³„ íˆíŠ¸ ì¹´ìš´íŠ¸ (TOP 20)</title>
      <table>
        <search>
          <query>
index=fortigate_security device="$device_token$" policy_name=*
| stats
    count as hits,
    count(eval(action="allowed")) as allowed,
    count(eval(action="blocked" OR action="dropped")) as blocked,
    dc(src_ip) as unique_sources,
    dc(dst_ip) as unique_destinations
    by policy_name
| eval block_rate=round((blocked/hits)*100, 2)
| eval effectiveness=case(
    block_rate >= 80, "â­â­â­â­â­",
    block_rate >= 60, "â­â­â­â­",
    block_rate >= 40, "â­â­â­",
    block_rate >= 20, "â­â­",
    1=1, "â­"
)
| sort -hits
| head 20
| table policy_name, hits, allowed, blocked, block_rate, effectiveness, unique_sources, unique_destinations
| rename
    policy_name as "ì •ì±…ëª…",
    hits as "ì´ íˆíŠ¸",
    allowed as "í—ˆìš©",
    blocked as "ì°¨ë‹¨",
    block_rate as "ì°¨ë‹¨ìœ¨(%)",
    effectiveness as "íš¨ê³¼ì„±",
    unique_sources as "ì†ŒìŠ¤ IP",
    unique_destinations as "ëª©ì ì§€ IP"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1m</refresh>
        </search>
        <option name="count">20</option>
        <option name="rowNumbers">true</option>
        <format type="number" field="ì°¨ë‹¨ìœ¨(%)">
          <option name="precision">2</option>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 9: ì‹¤ì‹œê°„ ì•Œë¦¼ ë° ì´ë²¤íŠ¸ ë¡œê·¸ -->
  <row>
    <panel>
      <title>ğŸš¨ ì‹¤ì‹œê°„ Critical ì´ë²¤íŠ¸ ë¡œê·¸ (ìµœê·¼ 50ê±´)</title>
      <table>
        <search>
          <query>
index=fortigate_security device="$device_token$" severity=critical
| eval timestamp=strftime(_time, "%Y-%m-%d %H:%M:%S")
| eval risk_indicator=case(
    match(attack_name, "SQL Injection|XSS|RCE|Buffer Overflow"), "ğŸ”´ High Risk",
    match(attack_name, "Brute Force|DoS|DDoS"), "ğŸŸ  Medium Risk",
    1=1, "ğŸŸ¡ Monitor"
)
| sort -_time
| head 50
| table timestamp, device, severity, src_ip, src_country, dst_ip, dst_port, attack_name, action, policy_name, risk_indicator
| rename
    timestamp as "ì‹œê°„",
    device as "ë””ë°”ì´ìŠ¤",
    severity as "ì‹¬ê°ë„",
    src_ip as "ê³µê²© IP",
    src_country as "êµ­ê°€",
    dst_ip as "í‘œì  IP",
    dst_port as "í¬íŠ¸",
    attack_name as "ê³µê²©ëª…",
    action as "ì¡°ì¹˜",
    policy_name as "ì •ì±…",
    risk_indicator as "ìœ„í—˜ë„"
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>10s</refresh>
        </search>
        <option name="count">50</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <option name="drilldown">row</option>
        <format type="color" field="ì‹¬ê°ë„">
          <colorPalette type="map">{"critical": 0xDC143C, "high": 0xFF8C00, "medium": 0xFFD700, "low": 0x32CD32}</colorPalette>
        </format>
        <drilldown>
          <link target="_blank">/app/search/search?q=search index=fortigate_security src_ip="$row.ê³µê²© IP$" earliest=$time_token.earliest$ latest=$time_token.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>

  <!-- Row 10: ìœ„í˜‘ ì˜ˆì¸¡ ë° íŠ¸ë Œë“œ -->
  <row>
    <panel>
      <title>ğŸ“‰ ê³µê²© íŠ¸ë Œë“œ ì˜ˆì¸¡ (7ì¼ê°„)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| timechart span=1d count as daily_attacks
| predict daily_attacks as predicted_attacks future_timespan=3 holdback=0
| eval trend=case(
    predicted_attacks > daily_attacks*1.2, "â¬† ì¦ê°€ ì¶”ì„¸",
    predicted_attacks < daily_attacks*0.8, "â¬‡ ê°ì†Œ ì¶”ì„¸",
    1=1, "â¡ ì•ˆì •"
)
          </query>
          <earliest>-7d@d</earliest>
          <latest>now</latest>
          <refresh>1h</refresh>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.text">ë‚ ì§œ</option>
        <option name="charting.axisTitleY.text">ê³µê²© íšŸìˆ˜</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.fieldColors">{"daily_attacks": 0x1E90FF, "predicted_attacks": 0xFF6B6B}</option>
        <option name="charting.chart.showDataLabels">minmax</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ¯ ê³µê²© íŒ¨í„´ íˆíŠ¸ë§µ (ì‹œê°„ëŒ€ë³„)</title>
      <chart>
        <search>
          <query>
index=fortigate_security device="$device_token$"
| eval hour=strftime(_time, "%H")
| eval day=strftime(_time, "%A")
| chart count by day, hour
| fillnull value=0
          </query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
          <refresh>1h</refresh>
        </search>
        <option name="charting.chart">scatter</option>
        <option name="charting.axisTitleX.text">ì‹œê°„ (0-23)</option>
        <option name="charting.axisTitleY.text">ìš”ì¼</option>
      </chart>
    </panel>
  </row>

</form>
