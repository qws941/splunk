<dashboard version="1.1">
  <label>FortiGate Security Overview</label>
  <description>Real-time security monitoring dashboard for FortiGate infrastructure</description>

  <!-- Row 1: Key Metrics -->
  <row>
    <panel>
      <title>Total Security Events (Last Hour)</title>
      <single>
        <search>
          <query>index=fortigate_security earliest=-1h | stats count</query>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,1000,5000,10000]</option>
        <option name="underLabel">Events</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Critical Events</title>
      <single>
        <search>
          <query>index=fortigate_security severity=critical earliest=-1h | stats count</query>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,5,20,50]</option>
        <option name="underLabel">Critical</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">/app/search/search?q=search index=fortigate_security severity=critical earliest=-1h</link>
        </drilldown>
      </single>
    </panel>

    <panel>
      <title>Blocked Attacks</title>
      <single>
        <search>
          <query>index=fortigate_security action=blocked earliest=-1h | stats count</query>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,100,500,1000]</option>
        <option name="underLabel">Blocked</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Unique Threat Sources</title>
      <single>
        <search>
          <query>index=fortigate_security action=blocked earliest=-1h | stats dc(src_ip) as count</query>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,10,50,100]</option>
        <option name="underLabel">Sources</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: Timeline Visualizations -->
  <row>
    <panel>
      <title>Security Events Timeline (Last 4 Hours)</title>
      <chart>
        <search>
          <query>index=fortigate_security earliest=-4h
| timechart span=5m count by severity</query>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.axisTitleY.text">Event Count</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>

    <panel>
      <title>Attack Actions Distribution</title>
      <chart>
        <search>
          <query>index=fortigate_security earliest=-1h
| stats count by action
| sort -count</query>
          <refresh>1m</refresh>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>
  </row>

  <!-- Row 3: Top Threats -->
  <row>
    <panel>
      <title>Top Attack Sources (Last Hour)</title>
      <table>
        <search>
          <query>index=fortigate_security (action=blocked OR action=dropped) earliest=-1h
| stats count as attacks, dc(dst_ip) as targets, values(attack_name) as attack_types by src_ip
| eval threat_level=case(attacks > 100, "Critical", attacks > 50, "High", attacks > 10, "Medium", 1=1, "Low")
| sort -attacks
| head 10
| rename src_ip as "Source IP", attacks as "Attack Count", targets as "Unique Targets", attack_types as "Attack Types", threat_level as "Threat Level"</query>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Threat Level">
          <colorPalette type="map">{"Critical":#DC4E41,"High":#F1813F,"Medium":#F8BE34,"Low":#53A051}</colorPalette>
        </format>
      </table>
    </panel>

    <panel>
      <title>Top IPS Signatures</title>
      <table>
        <search>
          <query>index=fortigate_security attack_name=* earliest=-1h
| stats count as hits, dc(src_ip) as sources by attack_name, severity
| sort -hits
| head 10
| rename attack_name as "Signature", hits as "Hits", sources as "Unique Sources", severity as "Severity"</query>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

  <!-- Row 4: Device Status -->
  <row>
    <panel>
      <title>FortiGate Device Status</title>
      <table>
        <search>
          <query>index=fortimanager_direct sourcetype="fortimanager:device_status" earliest=-5m
| stats latest(conn_status) as connection, latest(conf_status) as config, latest(os_ver) as version by name, ip
| eval status=case(connection=1 AND config=1, "✓ Healthy", connection=1 AND config!=1, "⚠ Config Out of Sync", connection!=1, "✗ Disconnected")
| sort name
| rename name as "Device Name", ip as "IP Address", status as "Status", version as "OS Version"</query>
          <refresh>1m</refresh>
        </search>
        <option name="drilldown">none</option>
        <format type="color" field="Status">
          <colorPalette type="map">{"✓ Healthy":#53A051,"⚠ Config Out of Sync":#F8BE34,"✗ Disconnected":#DC4E41}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 5: Geographic Distribution -->
  <row>
    <panel>
      <title>Attack Sources by Country</title>
      <map>
        <search>
          <query>index=fortigate_security action=blocked earliest=-24h
| iplocation src_ip
| geostats latfield=lat longfield=lon count by Country</query>
          <refresh>5m</refresh>
        </search>
        <option name="mapping.type">marker</option>
        <option name="mapping.map.center">(0,0)</option>
        <option name="mapping.map.zoom">2</option>
      </map>
    </panel>
  </row>
</dashboard>