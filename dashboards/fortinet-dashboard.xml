<?xml version='1.0' encoding='utf-8'?>
<form version="1.1">
  <label>ğŸ›¡ï¸ FortiGate ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</label>
  <search id="base_fw_search">
    <query>
    index=fw devname=$device_filter$
| fields _time, devname, level, action, logid, msg, srcip, dstip, 
          srcport, dstport, protocol, app, user, bytes, 
          cpu, mem, session, srcintf, dstintf,
          cfgpath, cfgobj, cfgattr
      | eval severity_level = case(
          level="critical" OR level="emergency" OR level="alert", "critical",
          level="high" OR level="error" OR level="warning", "high",
          level="medium" OR level="notice", "medium",
          1=1, "low"
        )
      | eval event_category = case(
          action="deny" OR action="block" OR action="drop", "blocked",
          action="allow" OR action="accept", "allowed",
          1=1, "other"
        )
      | eval config_change_type = case(
          logid="0100044547", "Deleted",
          logid="0100044546", "Edited",
          logid="0100044545", "Added",
          1=1, null()
        )
  </query>
    <earliest>$time_picker.earliest$</earliest>
    <latest>$time_picker.latest$</latest>
  </search><description>Events | Traffic | Performance | Config | WCAG</description>

  
  <fieldset submitButton="false">
    <input type="dropdown" token="device_filter" searchWhenChanged="true">
      <label>ì¥ë¹„ ì„ íƒ</label>
      <choice value="*">ì „ì²´</choice>
      <default>*</default>
      <fieldForLabel>devname</fieldForLabel>
      <fieldForValue>devname</fieldForValue>
      <search>
        <query>index=fw | stats count by devname | sort - count</query>
      </search>
    </input>
    <input type="time" token="time_picker">
      <label>ì‹œê°„ ë²”ìœ„</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="severity_filter" searchWhenChanged="true">
      <label>ì‹¬ê°ë„ í•„í„°</label>
      <choice value="*">ì „ì²´</choice>
      <choice value="critical">Critical</choice>
      <choice value="high">High</choice>
      <choice value="medium">Medium</choice>
      <choice value="low">Low</choice>
      <default>*</default>
    </input>
  </fieldset>

  
  <row>
    <panel>
      <title>ğŸ”´ Critical Events</title>
      <single>
        <search base="base_fw_search">
          <query>
      search (level=critical OR level=alert OR level=emergency) | search NOT msg="*Update Fail*"
| stats count
    </query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,5,20]</option>
        <option name="underLabel">Critical Events</option>
      <drilldown><link target="_blank">/app/search/search?q=search index=fw (level=critical OR level=alert OR level=emergency) earliest=$time_picker.earliest$ latest=$time_picker.latest$ | table _time, devname, level, msg, srcip, dstip | sort - _time&amp;earliest=$time_picker.earliest$&amp;latest=$time_picker.latest$</link></drilldown></single>
    </panel>
    <panel>
      <title>ğŸ›¡ï¸ Blocked</title>
      <single>
        <search base="base_fw_search">
          <query>
      search (action=deny OR action=block OR action=drop) | stats count
    </query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x555555","0x65A637","0x6DB7C6","0xF7BC38"]</option>
        <option name="rangeValues">[100,1000,5000]</option>
        <option name="underLabel">Blocked Packets</option>
      <drilldown><link target="_blank">/app/search/search?q=search index=fw (action=deny OR action=block) earliest=$time_picker.earliest$ latest=$time_picker.latest$ | table _time, devname, action, srcip, dstip, msg | sort - _time&amp;earliest=$time_picker.earliest$&amp;latest=$time_picker.latest$</link></drilldown></single>
    </panel>
    <panel>
      <title>ğŸŒ Active Source IPs</title>
      <single>
        <search base="base_fw_search">
          <query>
      stats dc(srcip) as unique_sources
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[100,500,1000]</option>
        <option name="underLabel">Unique IPs</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ“ˆ Total Events</title>
      <single>
        <search base="base_fw_search">
          <query>
      stats count
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0x6DB7C6","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,1000,5000,10000]</option>
        <option name="underLabel">Total Events</option>
      </single>
    </panel>
    <panel>
      <title>âš™ï¸ Config Changes</title>
      <single>
        <search base="base_fw_search">
          <query>
      search (logid="0100044547" OR logid="0100044546" OR logid="0100044545") | stats count
    </query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,10,50]</option>
        <option name="underLabel">Config Changes</option>
      <drilldown><link target="_blank">/app/search/search?q=search index=fw (logid=0100044545 OR logid=0100044546 OR logid=0100044547) earliest=$time_picker.earliest$ latest=$time_picker.latest$ | table _time, devname, user, logid, cfgpath, cfgobj | sort - _time&amp;earliest=$time_picker.earliest$&amp;latest=$time_picker.latest$</link></drilldown></single>
    </panel>
  </row>

  
  <row>
    <panel>
      <html>
        <h2 style="color: #6DB7C6; border-bottom: 2px solid #6DB7C6; padding-bottom: 5px;">ğŸ”’ ì‹œìŠ¤í…œ ë¡œê·¸</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“Š Event Timeline</title>
      <chart>
        <search base="base_fw_search">
          <query>
      timechart span=1h count by severity_level
    </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Events</option>
        <option name="charting.fieldColors">{"Critical":"0xD93F3C","High":"0xF58F39","Medium":"0xF7BC38","Low":"0x65A637"}</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
    <panel>
      <title>ğŸ¯ Block Type Distribution</title>
      <chart>
        <search base="base_fw_search">
          <query>
      search (action=deny OR action=block) | eval block_category = case(
    match(type, "(?i)traffic"), "Traffic",
    match(type, "(?i)webfilter"), "Web Filter",
    match(type, "(?i)utm"), "UTM",
    1=1, "Other"
  )
| stats count by block_category
| sort - count
    </query>
        <autoRun>false</autoRun></search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.seriesColors">[0xD93F3C,0xF58F39,0xF7BC38,0x6DB7C6,0x65A637]</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸš¨ Top 10 Blocked Source IPs</title>
      <table>
        <search base="base_fw_search">
          <query>
      search (action=deny OR action=block) | stats count as blocked_count by srcip
| sort - blocked_count
| head 10
| eval rank = _serial
| table rank, srcip, blocked_count
| rename srcip as "Source IP", blocked_count as "Blocked Count", rank as "Rank"
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="count">10</option>
      <drilldown><link target="_blank">/app/search/search?q=search index=fw action=deny srcip=$click.value$ earliest=$time_picker.earliest$ latest=$time_picker.latest$ | table _time, srcip, dstip, protocol, app, msg | sort - _time&amp;earliest=$time_picker.earliest$&amp;latest=$time_picker.latest$</link></drilldown></table>
    </panel>
  </row>

  
  <row>
    <panel>
      <html>
        <h2 style="color: #6DB7C6; border-bottom: 2px solid #6DB7C6; padding-bottom: 5px;">ğŸ“¡ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë¡œê·¸</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“Š Bandwidth Usage Trend</title>
      <chart>
        <search base="base_fw_search">
          <query>
      eval bytes_total = coalesce(sentbyte, 0) + coalesce(rcvdbyte, 0)
| timechart span=1h sum(bytes_total) as total_bytes
| eval total_mb = round(total_bytes/1024/1024, 2)
| fields _time, total_mb
    </query>
        <autoRun>false</autoRun></search>
        <option name="charting.chart">area</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">MB</option>
        <option name="charting.seriesColors">[0x6DB7C6]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
    <panel>
      <title>ğŸŒ Protocol Distribution</title>
      <chart>
        <search base="base_fw_search">
          <query>
      eval protocol = coalesce(proto, service, "Other")
| stats count by protocol
| sort - count
| head 10
    </query>
        <autoRun>false</autoRun></search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">Packets</option>
        <option name="charting.seriesColors">[0x65A637]</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸš€ Top 10 Applications</title>
      <table>
        <search base="base_fw_search">
          <query>
      app=* | stats count as session_count, sum(sentbyte) as sent_bytes, sum(rcvdbyte) as rcvd_bytes by app
| eval total_mb = round((sent_bytes + rcvd_bytes)/1024/1024, 2)
| sort - session_count
| head 10
| table app, session_count, total_mb
| rename app as "ì• í”Œë¦¬ì¼€ì´ì…˜", session_count as "ì„¸ì…˜ ìˆ˜", total_mb as "íŠ¸ë˜í”½ (MB)"
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  
  <row>
    <panel>
      <html>
        <h2 style="color: #F7BC38; border-bottom: 2px solid #F7BC38; padding-bottom: 5px;">âš¡ ë””ë°”ì´ìŠ¤ ì„±ëŠ¥ ë°ì´í„°</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ’» Average CPU Usage</title>
      <single>
        <search base="base_fw_search">
          <query>
      cpu=* | stats avg(cpu) as avg_cpu
| eval avg_cpu = round(avg_cpu, 1)
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,60,80]</option>
        <option name="underLabel">CPU Usage</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ§  Average Memory Usage</title>
      <single>
        <search base="base_fw_search">
          <query>
      mem=* | stats avg(mem) as avg_mem
| eval avg_mem = round(avg_mem, 1)
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,70,85]</option>
        <option name="underLabel">Memory Usage</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ”Œ Active Sessions</title>
      <single>
        <search base="base_fw_search">
          <query>
      session=* | stats avg(session) as avg_sessions
| eval avg_sessions = round(avg_sessions, 0)
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x6DB7C6","0x65A637","0xF7BC38"]</option>
        <option name="rangeValues">[0,5000]</option>
        <option name="underLabel">Active Sessions</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ“¶ Device Status</title>
      <single>
        <search base="base_fw_search">
          <query>
      stats dc(devname) as device_count
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x6DB7C6","0x65A637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">Active Devices</option>
      </single>
    </panel>
  </row>

  
  <row>
    <panel>
      <html>
        <h2 style="color: #D93F3C; border-bottom: 2px solid #D93F3C; padding-bottom: 5px;">ğŸ”§ ì„¤ì • ë¡œê·¸</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“¢ Config Change History</title>
      <table id="config_changes_table">
        <search base="base_fw_search">
          <query>
      search (logid="0100044547" OR logid="0100044546" OR logid="0100044545") | rex field=_raw "cfgpath=\"?(?&lt;cfg_path&gt;[^\"]+)\"?"
| rex field=_raw "cfgobj=\"?(?&lt;cfg_object&gt;[^\"]+)\"?"
| rex field=_raw "cfgattr=\"?(?&lt;cfg_attr&gt;[^\"]+)\"?"
| eval config_path = coalesce(cfgpath, cfg_path, "N/A")
| eval config_object = coalesce(cfgobj, cfg_object, "N/A")
| eval config_attr = coalesce(cfgattr, cfg_attr, "N/A")
| eval parsed_value = config_path + " / " + config_object + " [" + config_attr + "]"
| eval change_type = case(
    logid="0100044547", "Deleted",
    logid="0100044546", "Edited",
    logid="0100044545", "Added",
    1=1, "Other"
  )
| eval path_category = case(
    match(config_path, "firewall\.policy"), "Firewall Policy",
    match(config_path, "vpn\.ipsec"), "IPSec VPN",
    match(config_path, "vpn\.ssl"), "SSL VPN",
    match(config_path, "system\.interface"), "Interface",
    match(config_path, "router"), "Routing",
    match(config_path, "user"), "User/Group",
    match(config_path, "firewall\.address"), "Address Object",
    match(config_path, "firewall\.service"), "Service Object",
    1=1, "Other"
  )
| eval access_method = coalesce(ui, "CLI")
| eval access_ip = coalesce(from_ip, remip, "N/A")
| dedup _time devname config_path config_object parsed_value
| eval timestamp = strftime(_time, "%Y-%m-%d %H:%M:%S")
| table timestamp, devname, user, change_type, path_category, config_object, parsed_value, access_method, access_ip
| sort - timestamp
| head 20
    </query>
        <autoRun>false</autoRun></search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  
  <row>
    <panel>
      <html>
        <h2 style="color: #65A637; border-bottom: 2px solid #65A637; padding-bottom: 5px;">ğŸ“¢ Slack ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h2>
      </html>
    </panel>
  </row>

  
  <row>
    <panel>
      <title>ğŸ”´ Critical Event Alert</title>
      <table>
        <search>
          <query>index=fw (level=critical OR level=alert) earliest=$time_picker.earliest$ latest=$time_picker.latest$
| search NOT msg="*Update Fail*" NOT msg="*Login Fail*"
| head 1
| eval emoji=case(
    level="critical" OR level="emergency", "ğŸ”´",
    level="alert", "ğŸŸ ",
    1=1, "âš ï¸"
  )
| eval slack_message=emoji + " *CRITICAL EVENT ALERT*\n" +
    "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
    "*Device:* `" + devname + "`\n" +
    "*Severity:* " + upper(level) + "\n" +
    "*Time:* " + strftime(_time, "%Y-%m-%d %H:%M:%S") + "\n\n" +
    "*Error Message:*\n```" + msg + "```"
| sendalert slack param.message=slack_message
| table devname, level, msg</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>âš™ï¸ Config Change Alert</title>
      <table>
        <search>
          <query>index=fw (logid="0100044547" OR logid="0100044546" OR logid="0100044545") earliest=$time_picker.earliest$ latest=$time_picker.latest$
| head 1
| rex field=_raw "cfgpath=\"?(?&lt;cfg_path&gt;[^\"]+)\"?"
| eval change_type=case(
    logid="0100044545", "âœ… Added",
    logid="0100044546", "âœï¸ Edited",
    logid="0100044547", "ğŸ—‘ï¸ Deleted",
    1=1, "ğŸ“ Modified"
  )
| eval category=case(
    match(cfg_path, "firewall\.policy"), "ğŸ›¡ï¸ Firewall Policy",
    match(cfg_path, "system"), "âš™ï¸ System",
    match(cfg_path, "user"), "ğŸ‘¤ User/Group",
    1=1, "ğŸ“‚ Other"
  )
| eval slack_message="âš™ï¸ *CONFIGURATION CHANGE*\n" +
    "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
    "*Device:* `" + devname + "`\n" +
    "*User:* *" + user + "*\n" +
    "*Category:* " + category + "\n" +
    "*Action:* " + change_type + "\n\n" +
    "*Config Path:*\n```" + cfg_path + "```\n\n" +
    "*Time:* " + strftime(_time, "%Y-%m-%d %H:%M:%S")
| sendalert slack param.message=slack_message
| table devname, user, cfg_path</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>


</form>