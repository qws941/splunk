<form version="1.1">
  <label>ğŸ›¡ï¸ FortiGate ë³´ì•ˆ ëŒ€ì‹œë³´ë“œ</label>
  <description>Security | Threat | Traffic | Performance | Config + Slack | WCAG</description>

  <!-- Global Filters -->
  <fieldset submitButton="false">
    <input type="dropdown" token="device_filter" searchWhenChanged="true">
      <label>ì¥ë¹„ ì„ íƒ</label>
      <choice value="*">ì „ì²´</choice>
      <default>*</default>
      <fieldForLabel>devname</fieldForLabel>
      <fieldForValue>devname</fieldForValue>
      <search>
        <query>index=fw | stats count by devname | sort - count</query>
      </search>
    </input>
    <input type="time" token="time_picker">
      <label>ì‹œê°„ ë²”ìœ„</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="severity_filter" searchWhenChanged="true">
      <label>ì‹¬ê°ë„ í•„í„°</label>
      <choice value="*">ì „ì²´</choice>
      <choice value="critical">Critical</choice>
      <choice value="high">High</choice>
      <choice value="medium">Medium</choice>
      <choice value="low">Low</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- Row 1: ğŸ“Š í•µì‹¬ KPI ì§€í‘œ -->
  <row>
    <panel>
      <title>ğŸ”´ Critical ì´ë²¤íŠ¸</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ (level=critical OR level=alert OR level=emergency) earliest=$time_picker.earliest$ latest=$time_picker.latest$
| search NOT msg="*Update Fail*"
| stats count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,5,20]</option>
        <option name="underLabel">Critical Events</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ›¡ï¸ ì°¨ë‹¨ëœ ê³µê²©</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ (action=deny OR action=block OR action=drop) earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x555555","0x65A637","0x6DB7C6","0xF7BC38"]</option>
        <option name="rangeValues">[100,1000,5000]</option>
        <option name="underLabel">Blocked Attacks</option>
      </single>
    </panel>
    <panel>
      <title>ğŸŒ í™œì„± ì†ŒìŠ¤ IP</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats dc(srcip) as unique_sources</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[100,500,1000]</option>
        <option name="underLabel">Unique IPs</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ“ˆ ì „ì²´ ì´ë²¤íŠ¸</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0x6DB7C6","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,1000,5000,10000]</option>
        <option name="underLabel">Total Events</option>
      </single>
    </panel>
    <panel>
      <title>âš™ï¸ ì„¤ì • ë³€ê²½</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ (logid="0100044547" OR logid="0100044546" OR logid="0100044545") earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,10,50]</option>
        <option name="underLabel">Config Changes</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: ğŸ”’ ë³´ì•ˆ ì´ë²¤íŠ¸ ë¶„ì„ -->
  <row>
    <panel>
      <html>
        <h2 style="color: #6DB7C6; border-bottom: 2px solid #6DB7C6; padding-bottom: 5px;">ğŸ”’ ë³´ì•ˆ ì´ë²¤íŠ¸ ë¶„ì„</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“Š ë³´ì•ˆ ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸</title>
      <chart>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| eval severity_level = case(
    level="critical" OR level="alert" OR level="emergency", "Critical",
    level="warning" OR level="error", "High",
    level="notice" OR level="information", "Medium",
    1=1, "Low"
  )
| timechart span=1h count by severity_level</query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">ì´ë²¤íŠ¸ ìˆ˜</option>
        <option name="charting.fieldColors">{"Critical":"0xD93F3C","High":"0xF58F39","Medium":"0xF7BC38","Low":"0x65A637"}</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
    <panel>
      <title>ğŸ¯ ê³µê²© ìœ í˜• ë¶„í¬</title>
      <chart>
        <search>
          <query>index=fw devname=$device_filter$ (action=deny OR action=block) earliest=$time_picker.earliest$ latest=$time_picker.latest$
| eval attack_category = case(
    match(type, "(?i)(ips|intrusion)"), "IPS/ì¹¨ì…",
    match(type, "(?i)(virus|malware)"), "ë©€ì›¨ì–´",
    match(type, "(?i)webfilter"), "ì›¹í•„í„°",
    match(type, "(?i)app"), "ì• í”Œë¦¬ì¼€ì´ì…˜",
    1=1, "ê¸°íƒ€"
  )
| stats count by attack_category
| sort - count</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.seriesColors">[0xD93F3C,0xF58F39,0xF7BC38,0x6DB7C6,0x65A637]</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸš¨ Top 10 ê³µê²© ì†ŒìŠ¤ IP</title>
      <table>
        <search>
          <query>index=fw devname=$device_filter$ (action=deny OR action=block) earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as attack_count by srcip, srccountry
| sort - attack_count
| head 10
| eval ìˆœìœ„ = _serial
| table ìˆœìœ„, srcip, srccountry, attack_count
| rename srcip as "ì†ŒìŠ¤ IP", srccountry as "êµ­ê°€", attack_count as "ê³µê²© íšŸìˆ˜"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <!-- Row 4: ğŸ“¡ íŠ¸ë˜í”½ ë¶„ì„ -->
  <row>
    <panel>
      <html>
        <h2 style="color: #6DB7C6; border-bottom: 2px solid #6DB7C6; padding-bottom: 5px;">ğŸ“¡ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë¶„ì„</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“Š ëŒ€ì—­í­ ì‚¬ìš©ëŸ‰ ì¶”ì´</title>
      <chart>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| eval bytes_total = coalesce(sentbyte, 0) + coalesce(rcvdbyte, 0)
| timechart span=1h sum(bytes_total) as total_bytes
| eval total_mb = round(total_bytes/1024/1024, 2)
| fields _time, total_mb</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">ì‹œê°„</option>
        <option name="charting.axisTitleY.text">MB</option>
        <option name="charting.seriesColors">[0x6DB7C6]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
    <panel>
      <title>ğŸŒ í”„ë¡œí† ì½œ ë¶„í¬</title>
      <chart>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| eval protocol = coalesce(proto, service, "ê¸°íƒ€")
| stats count by protocol
| sort - count
| head 10</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">íŒ¨í‚· ìˆ˜</option>
        <option name="charting.seriesColors">[0x65A637]</option>
        <option name="drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸš€ Top 10 ì• í”Œë¦¬ì¼€ì´ì…˜</title>
      <table>
        <search>
          <query>index=fw devname=$device_filter$ app=* earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as session_count, sum(sentbyte) as sent_bytes, sum(rcvdbyte) as rcvd_bytes by app
| eval total_mb = round((sent_bytes + rcvd_bytes)/1024/1024, 2)
| sort - session_count
| head 10
| table app, session_count, total_mb
| rename app as "ì• í”Œë¦¬ì¼€ì´ì…˜", session_count as "ì„¸ì…˜ ìˆ˜", total_mb as "íŠ¸ë˜í”½ (MB)"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <!-- Row 5: âš¡ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ -->
  <row>
    <panel>
      <html>
        <h2 style="color: #F7BC38; border-bottom: 2px solid #F7BC38; padding-bottom: 5px;">âš¡ ë””ë°”ì´ìŠ¤ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ’» í‰ê·  CPU ì‚¬ìš©ë¥ </title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ cpu=* earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats avg(cpu) as avg_cpu
| eval avg_cpu = round(avg_cpu, 1)</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,60,80]</option>
        <option name="underLabel">CPU Usage</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ§  í‰ê·  ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ mem=* earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats avg(mem) as avg_mem
| eval avg_mem = round(avg_mem, 1)</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,70,85]</option>
        <option name="underLabel">Memory Usage</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ”Œ í™œì„± ì„¸ì…˜</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ session=* earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats avg(session) as avg_sessions
| eval avg_sessions = round(avg_sessions, 0)</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x6DB7C6","0x65A637","0xF7BC38"]</option>
        <option name="rangeValues">[0,5000]</option>
        <option name="underLabel">Active Sessions</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ“¶ ë””ë°”ì´ìŠ¤ ìƒíƒœ</title>
      <single>
        <search>
          <query>index=fw devname=$device_filter$ earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats dc(devname) as device_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x6DB7C6","0x65A637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">Active Devices</option>
      </single>
    </panel>
  </row>

  <!-- Row 6: ğŸ”§ ì„¤ì • ê´€ë¦¬ (Slack í†µí•©) -->
  <row>
    <panel>
      <html>
        <h2 style="color: #D93F3C; border-bottom: 2px solid #D93F3C; padding-bottom: 5px;">ğŸ”§ ì„¤ì • ê´€ë¦¬ ë° Slack ì•Œë¦¼</h2>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>ğŸ“¢ ì„¤ì • ë³€ê²½ ì´ë ¥ (í´ë¦­ â†’ Slack ì•Œë¦¼)</title>
      <table id="config_changes_table">
        <search>
          <query>index=fw devname=$device_filter$ (logid="0100044547" OR logid="0100044546" OR logid="0100044545") earliest=$time_picker.earliest$ latest=$time_picker.latest$
| rex field=_raw "cfgpath=\"?(?&lt;cfg_path&gt;[^\"]+)\"?"
| rex field=_raw "cfgobj=\"?(?&lt;cfg_object&gt;[^\"]+)\"?"
| rex field=_raw "cfgattr=\"?(?&lt;cfg_attr&gt;[^\"]+)\"?"
| eval config_path = coalesce(cfgpath, cfg_path, "N/A")
| eval config_object = coalesce(cfgobj, cfg_object, "N/A")
| eval config_attr = coalesce(cfgattr, cfg_attr, "N/A")
| eval parsed_value = config_path + " / " + config_object + " [" + config_attr + "]"
| eval change_type = case(
    logid="0100044547", "ì‚­ì œ",
    logid="0100044546", "ìˆ˜ì •",
    logid="0100044545", "ì¶”ê°€",
    1=1, "ê¸°íƒ€"
  )
| eval path_category = case(
    match(config_path, "firewall\.policy"), "ë°©í™”ë²½ ì •ì±…",
    match(config_path, "vpn\.ipsec"), "IPSec VPN",
    match(config_path, "vpn\.ssl"), "SSL VPN",
    match(config_path, "system\.interface"), "ì¸í„°í˜ì´ìŠ¤",
    match(config_path, "router"), "ë¼ìš°íŒ…",
    match(config_path, "user"), "ì‚¬ìš©ì/ê·¸ë£¹",
    match(config_path, "firewall\.address"), "ì£¼ì†Œ ê°ì²´",
    match(config_path, "firewall\.service"), "ì„œë¹„ìŠ¤ ê°ì²´",
    1=1, "ê¸°íƒ€ ì„¤ì •"
  )
| eval access_method = coalesce(ui, "CLI")
| eval access_ip = coalesce(from_ip, remip, "N/A")
| dedup _time devname config_path config_object parsed_value
| eval timestamp = strftime(_time, "%Y-%m-%d %H:%M:%S")
| table timestamp, devname, user, change_type, path_category, config_object, parsed_value, access_method, access_ip
| sort - timestamp
| head 20</query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
        <drilldown>
          <set token="slack_device">$row.devname$</set>
          <set token="slack_user">$row.user$</set>
          <set token="slack_change_type">$row.change_type$</set>
          <set token="slack_category">$row.path_category$</set>
          <set token="slack_object">$row.config_object$</set>
          <set token="slack_value">$row.parsed_value$</set>
          <set token="slack_method">$row.access_method$</set>
          <set token="slack_ip">$row.access_ip$</set>
          <set token="slack_time">$row.timestamp$</set>
          <set token="trigger_config_alert">1</set>
        </drilldown>
      </table>
    </panel>
  </row>

  <!-- Row 7: Slack ì„¤ì • ì…ë ¥ íŒ¨ë„ -->
  <row>
    <panel>
      <title>ğŸ”§ Slack Webhook ì„¤ì •</title>
      <input type="text" token="slack_webhook_url" searchWhenChanged="true">
        <label>Slack Webhook URL</label>
        <default>https://hooks.slack.com/services/YOUR/WEBHOOK/URL</default>
      </input>
      <input type="dropdown" token="slack_channel" searchWhenChanged="true">
        <label>ì•Œë¦¼ ì±„ë„</label>
        <choice value="#splunk-alerts">#splunk-alerts</choice>
        <choice value="#security">#security</choice>
        <choice value="#fortigate">#fortigate</choice>
        <choice value="#operations">#operations</choice>
        <default>#splunk-alerts</default>
      </input>
      <input type="dropdown" token="slack_severity" searchWhenChanged="true">
        <label>ì•Œë¦¼ ì‹¬ê°ë„ (ì´ ë ˆë²¨ ì´ìƒë§Œ ì•Œë¦¼)</label>
        <choice value="critical">Criticalë§Œ</choice>
        <choice value="high">High ì´ìƒ</choice>
        <choice value="medium">Medium ì´ìƒ</choice>
        <choice value="low">ëª¨ë“  ì´ë²¤íŠ¸</choice>
        <default>high</default>
      </input>
      <table id="slack_config_display">
        <title>ğŸ“Œ í˜„ì¬ ì„¤ì • ê°’ (ì´ ê°’ë“¤ì´ ì•Œë¦¼ì— ì‚¬ìš©ë©ë‹ˆë‹¤)</title>
        <search>
          <query>| makeresults
| eval webhook_url="$slack_webhook_url$", channel="$slack_channel$", min_severity="$slack_severity$"
| eval status=if(match(webhook_url, "^https://hooks\.slack\.com/services/"), "âœ… Valid URL", "âš ï¸ Invalid URL")
| table webhook_url, channel, min_severity, status
| rename webhook_url as "Webhook URL", channel as "ì±„ë„", min_severity as "ìµœì†Œ ì‹¬ê°ë„", status as "ìƒíƒœ"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
      </table>
      <html>
        <div style="padding: 15px; background-color: #fff3cd; border-left: 4px solid #F7BC38; margin: 10px 0;">
          <strong style="color: #856404;">âš ï¸ ì£¼ì˜ì‚¬í•­:</strong>
          <ul style="color: #856404; margin: 5px 0 0 20px;">
            <li>Webhook URLì€ ì„¸ì…˜ ê¸°ë°˜ ì €ì¥ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”)</li>
            <li>ì˜êµ¬ ì €ì¥í•˜ë ¤ë©´ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í•„ìš”: <code>export SLACK_WEBHOOK_URL="URL"</code></li>
            <li>í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤</li>
          </ul>
        </div>
        <div style="padding: 15px; background-color: #d1ecf1; border-left: 4px solid #6DB7C6; margin: 10px 0;">
          <strong style="color: #0c5460;">ğŸ’¡ í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong>
          <pre style="background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 4px; overflow-x: auto; margin-top: 10px;">
# í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸
export SLACK_WEBHOOK_URL="ìœ„ì— ì…ë ¥í•œ URL"
node /home/jclee/app/splunk/scripts/slack-alert-cli.js \
  --webhook="$SLACK_WEBHOOK_URL" \
  --message="ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸ ì•Œë¦¼" \
  --severity=high \
  --test</pre>
        </div>
      </html>
    </panel>

    <panel>
      <title>ğŸ“‹ Slack ì„¤ì • ê°€ì´ë“œ</title>
      <html>
        <div style="padding: 15px; background-color: #f8f9fa; border-left: 4px solid #65A637; margin: 10px 0;">
          <h3 style="color: #333; margin-top: 0;">ğŸ”§ Slack ì•Œë¦¼ ì„¤ì • ë°©ë²•</h3>

          <h4 style="color: #333; margin-top: 15px;">1ï¸âƒ£ Slack Webhook URL ìƒì„±</h4>
          <pre style="background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 4px; overflow-x: auto;">
1. https://api.slack.com/apps â†’ Create New App
2. Incoming Webhooks â†’ Activate
3. Add New Webhook â†’ ì±„ë„ ì„ íƒ (#splunk-alerts)
4. Webhook URL ë³µì‚¬ â†’ ì™¼ìª½ íŒ¨ë„ì— ì…ë ¥</pre>

          <h4 style="color: #333; margin-top: 15px;">2ï¸âƒ£ í”„ë¡ì‹œ ì„œë²„ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)</h4>
          <pre style="background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 4px; overflow-x: auto;">
cd /home/jclee/app/splunk

# .env íŒŒì¼ì— Webhook URL ì €ì¥
echo "SLACK_WEBHOOK_URL=YOUR_WEBHOOK_URL" >> .env

# PM2ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ì¬ì‹œì‘ ì‹œ ìë™ ì‹œì‘)
pm2 start index.js --name slack-proxy
pm2 save
pm2 startup</pre>

          <h4 style="color: #333; margin-top: 15px;">3ï¸âƒ£ CLIë¡œ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸</h4>
          <pre style="background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 4px; overflow-x: auto;">
# ì—°ê²° í…ŒìŠ¤íŠ¸
node scripts/slack-alert-cli.js --webhook="URL" --test

# ì»¤ìŠ¤í…€ ì•Œë¦¼ ì „ì†¡
node scripts/slack-alert-cli.js \
  --webhook="URL" \
  --message="ë°©í™”ë²½ ì •ì±… ë³€ê²½ ê°ì§€" \
  --severity=critical \
  --data='{"ì¥ë¹„":"FW-01","ê´€ë¦¬ì":"admin"}'</pre>

          <h4 style="color: #333; margin-top: 15px;">4ï¸âƒ£ ëŒ€ì‹œë³´ë“œì—ì„œ ì•Œë¦¼ íŠ¸ë¦¬ê±°</h4>
          <div style="padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; margin-top: 10px;">
            <strong style="color: #155724;">âœ… ì„¤ì • ì™„ë£Œ í›„:</strong>
            <p style="color: #155724; margin: 5px 0 0 0;">ìœ„ì˜ "ğŸ“¢ ì„¤ì • ë³€ê²½ ì´ë ¥" í…Œì´ë¸”ì—ì„œ í–‰ì„ í´ë¦­í•˜ë©´<br/>ì™¼ìª½ íŒ¨ë„ì— ì…ë ¥í•œ Webhook URLë¡œ ìë™ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Hidden Row: Slack Alert Trigger -->
  <row depends="$trigger_config_alert$">
    <panel>
      <title>ğŸ“© Slack ì•Œë¦¼ ìë™ ìƒì„±ë¨ (ì•„ë˜ curl ëª…ë ¹ì–´ ë³µì‚¬ â†’ í„°ë¯¸ë„ ì‹¤í–‰)</title>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; margin: 15px 0;">
          <h3 style="color: white; margin-top: 0; text-align: center;">âœ… Slack ì•Œë¦¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
          <p style="color: white; text-align: center; font-size: 14px; margin-bottom: 0;">
            ì•„ë˜ ëª…ë ¹ì–´ë¥¼ <strong>í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰</strong>í•˜ê±°ë‚˜, <strong>í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘</strong>ì´ë©´ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.
          </p>
        </div>
      </html>
    </panel>
  </row>

  <row depends="$trigger_config_alert$">
    <panel>
      <title>ğŸ’¬ ìƒì„±ëœ Slack ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°</title>
      <table id="slack_preview">
        <search>
          <query>| makeresults
| eval device="$slack_device$"
| eval user="$slack_user$"
| eval change_type="$slack_change_type$"
| eval category="$slack_category$"
| eval object_name="$slack_object$"
| eval value="$slack_value$"
| eval access_method="$slack_method$"
| eval access_ip="$slack_ip$"
| eval timestamp="$slack_time$"
| eval severity=if(change_type="ì‚­ì œ", "high", "medium")
| eval slack_message="*[ì„¤ì •ë³€ê²½]* " + category + "\n"
    + "â”â”â”â”â”â”â”â”â”\n"
    + "ğŸ–¥ï¸ ì¥ë¹„: `" + device + "`\n"
    + "ğŸ”„ ë³€ê²½ìœ í˜•: *" + change_type + "*\n"
    + "ğŸ“‹ ëŒ€ìƒ: `" + object_name + "`\n"
    + "ğŸ”— ê²½ë¡œ: `" + value + "`\n"
    + "ğŸ‘¤ ê´€ë¦¬ì: " + user + "\n"
    + "ğŸŒ ì ‘ì†IP: " + access_ip + "\n"
    + "ğŸ”Œ ì ‘ì†ë°©ë²•: " + access_method + "\n"
    + "ğŸ•’ ì‹œê°„: " + timestamp + "\n"
    + "âš ï¸ ì‹¬ê°ë„: *" + severity + "*"
| table device, category, change_type, severity, slack_message</query>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
      </table>
    </panel>

    <panel>
      <title>ğŸ“‹ í„°ë¯¸ë„ ì‹¤í–‰ ëª…ë ¹ì–´ (ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°)</title>
      <table id="curl_command">
        <search>
          <query>| makeresults
| eval webhook_url="$slack_webhook_url$"
| eval channel="$slack_channel$"
| eval device="$slack_device$"
| eval user="$slack_user$"
| eval change_type="$slack_change_type$"
| eval category="$slack_category$"
| eval object_name="$slack_object$"
| eval access_ip="$slack_ip$"
| eval timestamp="$slack_time$"
| eval severity=if(change_type="ì‚­ì œ", "high", "medium")
| eval emoji=case(
    severity="critical", "ğŸ”´",
    severity="high", "ğŸŸ ",
    severity="medium", "ğŸŸ¡",
    severity="low", "ğŸŸ¢",
    1=1, "âšª"
  )
| eval color=case(
    severity="critical", "#DC4E41",
    severity="high", "#F8BE34",
    severity="medium", "#87CEEB",
    severity="low", "#53A051",
    1=1, "#CCCCCC"
  )
| eval message_text="*[ì„¤ì •ë³€ê²½]* " + category + "\\n" +
    "â”â”â”â”â”â”â”â”â”\\n" +
    "ğŸ–¥ï¸ ì¥ë¹„: \\`" + device + "\\`\\n" +
    "ğŸ”„ ë³€ê²½ìœ í˜•: *" + change_type + "*\\n" +
    "ğŸ“‹ ëŒ€ìƒ: \\`" + object_name + "\\`\\n" +
    "ğŸ‘¤ ê´€ë¦¬ì: " + user + "\\n" +
    "ğŸŒ ì ‘ì†IP: " + access_ip + "\\n" +
    "ğŸ•’ ì‹œê°„: " + timestamp + "\\n" +
    "âš ï¸ ì‹¬ê°ë„: *" + severity + "*"
| eval json_payload="{\"text\":\"" + emoji + " *Fortinet Dashboard Alert*\",\"attachments\":[{\"color\":\"" + color + "\",\"text\":\"" + message_text + "\",\"footer\":\"Splunk Dashboard\",\"mrkdwn_in\":[\"text\"]}]}"
| eval curl_command="curl -X POST '" + webhook_url + "' -H 'Content-Type: application/json' -d '" + json_payload + "'"
| table curl_command
| rename curl_command as "ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ë³µì‚¬-ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <format type="color" field="ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ë³µì‚¬-ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”">
          <colorPalette type="list">[#53A051]</colorPalette>
        </format>
      </table>
      <html>
        <div style="padding: 15px; background: #d1ecf1; border-left: 4px solid #0c5460; margin: 10px 0;">
          <strong style="color: #0c5460;">ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong>
          <ol style="color: #0c5460; margin: 10px 0 0 20px;">
            <li>ìœ„ í‘œì—ì„œ curl ëª…ë ¹ì–´ <strong>ì „ì²´ë¥¼ ë³µì‚¬</strong></li>
            <li>í„°ë¯¸ë„ì„ ì—´ê³  <strong>ë¶™ì—¬ë„£ê¸° í›„ Enter</strong></li>
            <li>Slack ì±„ë„ì—ì„œ ì•Œë¦¼ í™•ì¸</li>
          </ol>
        </div>
        <div style="padding: 15px; background: #fff3cd; border-left: 4px solid #856404; margin: 10px 0;">
          <strong style="color: #856404;">ğŸ¤– ìë™ ì „ì†¡ (ì„ íƒì‚¬í•­):</strong>
          <p style="color: #856404; margin: 5px 0 0 0;">
            í”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ë©´ ìë™ìœ¼ë¡œ Slackì— ì „ì†¡ë©ë‹ˆë‹¤.<br/>
            í”„ë¡ì‹œ ì‹¤í–‰: <code>pm2 start /home/jclee/app/splunk/index.js --name slack-proxy</code>
          </p>
        </div>
      </html>
    </panel>
  </row>

  <row depends="$trigger_config_alert$">
    <panel>
      <html>
        <div style="text-align: center; padding: 20px;">
          <button style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          " onclick="
            var tokens = splunkjs.mvc.Components.getInstance('submitted');
            tokens.unset('trigger_config_alert');
            tokens.unset('slack_device');
            tokens.unset('slack_user');
            tokens.unset('slack_change_type');
            tokens.unset('slack_category');
            tokens.unset('slack_object');
            tokens.unset('slack_value');
            tokens.unset('slack_method');
            tokens.unset('slack_ip');
            tokens.unset('slack_time');
          ">âœ–ï¸ ë‹«ê¸°</button>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 8: ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ -->
  <row>
    <panel>
      <title>ğŸ“¡ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ (ìµœê·¼ 15ë¶„, 30ì´ˆ ìë™ ìƒˆë¡œê³ ì¹¨)</title>
      <event>
        <search>
          <query>index=fw devname=$device_filter$ earliest=-15m
| sort - _time
| head 100</query>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">15</option>
        <option name="list.drilldown">none</option>
        <option name="maxLines">3</option>
        <option name="raw.drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="type">list</option>
      </event>
    </panel>
  </row>
</form>
