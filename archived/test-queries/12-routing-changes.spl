```spl
# 12. Routing Changes (라우팅 변경)
# 목적: Static route, BGP, OSPF 라우팅 변경 추적
# 실행: Splunk 검색창에 붙여넣기

index=fortianalyzer earliest=-24h type=event subtype=system \
    (cfgpath="router.*" OR msg="*route*" OR msg="*bgp*" OR msg="*ospf*") \
| eval device = devname \
| eval admin = coalesce(user, "system") \
| eval routing_type = case(
    match(cfgpath, "router.static"), "Static Route",
    match(cfgpath, "router.bgp"), "BGP",
    match(cfgpath, "router.ospf"), "OSPF",
    match(cfgpath, "router.rip"), "RIP",
    match(cfgpath, "router.policy"), "Routing Policy",
    match(msg, "(?i)route.*add"), "Route Added",
    match(msg, "(?i)route.*delete"), "Route Deleted",
    match(msg, "(?i)route.*change"), "Route Changed",
    1=1, "Other Routing Event") \
| eval action_type = case(
    match(action, "(?i)add|create"), "Created",
    match(action, "(?i)edit|modify"), "Modified",
    match(action, "(?i)delete|remove"), "Deleted",
    1=1, coalesce(action, "Modified")) \
| eval config_path = cfgpath \
| eval changes = case(
    isnull(cfgattr), "No details",
    1=1, substr(cfgattr, 1, 200)) \
| rex field=changes "dst=(?<destination>[^\s]+)" \
| rex field=changes "gateway=(?<gateway>[^\s]+)" \
| rex field=changes "device=(?<interface>[^\s]+)" \
| eval destination = coalesce(destination, "N/A") \
| eval gateway = coalesce(gateway, "N/A") \
| eval interface = coalesce(interface, "N/A") \
| table _time, device, admin, routing_type, action_type, destination, gateway, interface, changes \
| sort -_time \
| head 50
```

**확인할 것**:
- Default route가 변경되었는가?
- Static route 추가/삭제가 있는가?
- BGP neighbor 설정이 변경되었는가?
- Routing policy가 수정되었는가?

**주요 Routing 변경**:
- Default route (0.0.0.0/0) changes
- Static route additions/deletions
- BGP AS number changes
- OSPF area configuration

**중요 Route 변경 탐지**:
```spl
index=fortianalyzer earliest=-24h (logid=0100044546 OR logid=0100044547) \
    cfgpath="router.*" \
| where match(cfgattr, "0\.0\.0\.0|default") \
| table _time, devname, user, action, cfgpath, cfgattr
```

**BGP Status 확인**:
```spl
index=fortianalyzer earliest=-24h type=event \
    (msg="*bgp*neighbor*" OR msg="*bgp*peer*") \
| eval device = devname \
| eval bgp_event = case(
    match(msg, "(?i)established"), "BGP Established",
    match(msg, "(?i)down"), "BGP Down",
    match(msg, "(?i)connect"), "BGP Connecting",
    1=1, "BGP Event") \
| table _time, device, bgp_event, msg \
| sort -_time
```

**Alert 조건 제안**:
- Default route changed (기본 경로 변경)
- BGP neighbor down (BGP 피어 다운)
- Critical static route deleted
- OSPF adjacency down
```
