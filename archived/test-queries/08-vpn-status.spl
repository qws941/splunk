```spl
# 8. VPN Status Monitoring (VPN 상태 모니터링)
# 목적: VPN 터널 up/down, IPsec/SSL VPN 연결 상태
# 실행: Splunk 검색창에 붙여넣기

index=fortianalyzer earliest=-24h type=event subtype=vpn \
| eval vpn_type = case(
    match(logid, "0101039"), "IPsec Phase1",
    match(logid, "0101040"), "IPsec Phase2",
    match(logid, "0101045"), "IPsec Tunnel",
    match(logid, "010210"), "SSL VPN",
    1=1, "Other VPN") \
| eval vpn_status = case(
    match(msg, "(?i)up"), "Up",
    match(msg, "(?i)down"), "Down",
    match(msg, "(?i)established"), "Established",
    match(msg, "(?i)disconnected"), "Disconnected",
    match(msg, "(?i)login"), "User Login",
    match(msg, "(?i)logout"), "User Logout",
    1=1, "Unknown") \
| eval device = devname \
| eval tunnel_name = coalesce(tunnelid, vpn_name, "N/A") \
| eval remote_ip = coalesce(remip, dst, "N/A") \
| eval user = coalesce(user, "N/A") \
| eval description = coalesce(msg, logdesc, "No details") \
| table _time, device, vpn_type, vpn_status, tunnel_name, remote_ip, user, description \
| sort -_time \
| head 50
```

**확인할 것**:
- VPN 터널이 자주 끊어지는가?
- SSL VPN 사용자 접속 패턴은?
- IPsec Phase1/Phase2 실패가 있는가?
- 어떤 remote IP에서 접속하는가?

**주요 VPN LogID**:
- 0101039424: IPsec Phase1 negotiation started
- 0101039425: IPsec Phase1 established
- 0101039426: IPsec Phase1 failed
- 0101040424: IPsec Phase2 negotiation started
- 0101040448: IPsec Phase2 established
- 0101045056: IPsec tunnel up
- 0101045057: IPsec tunnel down
- 0102104001: SSL VPN login success
- 0102104002: SSL VPN login failed
- 0102104003: SSL VPN logout

**Alert 조건 제안**:
- VPN tunnel down for critical sites
- SSL VPN login failed > 3 times (인증 실패)
- VPN Phase1/Phase2 negotiation failures
```
