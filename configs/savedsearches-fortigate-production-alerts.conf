[001.alert_FortiGate_Config_Change]
description = Real-time FortiGate configuration change alerts
disabled = 0
cron_schedule = * * * * *
dispatch.earliest_time = rt-1m
dispatch.latest_time = rt
enableSched = 1
realtime_schedule = 1
schedule_priority = highest
alert.track = 1
alert.digest_mode = 0
alert.suppress = 1
alert.suppress.fields = _time, device, user, cfgpath
alert.suppress.period = 5m
action.slack = 1
action.slack.param.channel = #security-firewall-alert
action.slack.param.attachment = {"color":"warning","blocks":[{"type":"header","text":{"type":"plain_text","text":"ðŸ”§ Config Change Alert"}},{"type":"section","fields":[{"type":"mrkdwn","text":"*Device:*\n$result.device$"},{"type":"mrkdwn","text":"*Admin:*\n$result.admin$"},{"type":"mrkdwn","text":"*Path:*\n$result.config_path$"},{"type":"mrkdwn","text":"*Method:*\n$result.access_method$"}]},{"type":"context","elements":[{"type":"mrkdwn","text":"Time: $result._time$"}]}]}
search = index=fw type=event subtype=system (logid=0100044546 OR logid=0100044547) | eval device = coalesce(devname, "unknown") | eval admin = coalesce(user, "system") | eval config_path = coalesce(cfgpath, "unknown") | eval access_method = case(logid=="0100044546", "CLI", logid=="0100044547", "GUI", 1=1, "Unknown") | table _time, device, admin, config_path, access_method

[002.alert_FortiGate_System_Critical]
description = System critical events
disabled = 1

[003.alert_FortiGate_Traffic_Anomaly]
description = Traffic anomaly detection
disabled = 1

[004.alert_FortiGate_VPN_Failure]
description = Real-time VPN connection failures
disabled = 0
cron_schedule = * * * * *
dispatch.earliest_time = rt-1m
dispatch.latest_time = rt
enableSched = 1
schedule_priority = high
alert.track = 1
alert.digest_mode = 0
alert.suppress = 1
alert.suppress.fields = user, remip
alert.suppress.period = 30m
action.slack = 1
action.slack.param.channel = #security-firewall-alert
action.slack.param.attachment = {"color":"danger","blocks":[{"type":"header","text":{"type":"plain_text","text":"ðŸ”’ VPN Failure Alert"}},{"type":"section","fields":[{"type":"mrkdwn","text":"*Device:*\n$result.device$"},{"type":"mrkdwn","text":"*User:*\n$result.vpn_user$"},{"type":"mrkdwn","text":"*Remote IP:*\n$result.remote_ip$"},{"type":"mrkdwn","text":"*Status:*\n$result.vpn_status$"}]},{"type":"section","text":{"type":"mrkdwn","text":"*Reason:* $result.vpn_reason$"}},{"type":"context","elements":[{"type":"mrkdwn","text":"Time: $result._time$"}]}]}
search = index=fw type=event subtype=vpn (logid=0101037131 OR logid=0101037124 OR logid=0101037134) | eval device = coalesce(devname, "unknown") | eval vpn_user = coalesce(user, "N/A") | eval remote_ip = coalesce(remip, "-") | eval vpn_status = case(logid=="0101037131", "Auth Failed", logid=="0101037124", "Tunnel Down", logid=="0101037134", "Disconnected", 1=1, "Error") | eval vpn_reason = coalesce(reason, msg, "No reason") | dedup device, vpn_user, remote_ip | table _time, device, vpn_user, remote_ip, vpn_status, vpn_reason

[005.alert_FortiAnalyzer_Device_Login_Failure]
description = FortiAnalyzer device login failures
disabled = 1

[006.alert_FortiGate_Security_Rating_Low]
description = Security rating summary
disabled = 1
cron_schedule = 0 9 * * *
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = 1
schedule_priority = low
alert.track = 0
action.summary_index = 1
action.summary_index._name = summary_fw
search = index=fw subtype=security-rating (logid=0110052000 OR logid=0110052001) | stats count

[007.alert_FortiGate_User_Activity]
description = User activity monitoring
disabled = 1

[008.alert_FortiAnalyzer_LogDev_Warning]
description = FortiAnalyzer log device warnings
disabled = 0
cron_schedule = * * * * *
dispatch.earliest_time = rt-1m
dispatch.latest_time = rt
enableSched = 1
schedule_priority = medium
alert.track = 1
alert.digest_mode = 0
alert.suppress = 1
alert.suppress.fields = logid
alert.suppress.period = 12h
action.slack = 1
action.slack.param.channel = #security-firewall-alert
action.slack.param.attachment = {"color":"#ff9900","blocks":[{"type":"header","text":{"type":"plain_text","text":"ðŸ“¡ FortiAnalyzer LogDev Warning"}},{"type":"section","fields":[{"type":"mrkdwn","text":"*Issue:*\n$result.issue_type$"},{"type":"mrkdwn","text":"*Level:*\n$result.severity_level$"}]},{"type":"section","text":{"type":"mrkdwn","text":"*Message:* $result.description$"}},{"type":"context","elements":[{"type":"mrkdwn","text":"Time: $result._time$ | LogID: $result.logid$"}]}]}
search = index=fw subtype=logdev devname=".self" logid=220001 level IN ("warning","error","critical") | eval issue_type = case(like(msg, "%offline%"), "Device Offline", like(msg, "%disk%"), "Disk Low", like(msg, "%connection%"), "Connection Error", 1=1, "Log Device Issue") | eval severity_level = upper(level) | eval description = coalesce(msg, "No details") | dedup logid, issue_type | table _time, logid, severity_level, issue_type, description

[009.alert_FortiGate_Event_Summary]
description = Hourly event summary
disabled = 0
cron_schedule = 0 * * * *
dispatch.earliest_time = -1h
dispatch.latest_time = now
enableSched = 1
schedule_priority = low
alert.track = 0
action.summary_index = 1
action.summary_index._name = summary_fw
search = index=fw | stats count

[010.alert_FortiGate_Metrics_Anomaly]
description = System metrics anomaly detection
disabled = 0
cron_schedule = * * * * *
dispatch.earliest_time = rt-1m
dispatch.latest_time = rt
enableSched = 1
realtime_schedule = 1
schedule_priority = high
alert.track = 1
alert.digest_mode = 0
alert.suppress = 1
alert.suppress.fields = devname
alert.suppress.period = 30m
action.slack = 1
action.slack.param.channel = #security-firewall-alert
action.slack.param.attachment = {"color":"danger","blocks":[{"type":"header","text":{"type":"plain_text","text":"ðŸ”¥ Metrics Anomaly Alert"}},{"type":"section","fields":[{"type":"mrkdwn","text":"*Device:*\n$result.device$"},{"type":"mrkdwn","text":"*Severity:*\n$result.severity$"}]},{"type":"section","text":{"type":"mrkdwn","text":"*Anomalies:* $result.anomaly_types$\n*Details:* $result.details$"}},{"type":"context","elements":[{"type":"mrkdwn","text":"Time: $result._time$"}]}]}
search = index=fw earliest=-1m latest=now | eval device = coalesce(devname, "unknown") | eval cpu_current = coalesce(cpu, 0) | eval mem_current = coalesce(mem, 0) | stats values(cpu_current) as cpu_current, values(mem_current) as mem_current by device | eval anomaly_types = "CPU/Memory" | eval severity = "HIGH" | eval details = "Check system load" | table device, anomaly_types, severity, details
