# Splunk Indexes for FortiManager (FMG) and FortiAnalyzer (FAZ)
# Deploy to: $SPLUNK_HOME/etc/apps/search/local/indexes.conf
#
# Architecture:
#   - index=fmg: Configuration changes, audit logs, device inventory
#   - index=faz: Security logs, traffic logs, threat events
#   - index=fw_summary: Correlation analysis results (existing)
#
# Data Volume Estimation (80 FortiGates):
#   - FAZ logs: ~800 GB/month (10 GB/day)
#   - FMG logs: ~5 GB/month (170 MB/day)
#   - Total: ~805 GB/month

# ==========================================
# FortiManager Index (Configuration Management)
# ==========================================
# DISABLED - Currently using index=fw with sourcetype=fmg:*
# To enable: Remove "# DISABLED" from [fmg] line below
[fmg]  # DISABLED
homePath = $SPLUNK_DB/fmg/db
coldPath = $SPLUNK_DB/fmg/colddb
thawedPath = $SPLUNK_DB/fmg/thaweddb

# Data types stored:
#   - Configuration changes (policy, objects, interfaces)
#   - Admin audit logs (who changed what, when)
#   - Device inventory (FortiGate status, licenses, HA state)
#   - Firmware management logs

# Performance tuning
maxHotBuckets = 3
maxDataSize = auto              # Auto-rolling (750 MB buckets)
maxHotSpanSecs = 7200           # 2-hour buckets

# Retention policy
frozenTimePeriodInSecs = 15552000   # 180 days (6 months)
# Reason: Configuration audit trail for compliance

# Compression (Splunk 9.0+)
journalCompression = zstd

# ==========================================
# FortiAnalyzer Index (Security & Traffic Logs)
# ==========================================
# DISABLED - Currently using index=fw with sourcetype=faz:*
# To enable: Remove "# DISABLED" from [faz] line below
[faz]  # DISABLED
homePath = $SPLUNK_DB/faz/db
coldPath = $SPLUNK_DB/faz/colddb
thawedPath = $SPLUNK_DB/faz/thaweddb

# Data types stored:
#   - Security events (IPS/IDS, AV, Web filtering, App control)
#   - Traffic logs (allowed/denied connections)
#   - VPN logs (IPsec, SSL-VPN)
#   - Threat intelligence (botnet, malware detections)

# Performance tuning (HIGH VOLUME)
maxHotBuckets = 10              # More hot buckets for 10 GB/day
maxDataSize = auto_high_volume  # 10 GB/day → Large buckets (1 GB)
maxHotSpanSecs = 3600           # 1-hour buckets for faster searches

# Retention policy
frozenTimePeriodInSecs = 7776000    # 90 days
# Reason: Security logs for incident investigation

# Compression
journalCompression = zstd

# Archive to cold storage (optional)
# coldToFrozenDir = /archive/faz

# ==========================================
# Summary Index (Correlation Results) - EXISTING
# ==========================================
[fw_summary]
# Keep existing configuration
# This stores pre-aggregated correlation detection results
homePath = $SPLUNK_DB/fw_summary/db
coldPath = $SPLUNK_DB/fw_summary/colddb
thawedPath = $SPLUNK_DB/fw_summary/thaweddb

maxHotBuckets = 3
maxDataSize = auto

# Long retention for correlation results
frozenTimePeriodInSecs = 31536000   # 365 days (1 year)

# ==========================================
# Current Deployment Strategy (RECOMMENDED)
# ==========================================
# ✅ CURRENT: All data in index=fw (FMG + FAZ + FortiGate)
#   - Differentiate by sourcetype:
#     * sourcetype=fmg:* (FortiManager API data)
#     * sourcetype=faz:* (FortiAnalyzer logs)
#     * sourcetype=fortinet:* (Direct FortiGate syslog)
#   - Queries use: index=fw sourcetype=fmg:* OR sourcetype=faz:*
#   - Benefits: No dashboard migration, simple architecture
#   - Storage: Single index handles all 80 FortiGates (~10 GB/day)
#
# ==========================================
# Alternative: Separate Indexes (Future Option)
# ==========================================
# If you later want to separate indexes:
#   - Enable [fmg] and [faz] indexes below
#   - Update inputs.conf to route data by sourcetype
#   - Migrate dashboards gradually (dual query: index=fw OR index=faz)
#   - Deprecate index=fw after 90 days
#
# Configuration below is DISABLED by default.
# To enable: Remove "# DISABLED" from index names.

# ==========================================
# Disk Space Requirements
# ==========================================
# Estimated sizes (80 FortiGates, 90-day retention):
#
# index=faz:  10 GB/day × 90 days × 1.5 (replication) = 1.35 TB
# index=fmg:  170 MB/day × 180 days × 1.5 = 45 GB
# index=fw_summary: 100 MB/day × 365 days × 1.5 = 55 GB
#
# Total: ~1.45 TB storage needed
#
# Recommendation: Provision 2 TB for growth

# ==========================================
# Search Performance Optimization
# ==========================================
# Enable bloom filters (faster keyword searches)
enableTsidxReduction = true
tsidxReductionCheckPeriodInSec = 600

# Enable data integrity check
enableDataIntegrityControl = true

# ==========================================
# Index Parallelization (Splunk 8.0+)
# ==========================================
# Split indexing across multiple threads
maxConcurrentOptimizes = 3
maxMemMB = 5
maxHotIdleSecs = 86400

# ==========================================
# Deployment Notes
# ==========================================
# 1. Copy this file to: $SPLUNK_HOME/etc/apps/search/local/indexes.conf
# 2. Restart Splunk: $SPLUNK_HOME/bin/splunk restart
# 3. Verify indexes created:
#    | eventcount summarize=false index=fmg OR index=faz
# 4. Update inputs.conf to route data to new indexes
# 5. Update savedsearches.conf to use index=faz instead of index=fw
