<form version="1.1" theme="dark">
  <label>ğŸ”— Fortinet Correlation Analysis Dashboard</label>
  <description>Advanced threat correlation engine - 6 detection rules with automated response</description>

  <!-- Global Time Picker -->
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_picker">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>

    <input type="dropdown" token="event_category_filter">
      <label>Correlation Type</label>
      <choice value="*">All Types</choice>
      <choice value="multi_factor_threat">Multi-Factor Threat</choice>
      <choice value="repeated_high_risk">Repeated High-Risk Events</choice>
      <choice value="weak_signal_combo">Weak Signal Combination</choice>
      <choice value="geo_attack_pattern">Geo + Attack Pattern</choice>
      <choice value="time_anomaly">Time-Based Anomaly</choice>
      <choice value="cross_event_type">Cross-Event Type</choice>
      <default>*</default>
    </input>

    <input type="dropdown" token="action_filter">
      <label>Action Recommendation</label>
      <choice value="*">All Actions</choice>
      <choice value="AUTO_BLOCK">Auto-Block</choice>
      <choice value="REVIEW_AND_BLOCK">Review &amp; Block</choice>
      <choice value="MONITOR">Monitor Only</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- Row 1: KPI Metrics -->
  <row>
    <panel>
      <title>ğŸš« Deny Events (ì°¨ë‹¨ëœ ì´ë²¤íŠ¸)</title>
      <single>
        <search>
          <query>
index=fw action=deny earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as deny_events
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[100,500,1000]</option>
        <option name="underLabel">Total Deny Events</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ”´ Critical Severity Events</title>
      <single>
        <search>
          <query>
index=fw severity=critical earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as critical_events
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[10,50,100]</option>
        <option name="underLabel">Critical Threats</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>ğŸŸ¡ High Severity Events</title>
      <single>
        <search>
          <query>
index=fw severity=high earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as high_events
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[50,200,500]</option>
        <option name="underLabel">High Priority Threats</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ“ˆ Avg Correlation Score</title>
      <single>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats avg(severity_score) as avg_score
| eval avg_score = round(avg_score, 2)
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[70,80,90]</option>
        <option name="underLabel">Score (0-100)</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: Correlation Timeline & Distribution -->
  <row>
    <panel>
      <title>ğŸ“‰ Correlation Detections Over Time</title>
      <chart>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| rex field=marker "correlation_detection=(?&lt;event_category&gt;.*)"
| timechart span=1h count by attack_type
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Detections</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ“Š Correlation Type Distribution</title>
      <chart>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count by attack_type
| sort - count
          </query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- Row 3: Top Correlated Threats -->
  <row>
    <panel>
      <title>ğŸ¯ Top 20 Correlated Threat Sources (Last 24h)</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| rex field=marker "correlation_detection=(?&lt;event_category&gt;.*)"
| stats count as detections,
    avg(severity_score) as avg_score,
    max(severity_score) as max_score,
    latest(_time) as last_detected,
    values(attack_type) as rules_triggered,
    values(action) as actions,
    values(country) as countries,
    values(abuse_score) as abuse_scores
  by src_ip
| eval avg_score = round(avg_score, 2)
| eval last_detected = strftime(last_detected, "%Y-%m-%d %H:%M:%S")
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    detections as "Detections",
    avg_score as "Avg Score",
    max_score as "Max Score",
    last_detected as "Last Detected",
    rules_triggered as "Rules Triggered",
    actions as "Recommendations",
    countries as "Country",
    abuse_scores as "Abuse Score"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">70,80,90</scale>
        </format>
        <format type="color" field="Recommendations">
          <colorPalette type="map">{"AUTO_BLOCK":#D93F3C,"REVIEW_AND_BLOCK":#F58F39,"MONITOR":#F7BC38}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 4: Multi-Factor Threat Analysis -->
  <row>
    <panel>
      <title>ğŸ” Multi-Factor Threat Score Breakdown</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as event_count,
    avg(severity_score) as avg_severity_score,
    max(severity_score) as max_severity_score,
    latest(failed_login_count) as failed_logins,
    values(countries) as countries,
    values(abuse_scores) as abuse_scores,
    values(action) as action
  by src_ip
| eval avg_severity_score = round(avg_severity_score, 2)
| sort - max_severity_score
| head 20
| rename src_ip as "Source IP",
    event_count as "Events",
    avg_severity_score as "Avg Score",
    max_severity_score as "Max Score",
    failed_logins as "Failed Logins",
    countries as "Country",
    abuse_scores as "Abuse Score",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">75,85,95</scale>
        </format>
        <format type="color" field="Action">
          <colorPalette type="map">{"AUTO_BLOCK":#D93F3C,"REVIEW_AND_BLOCK":#F58F39,"MONITOR":#F7BC38}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 5: Repeated High-Risk Events -->
  <row>
    <panel>
      <title>ğŸ”„ Repeated High-Risk Event Patterns</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as pattern_count,
    avg(severity_score) as avg_score,
    max(severity_score) as max_score,
    sum(event_count) as total_events,
    values(severities) as severities,
    values(attack_types) as attack_types,
    values(action) as action
  by src_ip
| eval avg_score = round(avg_score, 2)
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    pattern_count as "Patterns",
    avg_score as "Avg Score",
    max_score as "Max Score",
    total_events as "Total Events",
    severities as "Severities",
    attack_types as "Attack Types",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">70,80,90</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 6: Weak Signal Combinations -->
  <row>
    <panel>
      <title>ğŸ”¬ Weak Signal Correlation Matrix</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.earliest$
| stats count as detections,
    avg(weak_signals_count) as avg_signals,
    max(severity_score) as max_score,
    values(detected_signals) as signals_detected,
    sum(event_count) as total_events,
    values(action) as action
  by src_ip
| eval avg_signals = round(avg_signals, 1)
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    detections as "Detections",
    avg_signals as "Avg Signals",
    max_score as "Max Score",
    signals_detected as "Signals Detected",
    total_events as "Total Events",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">75,85,95</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 7: Geo-Location Risk Analysis -->
  <row>
    <panel>
      <title>ğŸŒ Geographic Correlation Heatmap</title>
      <chart>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as detections,
    avg(severity_score) as avg_score,
    sum(eval(if(action="AUTO_BLOCK", 1, 0))) as auto_blocks
  by country
| sort - detections
| head 20
| eval avg_score = round(avg_score, 2)
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.axisTitleX.text">Country</option>
        <option name="charting.axisTitleY.text">Detections</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.drilldown">all</option>
      </chart>
    </panel>

    <panel>
      <title>ğŸ¯ Geo + Attack Pattern Detections</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as detections,
    max(severity_score) as max_score,
    sum(attack_events) as total_attacks,
    sum(critical_events) as critical_events,
    values(attack_types) as attack_types,
    values(action) as action
  by src_ip, country
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    country as "Country",
    detections as "Detections",
    max_score as "Max Score",
    total_attacks as "Attack Events",
    critical_events as "Critical",
    attack_types as "Attack Types",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">75,85,95</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 8: Time-Based Anomaly Detection -->
  <row>
    <panel>
      <title>â° Time-Based Anomaly Spikes</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as anomalies,
    avg(z_score) as avg_z_score,
    max(z_score) as max_z_score,
    avg(spike_ratio) as avg_spike_ratio,
    max(spike_ratio) as max_spike_ratio,
    max(severity_score) as max_score,
    values(action) as action
  by src_ip
| eval avg_z_score = round(avg_z_score, 2)
| eval max_z_score = round(max_z_score, 2)
| eval avg_spike_ratio = round(avg_spike_ratio, 1) + "x"
| eval max_spike_ratio = round(max_spike_ratio, 1) + "x"
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    anomalies as "Anomalies",
    avg_z_score as "Avg Z-Score",
    max_z_score as "Max Z-Score",
    avg_spike_ratio as "Avg Spike",
    max_spike_ratio as "Max Spike",
    max_score as "Max Score",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">75,85,95</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 9: Cross-Event Type Correlation -->
  <row>
    <panel>
      <title>ğŸ­ Sophisticated Attacker Profiles (Multiple Tactics)</title>
      <table>
        <search>
          <query>
index=fw earliest=$time_picker.earliest$ latest=$time_picker.latest$
| stats count as profile_detections,
    avg(unique_attack_types) as avg_tactics,
    max(unique_attack_types) as max_tactics,
    max(severity_score) as max_score,
    values(attack_types) as attack_types,
    sum(event_count) as total_events,
    values(threat_profile) as threat_profile,
    values(action) as action
  by src_ip
| eval avg_tactics = round(avg_tactics, 1)
| sort - max_score
| head 20
| rename src_ip as "Source IP",
    profile_detections as "Detections",
    avg_tactics as "Avg Tactics",
    max_tactics as "Max Tactics",
    max_score as "Max Score",
    attack_types as "Attack Types",
    total_events as "Total Events",
    threat_profile as "Threat Profile",
    action as "Action"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="Max Score">
          <colorPalette type="list">[#65A637,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">75,85,95</scale>
        </format>
        <format type="color" field="Max Tactics">
          <colorPalette type="list">[#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">4,5</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 10: Automated Response Audit Trail -->
  <row>
    <panel>
      <title>ğŸ¤– Automated Response Actions Log</title>
      <table>
        <search>
          <query>
index=_internal source=*fortigate_auto_block.log earliest=$time_picker.earliest$ latest=$time_picker.latest$
| rex field=_raw "action=(?&lt;action&gt;\w+)\s+ip=(?&lt;blocked_ip&gt;[\d\.]+)\s+score=(?&lt;score&gt;[\d\.]+)\s+rule=(?&lt;rule&gt;[^\s]+)"
| stats count as actions,
    latest(_time) as last_action,
    values(action) as action_types,
    values(rule) as triggered_rules,
    avg(score) as avg_score
  by blocked_ip
| eval last_action = strftime(last_action, "%Y-%m-%d %H:%M:%S")
| eval avg_score = round(avg_score, 2)
| sort - last_action
| head 50
| rename blocked_ip as "Blocked IP",
    actions as "Actions",
    last_action as "Last Action",
    action_types as "Action Types",
    triggered_rules as "Correlation Rules",
    avg_score as "Avg Score"
          </query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>

  <!-- Row 11: Correlation Performance Metrics -->
  <row>
    <panel>
      <title>âš¡ Correlation Engine Performance</title>
      <table>
        <search>
          <query>
index=_internal source=*scheduler.log savedsearch_name="Correlation_*" earliest=$time_picker.earliest$ latest=$time_picker.latest$
| rex field=savedsearch_name "Correlation_(?&lt;event_category&gt;.*)"
| stats count as executions,
    avg(run_time) as avg_runtime,
    max(run_time) as max_runtime,
    sum(eval(if(status="success", 1, 0))) as successful,
    sum(eval(if(status="failed", 1, 0))) as failed
  by savedsearch_name
| eval avg_runtime = round(avg_runtime, 2) + "s"
| eval max_runtime = round(max_runtime, 2) + "s"
| eval success_rate = round((successful / executions) * 100, 2) + "%"
| sort - executions
| rename savedsearch_name as "Correlation Search",
    executions as "Executions",
    avg_runtime as "Avg Runtime",
    max_runtime as "Max Runtime",
    successful as "Successful",
    failed as "Failed",
    success_rate as "Success Rate"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

  <!-- Row 12: Slack Notification Test Panel -->
  <row>
    <panel>
      <title>ğŸ“¢ Slack ì•Œë¦¼ í…ŒìŠ¤íŠ¸ (Notification Test)</title>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; margin: 10px 0;">
          <h2 style="margin-top: 0; font-size: 24px;">ğŸ”” Slack ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h2>
          <p style="font-size: 16px; line-height: 1.6;">
            ì´ íŒ¨ë„ì—ì„œ Slack ì•Œë¦¼ ì„¤ì •ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
            <strong>ì‚¬ìš© ë°©ë²•:</strong>
          </p>
          <ol style="font-size: 14px; line-height: 1.8; margin-left: 20px;">
            <li><strong>í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡</strong>: ì•„ë˜ "Send Test Alert" ë²„íŠ¼ í´ë¦­</li>
            <li><strong>ì‹¤ì œ Detection ì•Œë¦¼</strong>: ìƒê´€ê´€ê³„ íƒì§€ ì‹œ ìë™ ì „ì†¡</li>
            <li><strong>ì•Œë¦¼ íˆìŠ¤í† ë¦¬</strong>: ìµœê·¼ 24ì‹œê°„ ë‚´ ì „ì†¡ëœ ì•Œë¦¼ í™•ì¸</li>
          </ol>

          <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 5px; margin-top: 15px;">
            <h3 style="margin-top: 0; font-size: 18px;">âš™ï¸ ì„¤ì • í™•ì¸</h3>
            <ul style="font-size: 13px; list-style: none; padding: 0;">
              <li>âœ“ Slack Plugin: slack-notification-alert_232.tgz</li>
              <li>âœ“ Channel: #splunk-alerts</li>
              <li>âœ“ Alert Actions: correlation-rules.conf (Line 197, 358)</li>
              <li>âœ“ Python Script: fortigate_auto_block.py</li>
            </ul>
          </div>

          <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-left: 4px solid #ffd700; border-radius: 4px;">
            <strong>ğŸ“ Note:</strong> Slack ì•Œë¦¼ì€ ë‹¤ìŒ ì¡°ê±´ì—ì„œ ìë™ ì „ì†¡ë©ë‹ˆë‹¤:
            <ul style="margin: 10px 0 0 20px; font-size: 13px;">
              <li><strong>Correlation Score â‰¥ 90</strong>: AUTO_BLOCK (ì¦‰ì‹œ ì°¨ë‹¨ + ì•Œë¦¼)</li>
              <li><strong>Correlation Score 80-89</strong>: REVIEW_AND_BLOCK (ê²€í†  ìš”ì²­ ì•Œë¦¼)</li>
              <li><strong>Weak Signal Correlation</strong>: ì•½í•œ ì‹ í˜¸ ì¡°í•© ê°ì§€ (ì•Œë¦¼ ì „ìš©)</li>
              <li><strong>Sophisticated Threat</strong>: APT íŒ¨í„´ ê°ì§€ (ê³ ê¸‰ ìœ„í˜‘ ì•Œë¦¼)</li>
            </ul>
          </div>
        </div>
      </html>
    </panel>

    <panel>
      <title>ğŸš€ Slack ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</title>
      <table>
        <search>
          <query>
| makeresults count=25
| streamstats count as event_num
| eval srcip="192.168.100.99",
       dstip="10.0.0." + (50 + (event_num % 10)),
       srcport=50000 + event_num,
       dstport=if(event_num &lt; 10, 22, if(event_num &lt; 20, 3389, 443)),
       proto="tcp",
       action="deny",
       policyid=100,
       severity="high",
       attack=case(
           event_num &lt; 10, "SSH brute force attempt",
           event_num &lt; 20, "Port scan detected - reconnaissance activity",
           1=1, "Failed login attempt - authentication failure"
       ),
       service=if(event_num &lt; 10, "ssh", if(event_num &lt; 20, "rdp", "https")),
       app="web",
       msg=case(
           event_num &lt; 10, "Multiple failed login attempts from " + srcip + " - brute force pattern detected",
           event_num &lt; 20, "Port scan activity detected - probe on multiple ports from " + srcip,
           1=1, "Authentication failed - invalid credentials from " + srcip
       ),
       src_ip=srcip,
       dst_ip=dstip,
       _time=now() - (event_num * 10)
| fields - event_num
| table _time, srcip, dstip, srcport, dstport, proto, action, policyid, severity, attack, service, app, msg, src_ip, dst_ip
| collect index=fw sourcetype=fortigate
          </query>
          <earliest>-5m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="severity">
          <colorPalette type="map">{"critical":"#DC4E41","high":"#F1813F","medium":"#FFD700","low":"#53A051"}</colorPalette>
        </format>
        <format type="color" field="action">
          <colorPalette type="map">{"deny":"#DC4E41","allow":"#53A051"}</colorPalette>
        </format>
      </table>

      <html>
        <div style="margin-top: 15px; padding: 15px; background: #d4edda; border: 2px solid #28a745; border-radius: 8px;">
          <p style="color: #155724; margin: 0; font-size: 14px;">
            <strong>âœ… ë™ì‘ ë°©ì‹:</strong>
          </p>
          <ol style="color: #155724; font-size: 13px; margin: 10px 0 0 20px;">
            <li>ìœ„ í…Œì´ë¸”ì´ <strong>25ê°œ í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸</strong>ë¥¼ ì¦‰ì‹œ ìƒì„±í•©ë‹ˆë‹¤ (ì‹¤ì œ ë°ì´í„° ë¶ˆí•„ìš”)</li>
            <li>ì´ë²¤íŠ¸ êµ¬ì„±: SSH brute force (10ê°œ) + Port scan (10ê°œ) + Failed login (5ê°œ)</li>
            <li>ëª¨ë“  ì´ë²¤íŠ¸ê°€ <code>index=fw</code>ì— FortiGate í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤</li>
            <li><strong>Rule 3 (Weak Signal Combination)</strong>ì´ íŒ¨í„´ì„ ìë™ ê°ì§€í•©ë‹ˆë‹¤:
              <ul style="margin: 5px 0 0 15px;">
                <li>âœ“ has_failed_login: "failed login|brute force" íŒ¨í„´</li>
                <li>âœ“ has_port_scan: "port scan|probe" íŒ¨í„´</li>
                <li>âœ“ has_multiple_targets: 10ê°œ ì„œë¡œ ë‹¤ë¥¸ ëŒ€ìƒ IP</li>
                <li>âœ“ has_high_frequency: 25ê°œ ì´ë²¤íŠ¸ &gt; 20</li>
              </ul>
            </li>
            <li>weak_signals_count â‰¥ 3 ì¡°ê±´ ì¶©ì¡± â†’ <strong>Slack ì•Œë¦¼</strong> íŠ¸ë¦¬ê±°!</li>
            <li><strong>í™•ì¸:</strong> #splunk-alerts ì±„ë„ (ì•½ 5ë¶„ ì´ë‚´, cron ì‹¤í–‰ ëŒ€ê¸°)</li>
          </ol>
        </div>

        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
          <p style="color: #856404; margin: 0; font-size: 13px;">
            <strong>âš ï¸ í•„ìˆ˜ ì„¤ì •:</strong><br/>
            âœ“ Slack Plugin: <code>/opt/splunk/etc/apps/slack_alerts/</code><br/>
            âœ“ Alert Actions: <code>configs/correlation-rules.conf</code> (Line 197, 358)<br/>
            âœ“ Slack Channel: <code>#splunk-alerts</code><br/>
            âœ“ Correlation Rules: ë§¤ 5ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰ (cron)
          </p>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 13: Recent Slack Notifications History -->
  <row>
    <panel>
      <title>ğŸ“œ ìµœê·¼ Slack ì•Œë¦¼ íˆìŠ¤í† ë¦¬ (Recent 24h)</title>
      <table>
        <search>
          <query>
index=_internal source=*slack* OR source=*alert_actions* earliest=-24h
| rex field=_raw "channel=(?&lt;channel&gt;[^\s]+)"
| rex field=_raw "message=(?&lt;message&gt;[^\"]+)"
| rex field=_raw "status=(?&lt;status&gt;\w+)"
| stats count as notification_count,
    latest(_time) as last_sent,
    values(channel) as channels,
    values(status) as statuses
  by message
| eval last_sent = strftime(last_sent, "%Y-%m-%d %H:%M:%S")
| sort - notification_count
| head 20
| rename message as "Message",
    notification_count as "Count",
    last_sent as "Last Sent",
    channels as "Channels",
    statuses as "Status"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
      </table>
    </panel>

    <panel>
      <title>âœ… Slack ì•Œë¦¼ ì„±ê³µë¥  (Success Rate)</title>
      <single>
        <search>
          <query>
index=_internal source=*alert_actions* "slack" earliest=-24h
| stats count as total,
    sum(eval(if(match(_raw, "(?i)success|sent"), 1, 0))) as successful,
    sum(eval(if(match(_raw, "(?i)error|fail"), 1, 0))) as failed
| eval success_rate = round((successful / total) * 100, 2)
| eval success_rate_display = success_rate + "%"
| fields success_rate_display
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0xdc4e41","0xf1813f","0x53a051"]</option>
        <option name="rangeValues">[50,90]</option>
        <option name="underLabel">Last 24 Hours</option>
        <option name="useColors">1</option>
        <option name="unit">Success Rate</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ“Š ì•Œë¦¼ ì „ì†¡ í†µê³„ (24h)</title>
      <table>
        <search>
          <query>
index=_internal source=*alert_actions* "slack" earliest=-24h
| rex field=_raw "severity=(?&lt;severity&gt;\w+)"
| rex field=_raw "score=(?&lt;score&gt;\d+)"
| stats count as alerts,
    avg(score) as avg_score,
    max(score) as max_score
  by severity
| eval avg_score = round(avg_score, 2)
| sort - alerts
| rename severity as "Severity",
    alerts as "Alert Count",
    avg_score as "Avg Score",
    max_score as "Max Score"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">false</option>
      </table>
    </panel>
  </row>
</form>
