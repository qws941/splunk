<form version="1.1">
  <label>Slack Alert Test</label>
  <description>Slack integration test - Send test alerts and verify delivery (Plugin configured)</description>

  <!-- Row 1: ì•ˆë‚´ -->
  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
          <h2 style="margin-top: 0;">ğŸ”” Slack Alert Test</h2>
          <p style="font-size: 16px;">
            Click "Run Test" below to send a test message to Slack channel <strong>#splunk-alerts</strong> (ID: C09DSD6JH2Q)
          </p>
          <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin-top: 10px;">
            <p style="margin: 0; font-size: 14px;">âœ… Slack plugin configured | Channel ID: C09DSD6JH2Q</p>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 2: Test Execution Button -->
  <row>
    <panel>
      <title>ğŸš€ Run Test</title>
      <table>
        <search>
          <query>| makeresults count=1
| eval test_message="ğŸ‰ Slack Test Message",
       test_time=strftime(now(), "%Y-%m-%d %H:%M:%S"),
       severity="info",
       source="Splunk Dashboard Test"
| table test_time, test_message, severity, source
| sendalert slack param.channel="C09DSD6JH2Q" param.message=test_message</query>
          <earliest>-5m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>

  <!-- Row 3: Status Check -->
  <row>
    <panel>
      <title>ğŸ“Š Recent Alert History (24 hours)</title>
      <table>
        <search>
          <query>index=_internal source=*scheduler.log action=alert_fired
| search alert_actions=*slack*
| eval alert_time=strftime(_time, "%Y-%m-%d %H:%M:%S")
| table alert_time, savedsearch_name, alert_actions, app
| head 10</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>

    <panel>
      <title>âœ… Slack Plugin Configuration Check</title>
      <html>
        <div style="padding: 15px; background: #f5f5f5; border-left: 4px solid #4CAF50; border-radius: 4px;">
          <h3 style="margin-top: 0; color: #333;">Configuration Verification Steps</h3>
          <ol style="color: #666; line-height: 1.8;">
            <li><strong>Settings</strong> â†’ <strong>Alert actions</strong></li>
            <li>Click <strong>Slack</strong></li>
            <li>Verify <strong>Token</strong> (must start with xoxb-)</li>
            <li>Verify <strong>Channel</strong> (C09DSD6JH2Q)</li>
            <li>Ensure <strong>Enable</strong> is checked</li>
          </ol>

          <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 3px;">
            <strong>âš ï¸ Important:</strong> Bot must be invited to the Slack channel.<br/>
            <code>/invite @Splunk FortiGate Alert</code>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 4: Advanced Test with Detailed Information -->
  <row>
    <panel>
      <title>ğŸ”§ Advanced Test (Detailed Information)</title>
      <table>
        <search>
          <query>| makeresults count=1
| eval src_ip="192.168.100.99",
       dst_ip="10.0.0.50",
       severity="high",
       attack="Test Alert - SSH Brute Force",
       event_count=1,
       test_time=strftime(now(), "%Y-%m-%d %H:%M:%S KST"),
       message="ğŸš¨ FortiGate Security Alert - TEST\n\n*Source IP:* " + src_ip + "\n*Destination IP:* " + dst_ip + "\n*Severity:* " + severity + "\n*Attack Type:* " + attack + "\n*Time:* " + test_time
| table src_ip, dst_ip, severity, attack, test_time
| sendalert slack param.channel="C09DSD6JH2Q" param.message=message</query>
          <earliest>-5m</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>
