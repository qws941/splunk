# Slack Alert Formatting Configuration (Advanced)
# For Fortinet Device Management Dashboard
# Channel ID: C09DSD6JH2Q
# Format: Slack Block Kit (Rich Formatting)

# ==========================================
# Device Events Alert Format
# ==========================================
[Device_Events_Alert]
action.slack = 1
action.slack.param.channel = #C09DSD6JH2Q
action.slack.param.message = {
  "text": "üñ•Ô∏è Device Event Alert",
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "üñ•Ô∏è Device Event Alert"
      }
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*Device:*\n$result.devname$"
        },
        {
          "type": "mrkdwn",
          "text": "*Time:*\n$result.event_time$"
        },
        {
          "type": "mrkdwn",
          "text": "*Status:*\n$result.status$"
        },
        {
          "type": "mrkdwn",
          "text": "*Event Count:*\n$result.event_count$"
        }
      ]
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Details:*\n```$result.logdesc$```"
      }
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "üîó <https://splunk.yourdomain.com/app/search/fortinet_device_management|View Dashboard>"
        }
      ]
    }
  ]
}

# ==========================================
# Admin Activity Alert Format
# ==========================================
[Admin_Activity_Alert]
action.slack = 1
action.slack.param.channel = #C09DSD6JH2Q
action.slack.param.message = {
  "text": "üë§ Admin Activity Alert",
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": "üë§ Admin Activity Alert"
      }
    },
    {
      "type": "section",
      "fields": [
        {
          "type": "mrkdwn",
          "text": "*Admin User:*\n$result.admin_user$"
        },
        {
          "type": "mrkdwn",
          "text": "*Activity:*\n$result.activity_type$"
        },
        {
          "type": "mrkdwn",
          "text": "*Source IP:*\n$result.source_ip$"
        },
        {
          "type": "mrkdwn",
          "text": "*Time:*\n$result.event_time$"
        }
      ]
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*Action Details:*\n```$result.logdesc$```"
      }
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "‚ö†Ô∏è Priority: *$result.priority$* | üîó <https://splunk.yourdomain.com/app/search/fortinet_device_management|View Dashboard>"
        }
      ]
    }
  ]
}

# ==========================================
# Configuration Changes Alert Format
# ==========================================
[Config_Changes_Alert]
action.slack = 1
action.slack.param.channel = #C09DSD6JH2Q
action.slack.param.message = {
  "text": "üîß Configuration Change Alert",
  "attachments": [
    {
      "color": "#F7BC38",
      "blocks": [
        {
          "type": "header",
          "text": {
            "type": "plain_text",
            "text": "üîß Configuration Change Alert"
          }
        },
        {
          "type": "section",
          "fields": [
            {
              "type": "mrkdwn",
              "text": "*Admin User:*\n$result.admin_user$"
            },
            {
              "type": "mrkdwn",
              "text": "*Device:*\n$result.device$"
            },
            {
              "type": "mrkdwn",
              "text": "*Category:*\n$result.change_category$"
            },
            {
              "type": "mrkdwn",
              "text": "*Time:*\n$result.event_time$"
            }
          ]
        },
        {
          "type": "section",
          "text": {
            "type": "mrkdwn",
            "text": "*Change Details:*\n```$result.msg$```"
          }
        },
        {
          "type": "divider"
        },
        {
          "type": "actions",
          "elements": [
            {
              "type": "button",
              "text": {
                "type": "plain_text",
                "text": "View Dashboard"
              },
              "url": "https://splunk.yourdomain.com/app/search/fortinet_device_management",
              "style": "primary"
            },
            {
              "type": "button",
              "text": {
                "type": "plain_text",
                "text": "View Config History"
              },
              "url": "https://splunk.yourdomain.com/app/search/config_history"
            }
          ]
        }
      ]
    }
  ]
}

# ==========================================
# Install/Update Alert Format
# ==========================================
[Install_Update_Alert]
action.slack = 1
action.slack.param.channel = #C09DSD6JH2Q
action.slack.param.message = {
  "text": "üì¶ Install/Update Alert",
  "attachments": [
    {
      "color": "good",
      "blocks": [
        {
          "type": "header",
          "text": {
            "type": "plain_text",
            "text": "üì¶ Install/Update Alert"
          }
        },
        {
          "type": "section",
          "fields": [
            {
              "type": "mrkdwn",
              "text": "*Device:*\n$result.device$"
            },
            {
              "type": "mrkdwn",
              "text": "*Type:*\n$result.install_type$"
            },
            {
              "type": "mrkdwn",
              "text": "*Status:*\n$result.status$"
            },
            {
              "type": "mrkdwn",
              "text": "*Admin:*\n$result.admin_user$"
            }
          ]
        },
        {
          "type": "section",
          "text": {
            "type": "mrkdwn",
            "text": "*Installation Details:*\n```$result.msg$```"
          }
        },
        {
          "type": "section",
          "text": {
            "type": "mrkdwn",
            "text": "*Time:* $result.install_time$"
          }
        },
        {
          "type": "context",
          "elements": [
            {
              "type": "mrkdwn",
              "text": "üîó <https://splunk.yourdomain.com/app/search/fortinet_device_management|View Dashboard> | üì¶ <https://splunk.yourdomain.com/app/search/install_history|View Install History>"
            }
          ]
        }
      ]
    }
  ]
}

# ==========================================
# Status-Based Color Coding
# ==========================================
# Success/Completed: "good" (green)
# Warning/In Progress: "warning" (yellow/orange)
# Failed/Critical: "danger" (red)

# ==========================================
# Slack Message Field Mapping
# ==========================================
# Device Events:
#   - devname, event_time, status, event_count, logdesc
#
# Admin Activity:
#   - admin_user, activity_type, source_ip, event_time, logdesc, priority
#
# Config Changes:
#   - admin_user, device, change_category, event_time, msg
#
# Install/Update:
#   - device, install_type, status, admin_user, msg, install_time

# ==========================================
# Usage in Dashboard Studio
# ==========================================
# 1. Create saved searches for each alert type
# 2. Configure search schedule (e.g., */5 * * * * for every 5 minutes)
# 3. Set alert condition based on token value ($alert_device_events$ != "disabled")
# 4. Apply message template from this config

# ==========================================
# Example SPL Alert Query
# ==========================================
# index=fw devname=*
# | where "$alert_device_events$" != "disabled"
# | eval event_time=strftime(_time, "%Y-%m-%d %H:%M:%S")
# | table devname, event_time, status, event_count, logdesc
# | sendalert slack param.channel=$alert_device_events$ param.message="[formatted_message]"
