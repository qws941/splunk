# FortiManager/FortiAnalyzer LogID Exclusion Rules
# Purpose: Filter out noise from critical alerts (login failures, update failures)
# Deploy to: $SPLUNK_HOME/etc/apps/search/local/
#
# Architecture:
#   - Centralized logid exclusion list
#   - Used by SPL macros, dashboards, alerts
#   - Modular configuration (easy to maintain)

# ==========================================
# FortiGate/FortiAnalyzer LogID Reference
# ==========================================
# Source: FortiOS/FortiAnalyzer Log Reference Guide

# ==========================================
# LOGIN FAILURE LogIDs (Exclude from Critical Alerts)
# ==========================================
# These are expected operational events, not security incidents

[faz_login_failure_logids]
# Admin login failures
logid_list = 0100032001,0100032002,0100032003,0100032004,0100032005
# Description:
#   0100032001 - Admin login failed (wrong password)
#   0100032002 - Admin login failed (account locked)
#   0100032003 - Admin login failed (invalid username)
#   0100032004 - Admin login failed (IP not allowed)
#   0100032005 - Admin login failed (certificate error)

# User authentication failures (SSL VPN, IPsec, etc.)
logid_list_vpn = 0101039424,0101039425,0101039426,0101039427,0101039428
# Description:
#   0101039424 - SSL VPN user authentication failed
#   0101039425 - IPsec VPN authentication failed
#   0101039426 - Two-factor authentication failed
#   0101039427 - RADIUS authentication timeout
#   0101039428 - LDAP authentication failed

# Firewall user authentication failures
logid_list_firewall_auth = 0102043008,0102043009,0102043010
# Description:
#   0102043008 - Firewall user authentication failed
#   0102043009 - Captive portal authentication failed
#   0102043010 - Guest user authentication failed

# ==========================================
# UPDATE FAILURE LogIDs (Exclude from Critical Alerts)
# ==========================================
# These are maintenance events, not critical security issues

[faz_update_failure_logids]
# Signature database update failures
logid_list_signatures = 0104044001,0104044002,0104044003,0104044004
# Description:
#   0104044001 - IPS signature update failed (network error)
#   0104044002 - AV signature update failed (server unreachable)
#   0104044003 - Web filter database update failed
#   0104044004 - Application control signature update failed

# Firmware update failures
logid_list_firmware = 0103043200,0103043201,0103043202,0103043203
# Description:
#   0103043200 - Firmware download failed
#   0103043201 - Firmware verification failed
#   0103043202 - Firmware installation failed (space)
#   0103043203 - Firmware rollback triggered

# System update failures
logid_list_system = 0100033100,0100033101,0100033102
# Description:
#   0100033100 - FortiGuard service connection failed
#   0100033101 - License update failed
#   0100033102 - Configuration sync failed

# ==========================================
# COMBINED EXCLUSION LIST (All Noise LogIDs)
# ==========================================
[faz_excluded_logids_all]
# Combined list for easy SPL macro usage
# Format: NOT (logid IN ("id1","id2","id3",...))

# Login failures (15 logids)
login_failures = 0100032001,0100032002,0100032003,0100032004,0100032005,0101039424,0101039425,0101039426,0101039427,0101039428,0102043008,0102043009,0102043010

# Update failures (11 logids)
update_failures = 0104044001,0104044002,0104044003,0104044004,0103043200,0103043201,0103043202,0103043203,0100033100,0100033101,0100033102

# All exclusions (26 logids total)
all_excluded = 0100032001,0100032002,0100032003,0100032004,0100032005,0101039424,0101039425,0101039426,0101039427,0101039428,0102043008,0102043009,0102043010,0104044001,0104044002,0104044003,0104044004,0103043200,0103043201,0103043202,0103043203,0100033100,0100033101,0100033102

# ==========================================
# SPL MACRO READY FORMAT
# ==========================================
# Usage in macros.conf:
#   [faz_filter_critical_alerts]
#   definition = severity="critical" NOT (logid IN ("0100032001","0100032002",...))
#   iseval = 0

# SPL-ready string (with quotes):
spl_excluded_logids = "0100032001","0100032002","0100032003","0100032004","0100032005","0101039424","0101039425","0101039426","0101039427","0101039428","0102043008","0102043009","0102043010","0104044001","0104044002","0104044003","0104044004","0103043200","0103043201","0103043202","0103043203","0100033100","0100033101","0100033102

# ==========================================
# ADDITIONAL NOISE PATTERNS (Optional)
# ==========================================
# Regex patterns for message-based filtering (if logid not available)

[faz_excluded_message_patterns]
# Login failure patterns
login_pattern = (?i)(login\s+failed|authentication\s+failed|invalid\s+credentials|wrong\s+password|account\s+locked)

# Update failure patterns
update_pattern = (?i)(update\s+failed|signature\s+download\s+failed|firmware\s+update\s+error|fortiguard.*failed)

# System maintenance patterns
maintenance_pattern = (?i)(scheduled\s+maintenance|backup\s+in\s+progress|configuration\s+sync)

# ==========================================
# VALIDATION QUERY EXAMPLES
# ==========================================
# Test exclusion filters before deploying

# Count critical events WITH exclusions:
# index=fw sourcetype=faz:event severity="critical"
# NOT (logid IN ("0100032001","0100032002",...))
# | stats count

# Count excluded events (should be login/update failures):
# index=fw sourcetype=faz:event severity="critical"
# logid IN ("0100032001","0100032002",...)
# | stats count by logid, msg

# Compare before/after exclusion counts:
# index=fw sourcetype=faz:event severity="critical" earliest=-24h
# | eval is_excluded = if(logid IN ("0100032001","0100032002",...), "Excluded", "Included")
# | stats count by is_excluded

# ==========================================
# DEPLOYMENT CHECKLIST
# ==========================================
# 1. Copy this file to: $SPLUNK_HOME/etc/apps/search/local/
# 2. Create macros.conf with faz_filter_critical_alerts macro
# 3. Update dashboards to use `faz_filter_critical_alerts` macro
# 4. Update alert searches to use macro
# 5. Test with validation queries above
# 6. Monitor false negative rate (critical alerts missed)

# ==========================================
# MAINTENANCE NOTES
# ==========================================
# - Review excluded logids quarterly
# - Add new logids as patterns emerge
# - Document business justification for exclusions
# - Monitor for abuse (attackers using excluded logids)
# - Keep this file in version control (git)
