{
  "visualizations": {
    "viz_slack_global_toggle": {
      "type": "splunk.singlevalue",
      "title": "ðŸ”” Slack Alerts Status",
      "dataSources": {
        "primary": "ds_slack_status"
      },
      "options": {
        "majorValue": "> primary | seriesByName('status')",
        "majorColor": "> majorValue | matchValue(statusColors)",
        "backgroundColor": "transparent"
      },
      "context": {
        "statusColors": {
          "Enabled": "#4ade80",
          "Disabled": "#ef4444"
        }
      }
    },
    "viz_toggle_panel": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "## ðŸŽ›ï¸ Slack Alert Control\n\n**Current Status**: Slack alerts are currently **$slack_status$**\n\n### Actions:\n- **Enable All**: Turn on Slack notifications for all correlation rules\n- **Disable All**: Turn off Slack notifications (critical AUTO_BLOCK alerts still active)\n\n### Individual Rule Controls:\nUse the table below to toggle individual correlation rules."
      }
    },
    "viz_rule_toggles": {
      "type": "splunk.table",
      "title": "ðŸŽ¯ Individual Rule Controls",
      "dataSources": {
        "primary": "ds_rule_toggles"
      },
      "options": {
        "backgroundColor": "transparent",
        "tableFormat": {
          "rowColors": "> table | seriesByIndex(0) | pick('enabled') | matchValue(rowColorsByEnabled)"
        }
      },
      "context": {
        "rowColorsByEnabled": {
          "1": "#1a472a",
          "0": "#4a1a1a"
        }
      }
    },
    "viz_toggle_history": {
      "type": "splunk.table",
      "title": "ðŸ“œ Toggle History (Last 24h)",
      "dataSources": {
        "primary": "ds_toggle_history"
      },
      "options": {
        "backgroundColor": "transparent"
      }
    },
    "viz_alert_stats": {
      "type": "splunk.column",
      "title": "ðŸ“Š Slack Alert Statistics (7d)",
      "dataSources": {
        "primary": "ds_alert_stats"
      },
      "options": {
        "backgroundColor": "transparent",
        "legendDisplay": "bottom"
      }
    },
    "viz_enable_all_button": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "### âœ… Enable All Slack Alerts\n\nClick the search below to enable all Slack alerts:\n\n```spl\n| makeresults \n| eval alert_name=\"all\", enabled=1, updated_by=\"$env:user$\", updated_time=now() \n| outputlookup slack_alert_toggle append=true\n```\n\n[Run Enable All Search](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22all%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_disable_all_button": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "### â›” Disable All Slack Alerts\n\nClick the search below to disable all Slack alerts:\n\n```spl\n| makeresults \n| eval alert_name=\"all\", enabled=0, updated_by=\"$env:user$\", updated_time=now() \n| outputlookup slack_alert_toggle append=true\n```\n\n[Run Disable All Search](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22all%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule1_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 1: Multi-Factor Threat\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Multi_Factor_Threat_Score%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Multi_Factor_Threat_Score%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule2_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 2: Repeated High-Risk\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Repeated_High_Risk_Events%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Repeated_High_Risk_Events%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule3_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 3: Weak Signal Combination\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Weak_Signal_Combination%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Weak_Signal_Combination%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule4_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 4: Geo + Attack Pattern\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Geo_Attack_Pattern%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Geo_Attack_Pattern%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule5_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 5: Time-Based Anomaly\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Time_Anomaly%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Time_Anomaly%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    },
    "viz_rule6_toggle": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "#### Rule 6: Cross-Event Type (APT)\n[Enable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Cross_Event_Type%22,%20enabled=1,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true) | [Disable](/app/search/search?q=|%20makeresults%20|%20eval%20alert_name=%22Correlation_Cross_Event_Type%22,%20enabled=0,%20updated_by=%22admin%22,%20updated_time=now()%20|%20outputlookup%20slack_alert_toggle%20append=true)"
      }
    }
  },
  "dataSources": {
    "ds_slack_status": {
      "type": "ds.search",
      "options": {
        "query": "| inputlookup slack_alert_toggle | where alert_name=\"all\" | head 1 | eval status=if(enabled=1, \"Enabled\", \"Disabled\") | table status",
        "queryParameters": {
          "earliest": "0",
          "latest": "now"
        }
      },
      "name": "Slack Status"
    },
    "ds_rule_toggles": {
      "type": "ds.search",
      "options": {
        "query": "| inputlookup slack_alert_toggle | where alert_name!=\"all\" | eval status=if(enabled=1, \"âœ… Enabled\", \"â›” Disabled\") | table alert_name, status, updated_by, updated_time | rename alert_name as \"Rule Name\", status as \"Status\", updated_by as \"Updated By\", updated_time as \"Last Updated\"",
        "queryParameters": {
          "earliest": "0",
          "latest": "now"
        }
      },
      "name": "Rule Toggles"
    },
    "ds_toggle_history": {
      "type": "ds.search",
      "options": {
        "query": "| inputlookup slack_alert_toggle | where updated_time >= relative_time(now(), \"-24h\") | eval action=if(enabled=1, \"Enabled\", \"Disabled\") | sort -updated_time | head 20 | table updated_time, alert_name, action, updated_by | rename updated_time as \"Time\", alert_name as \"Rule\", action as \"Action\", updated_by as \"User\"",
        "queryParameters": {
          "earliest": "-24h",
          "latest": "now"
        }
      },
      "name": "Toggle History"
    },
    "ds_alert_stats": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*scheduler.log savedsearch_name=\"Correlation_*\" earliest=-7d | eval alert_name=savedsearch_name | join type=left alert_name [| inputlookup slack_alert_toggle] | eval sent_to_slack=if(enabled=1, 1, 0) | timechart span=1d count as total_alerts sum(sent_to_slack) as slack_alerts",
        "queryParameters": {
          "earliest": "-7d",
          "latest": "now"
        }
      },
      "name": "Alert Statistics"
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "latest": "$global_time.latest$",
            "earliest": "$global_time.earliest$"
          }
        }
      }
    }
  },
  "inputs": {},
  "layout": {
    "type": "absolute",
    "options": {
      "width": 1440,
      "height": 1200,
      "display": "auto-scale"
    },
    "structure": [
      {
        "item": "viz_slack_global_toggle",
        "type": "block",
        "position": {
          "x": 0,
          "y": 0,
          "w": 480,
          "h": 150
        }
      },
      {
        "item": "viz_toggle_panel",
        "type": "block",
        "position": {
          "x": 480,
          "y": 0,
          "w": 960,
          "h": 150
        }
      },
      {
        "item": "viz_enable_all_button",
        "type": "block",
        "position": {
          "x": 0,
          "y": 150,
          "w": 720,
          "h": 150
        }
      },
      {
        "item": "viz_disable_all_button",
        "type": "block",
        "position": {
          "x": 720,
          "y": 150,
          "w": 720,
          "h": 150
        }
      },
      {
        "item": "viz_rule1_toggle",
        "type": "block",
        "position": {
          "x": 0,
          "y": 300,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule2_toggle",
        "type": "block",
        "position": {
          "x": 480,
          "y": 300,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule3_toggle",
        "type": "block",
        "position": {
          "x": 960,
          "y": 300,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule4_toggle",
        "type": "block",
        "position": {
          "x": 0,
          "y": 380,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule5_toggle",
        "type": "block",
        "position": {
          "x": 480,
          "y": 380,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule6_toggle",
        "type": "block",
        "position": {
          "x": 960,
          "y": 380,
          "w": 480,
          "h": 80
        }
      },
      {
        "item": "viz_rule_toggles",
        "type": "block",
        "position": {
          "x": 0,
          "y": 460,
          "w": 1440,
          "h": 300
        }
      },
      {
        "item": "viz_toggle_history",
        "type": "block",
        "position": {
          "x": 0,
          "y": 760,
          "w": 720,
          "h": 300
        }
      },
      {
        "item": "viz_alert_stats",
        "type": "block",
        "position": {
          "x": 720,
          "y": 760,
          "w": 720,
          "h": 300
        }
      }
    ],
    "globalInputs": []
  },
  "description": "Control Slack alert notifications for correlation rules",
  "title": "ðŸ”” Slack Alert Control Panel"
}
