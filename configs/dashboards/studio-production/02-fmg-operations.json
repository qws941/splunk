{
  "visualizations": {
    "viz_header": {
      "type": "viz.markdown",
      "options": {
        "markdown": "# FortiManager Operations Dashboard\n\n**Policy changes, object CRUD operations, and configuration management**\n\nData Source: `index=fw sourcetype=fortimanager` | Auto-refresh: 30s"
      }
    },
    "viz_total_events": {
      "type": "splunk.singlevalue",
      "title": "Total Events (24h)",
      "dataSources": {
        "primary": "ds_total_events"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "trendValue": "> primary | seriesByIndex(0) | delta(-2)",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "unit": "events"
      }
    },
    "viz_critical_count": {
      "type": "splunk.singlevalue",
      "title": "Critical Events (24h)",
      "dataSources": {
        "primary": "ds_critical_count"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "backgroundColor": "#DC3545",
        "majorFontSize": 32
      }
    },
    "viz_high_severity": {
      "type": "splunk.singlevalue",
      "title": "High Severity (24h)",
      "dataSources": {
        "primary": "ds_high_severity"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "backgroundColor": "#FFA500"
      }
    },
    "viz_event_timeline": {
      "type": "viz.area",
      "title": "Event Timeline by Severity",
      "dataSources": {
        "primary": "ds_timeline"
      },
      "options": {
        "xField": "_time",
        "yField": "count",
        "stackMode": "stacked",
        "seriesColors": ["#DC3545", "#FFA500", "#FFD700", "#32CD32"]
      }
    },
    "viz_policy_changes": {
      "type": "splunk.table",
      "title": "Recent FMG Policy Changes",
      "dataSources": {
        "primary": "ds_policy_changes"
      },
      "options": {
        "count": 10,
        "showRowNumbers": false,
        "columnFormat": {
          "change_type": {
            "data": ">table"
          }
        }
      }
    }
  },
  "dataSources": {
    "ds_total_events": {
      "type": "ds.search",
      "name": "Total Events",
      "options": {
        "query": "index=fw earliest=-24h\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_critical_count": {
      "type": "ds.search",
      "name": "Critical Count",
      "options": {
        "query": "index=fw earliest=-24h severity=critical\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_high_severity": {
      "type": "ds.search",
      "name": "High Severity",
      "options": {
        "query": "index=fw earliest=-24h severity=high\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_timeline": {
      "type": "ds.search",
      "name": "Event Timeline",
      "options": {
        "query": "index=fw earliest=-24h\n| timechart span=30m count by severity",
        "refresh": "30s"
      }
    },
    "ds_policy_changes": {
      "type": "ds.search",
      "name": "Policy Changes",
      "options": {
        "query": "index=fw sourcetype=fortimanager earliest=-24h\n| search msg IN (\"*policy*create*\", \"*policy*update*\", \"*policy*delete*\")\n| rex field=msg \"(?<change_type>create|update|delete)\"\n| table _time, user, change_type, policy_name, msg\n| sort -_time\n| head 10",
        "refresh": "60s"
      }
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "latest": "$global_time.latest$",
            "earliest": "$global_time.earliest$"
          }
        }
      }
    }
  },
  "layout": {
    "type": "grid",
    "options": {
      "width": 1440,
      "height": 800,
      "display": "auto"
    },
    "structure": [
      {
        "item": "viz_header",
        "type": "block",
        "position": {
          "x": 0,
          "y": 0,
          "w": 1440,
          "h": 80
        }
      },
      {
        "item": "viz_total_events",
        "type": "block",
        "position": {
          "x": 0,
          "y": 80,
          "w": 480,
          "h": 150
        }
      },
      {
        "item": "viz_critical_count",
        "type": "block",
        "position": {
          "x": 480,
          "y": 80,
          "w": 480,
          "h": 150
        }
      },
      {
        "item": "viz_high_severity",
        "type": "block",
        "position": {
          "x": 960,
          "y": 80,
          "w": 480,
          "h": 150
        }
      },
      {
        "item": "viz_event_timeline",
        "type": "block",
        "position": {
          "x": 0,
          "y": 230,
          "w": 1440,
          "h": 250
        }
      },
      {
        "item": "viz_policy_changes",
        "type": "block",
        "position": {
          "x": 0,
          "y": 480,
          "w": 1440,
          "h": 320
        }
      }
    ]
  },
  "title": "FortiManager Operations Dashboard",
  "description": "FortiManager policy changes, object operations, and configuration management - No JavaScript required"
}
