{
  "visualizations": {
    "viz_header": {
      "type": "viz.markdown",
      "options": {
        "markdown": "# Slack Alert Control Dashboard\n\n**JavaScript-Free Alert Management via Splunk REST API**\n\n## How to Control Alerts\n\n1. **Via Splunk Web UI**: Settings → Searches, reports, and alerts → Select alert → Enable/Disable\n2. **Via REST API**: Use the REST API endpoints below\n3. **Via CLI**: `splunk edit saved-search <alert_name> -action.slack.param.enable 1|0`\n\n**Monitored Alerts**: FAZ Critical, FMG Policy Changes, Security High Severity"
      }
    },
    "viz_alert_status": {
      "type": "splunk.table",
      "title": "Current Alert Status",
      "dataSources": {
        "primary": "ds_alert_status"
      },
      "options": {
        "count": 10,
        "showRowNumbers": false,
        "columnFormat": {
          "slack_enabled": {
            "data": ">table",
            "rowColors": {
              "1": "#32CD32",
              "0": "#DC3545"
            }
          },
          "alert_enabled": {
            "data": ">table",
            "rowColors": {
              "1": "#32CD32",
              "0": "#DC3545"
            }
          }
        }
      }
    },
    "viz_recent_alerts": {
      "type": "splunk.table",
      "title": "Recent Alert Triggers (Last 24h)",
      "dataSources": {
        "primary": "ds_recent_alerts"
      },
      "options": {
        "count": 20,
        "showRowNumbers": true
      }
    },
    "viz_alert_frequency": {
      "type": "viz.bar",
      "title": "Alert Frequency by Type",
      "dataSources": {
        "primary": "ds_alert_frequency"
      },
      "options": {
        "xField": "alert_name",
        "yField": "trigger_count",
        "orientation": "horizontal"
      }
    },
    "viz_slack_delivery": {
      "type": "splunk.singlevalue",
      "title": "Slack Notifications Sent (24h)",
      "dataSources": {
        "primary": "ds_slack_delivery"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "unit": "messages"
      }
    },
    "viz_alert_errors": {
      "type": "splunk.singlevalue",
      "title": "Alert Errors (24h)",
      "dataSources": {
        "primary": "ds_alert_errors"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "numberPrecision": 0,
        "backgroundColor": "> majorValue | rangeValue(errorRanges)",
        "rangeColors": ["#32CD32", "#FFA500", "#DC3545"]
      }
    },
    "viz_rest_api_guide": {
      "type": "viz.markdown",
      "options": {
        "markdown": "## REST API Quick Reference\n\n### Enable Alert\n```bash\ncurl -k -u admin:password \\\n  -d 'disabled=0' \\\n  -d 'actions=slack' \\\n  https://splunk.jclee.me:8089/servicesNS/nobody/search/saved/searches/FAZ_Critical_Alerts\n```\n\n### Disable Alert\n```bash\ncurl -k -u admin:password \\\n  -d 'disabled=1' \\\n  https://splunk.jclee.me:8089/servicesNS/nobody/search/saved/searches/FAZ_Critical_Alerts\n```\n\n### Check Alert Status\n```bash\ncurl -k -u admin:password \\\n  https://splunk.jclee.me:8089/servicesNS/nobody/search/saved/searches/FAZ_Critical_Alerts?output_mode=json\n```"
      }
    },
    "viz_alert_timeline": {
      "type": "viz.line",
      "title": "Alert Triggers Timeline",
      "dataSources": {
        "primary": "ds_alert_timeline"
      },
      "options": {
        "xField": "_time",
        "yField": "count",
        "seriesColors": ["#1E88E5", "#43A047", "#FB8C00"],
        "showMarkers": true
      }
    }
  },
  "dataSources": {
    "ds_alert_status": {
      "type": "ds.search",
      "options": {
        "query": "| rest /servicesNS/nobody/search/saved/searches splunk_server=local\n| search title IN (\"FAZ_Critical_Alerts\", \"FMG_Policy_Install\", \"FMG_Policy_CRUD\", \"FMG_Object_CRUD\", \"Security_High_Severity\")\n| eval alert_enabled=if(disabled=0, \"1\", \"0\")\n| eval slack_enabled=if(match('action.slack', \"1\"), \"1\", \"0\")\n| table title, alert_enabled, slack_enabled, cron_schedule, next_scheduled_time\n| rename title as \"Alert Name\", alert_enabled as \"Alert Enabled\", slack_enabled as \"Slack Enabled\", cron_schedule as \"Schedule\", next_scheduled_time as \"Next Run\"",
        "refresh": "60s"
      }
    },
    "ds_recent_alerts": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*scheduler.log earliest=-24h\n| search savedsearch_name IN (\"FAZ_Critical_Alerts\", \"FMG_Policy_Install\", \"FMG_Policy_CRUD\", \"FMG_Object_CRUD\", \"Security_High_Severity\")\n| eval status=case(\n    match(status, \"success\"), \"✅ Success\",\n    match(status, \"failure\"), \"❌ Failed\",\n    1=1, status\n  )\n| table _time, savedsearch_name, status, run_time, result_count\n| rename savedsearch_name as \"Alert\", run_time as \"Duration (s)\", result_count as \"Results\"\n| sort -_time\n| head 20",
        "refresh": "60s"
      }
    },
    "ds_alert_frequency": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*scheduler.log earliest=-24h status=success\n| search savedsearch_name IN (\"FAZ_Critical_Alerts\", \"FMG_Policy_Install\", \"FMG_Policy_CRUD\", \"FMG_Object_CRUD\", \"Security_High_Severity\")\n| stats count as trigger_count by savedsearch_name\n| rename savedsearch_name as alert_name\n| sort -trigger_count",
        "refresh": "120s"
      }
    },
    "ds_slack_delivery": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*slack* earliest=-24h\n| search \"successfully sent\" OR \"notification sent\"\n| timechart span=1h count",
        "refresh": "60s"
      }
    },
    "ds_alert_errors": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*scheduler.log earliest=-24h status=failure\n| search savedsearch_name IN (\"FAZ_Critical_Alerts\", \"FMG_Policy_Install\", \"FMG_Policy_CRUD\", \"FMG_Object_CRUD\", \"Security_High_Severity\")\n| timechart span=1h count",
        "refresh": "60s"
      }
    },
    "ds_alert_timeline": {
      "type": "ds.search",
      "options": {
        "query": "index=_internal source=*scheduler.log earliest=-24h\n| search savedsearch_name IN (\"FAZ_Critical_Alerts\", \"FMG_Policy_Install\", \"FMG_Policy_CRUD\", \"FMG_Object_CRUD\", \"Security_High_Severity\")\n| timechart span=30m count by savedsearch_name",
        "refresh": "60s"
      }
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "latest": "$global_time.latest$",
            "earliest": "$global_time.earliest$"
          }
        }
      }
    }
  },
  "inputs": {
    "input_global_trp": {
      "type": "input.timerange",
      "options": {
        "token": "global_time",
        "defaultValue": "-24h@h,now"
      },
      "title": "Time Range"
    }
  },
  "layout": {
    "type": "grid",
    "options": {
      "width": 1600,
      "height": 1100
    },
    "structure": [
      {
        "item": "viz_header",
        "type": "block",
        "position": {
          "x": 0,
          "y": 0,
          "w": 1600,
          "h": 180
        }
      },
      {
        "item": "viz_slack_delivery",
        "type": "block",
        "position": {
          "x": 0,
          "y": 180,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_alert_errors",
        "type": "block",
        "position": {
          "x": 400,
          "y": 180,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_alert_status",
        "type": "block",
        "position": {
          "x": 0,
          "y": 330,
          "w": 800,
          "h": 300
        }
      },
      {
        "item": "viz_rest_api_guide",
        "type": "block",
        "position": {
          "x": 800,
          "y": 180,
          "w": 800,
          "h": 450
        }
      },
      {
        "item": "viz_alert_timeline",
        "type": "block",
        "position": {
          "x": 0,
          "y": 630,
          "w": 800,
          "h": 250
        }
      },
      {
        "item": "viz_alert_frequency",
        "type": "block",
        "position": {
          "x": 800,
          "y": 630,
          "w": 800,
          "h": 250
        }
      },
      {
        "item": "viz_recent_alerts",
        "type": "block",
        "position": {
          "x": 0,
          "y": 880,
          "w": 1600,
          "h": 220
        }
      }
    ]
  },
  "title": "Slack Alert Control (No JavaScript)",
  "description": "Slack alert management dashboard without JavaScript dependencies - Use REST API or Web UI"
}
