{
  "visualizations": {
    "viz_device_list": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#E7F3FF",
        "count": 20,
        "rowNumbers": true,
        "wrap": false
      },
      "dataSources": {
        "primary": "ds_device_list"
      },
      "title": "ğŸ–¥ï¸ FortiGate ì—°ë™ ì¥ë¹„ ëª©ë¡"
    },
    "viz_critical_logs": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFF3CD",
        "count": 30,
        "rowNumbers": true,
        "wrap": true
      },
      "dataSources": {
        "primary": "ds_critical_logs"
      },
      "title": "ğŸ”´ Critical ë¡œê·¸ (ì‹¤ì‹œê°„)"
    },
    "viz_config_changes": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFF9E6",
        "count": 20,
        "rowNumbers": true,
        "wrap": true
      },
      "dataSources": {
        "primary": "ds_config_changes"
      },
      "title": "âš™ï¸ ì„¤ì • ë³€ê²½ ì´ë ¥"
    },
    "viz_policy_traffic": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFFFFF",
        "count": 20,
        "rowNumbers": true,
        "wrap": true
      },
      "dataSources": {
        "primary": "ds_policy_traffic"
      },
      "title": "FortiGate ì •ì±…ë³„ íŠ¸ë˜í”½ (Top 20)"
    },
    "viz_blocked_detail": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFFFFF",
        "count": 30,
        "rowNumbers": true,
        "wrap": true
      },
      "dataSources": {
        "primary": "ds_blocked_detail"
      },
      "title": "ğŸš« ì°¨ë‹¨ëœ íŠ¸ë˜í”½ ìƒì„¸"
    },
    "viz_top_src_ip": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFFFFF",
        "count": 10,
        "rowNumbers": true
      },
      "dataSources": {
        "primary": "ds_top_src_ip"
      },
      "title": "Top 10 ì¶œë°œì§€ IP"
    },
    "viz_top_dst_ip": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFFFFF",
        "count": 10,
        "rowNumbers": true
      },
      "dataSources": {
        "primary": "ds_top_dst_ip"
      },
      "title": "Top 10 ëª©ì ì§€ IP"
    },
    "viz_top_services": {
      "type": "splunk.table",
      "options": {
        "backgroundColor": "#FFFFFF",
        "count": 10,
        "rowNumbers": true
      },
      "dataSources": {
        "primary": "ds_top_services"
      },
      "title": "Top 10 ì„œë¹„ìŠ¤/í¬íŠ¸"
    }
  },
  "dataSources": {
    "ds_device_list": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer devname=* | stats count as event_count, latest(_time) as last_seen, earliest(_time) as first_seen, dc(srcip) as unique_src, dc(dstip) as unique_dst by devname | eval last_seen_time = strftime(last_seen, \"%Y-%m-%d %H:%M:%S\") | eval first_seen_time = strftime(first_seen, \"%Y-%m-%d %H:%M:%S\") | eval status = if((now() - last_seen) < 300, \"ğŸŸ¢ Active\", \"ğŸ”´ Inactive\") | sort -last_seen | rename devname AS \"ì¥ë¹„ëª…\", status AS \"ìƒíƒœ\", event_count AS \"ì´ë²¤íŠ¸ìˆ˜\", last_seen_time AS \"ë§ˆì§€ë§‰ë¡œê·¸\", first_seen_time AS \"ìµœì´ˆë¡œê·¸\", unique_src AS \"ì†ŒìŠ¤IPìˆ˜\", unique_dst AS \"ëª©ì ì§€IPìˆ˜\"",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Device List"
    },
    "ds_critical_logs": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer earliest=-24h latest=now (severity=critical OR level=critical) | eval timestamp = strftime(_time, \"%Y-%m-%d %H:%M:%S\") | eval severity_display = coalesce(severity, level, \"critical\") | table timestamp, srcip, dstip, severity_display, msg, logdesc, devname | rename timestamp AS \"ì‹œê°„\", srcip AS \"ì¶œë°œì§€IP\", dstip AS \"ëª©ì ì§€IP\", severity_display AS \"ì‹¬ê°ë„\", msg AS \"ë©”ì‹œì§€\", logdesc AS \"ì„¤ëª…\", devname AS \"ì¥ë¹„\" | sort -ì‹œê°„ | head 30",
        "queryParameters": {
          "earliest": "-24h",
          "latest": "now"
        }
      },
      "name": "Critical Logs"
    },
    "ds_config_changes": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer (cfgpath=\"firewall.policy\" OR cfgpath=\"firewall.rule\" OR cfgpath=\"firewall.address\" OR cfgpath=\"firewall.addrgrp\" OR cfgpath=\"firewall.service\" OR cfgpath=\"firewall.servicegrp\" OR logid=\"0100044547\" OR logid=\"0100044546\" OR logid=\"0100032001\" OR logid=\"0100032002\") | rex field=_raw \"cfgobj=\\\"(?<policy_obj>[^\\\"]+)\\\"\" | rex field=_raw \"cfgattr=\\\"(?<policy_attr>[^\\\"]+)\\\"\" | rex field=ui \"(?<access>\\w+)\\((?<ip>[^\\)]+)\\)\" | eval config_hash = md5(cfgpath . policy_obj . policy_attr . user . _time) | stats first(_time) as _time, first(devname) as devname, first(user) as user, first(action) as action, first(cfgpath) as cfgpath, first(policy_obj) as policy_obj, first(policy_attr) as policy_attr, first(access) as access, first(ip) as ip by config_hash | eval timestamp = strftime(_time, \"%Y-%m-%d %H:%M:%S\") | eval mgmt_source = case(match(devname, \"FMG|FortiManager\"), \"FortiManager\", match(devname, \"FAZ|FortiAnalyzer\"), \"FortiAnalyzer\", match(devname, \"FG|FortiGate\"), \"FortiGate\", 1=1, devname) | eval change_type = case(match(cfgpath, \"firewall.policy\") OR match(cfgpath, \"firewall.rule\"), \"ì •ì±…\", match(cfgpath, \"firewall.address\") OR match(cfgpath, \"firewall.addrgrp\"), \"ì£¼ì†Œ\", match(cfgpath, \"firewall.service\") OR match(cfgpath, \"firewall.servicegrp\"), \"ì„œë¹„ìŠ¤\", 1=1, \"ê¸°íƒ€\") | eval crud_operation = case(action=\"Add\" OR action=\"create\", \"ìƒì„±\", action=\"Delete\" OR action=\"remove\", \"ì‚­ì œ\", action=\"Edit\" OR action=\"Set\" OR action=\"modify\", \"ìˆ˜ì •\", 1=1, action) | table timestamp, mgmt_source, change_type, user, crud_operation, policy_obj, access, ip | rename timestamp AS \"ì‹œê°„\", mgmt_source AS \"ê´€ë¦¬ì‹œìŠ¤í…œ\", change_type AS \"ë³€ê²½ìœ í˜•\", user AS \"ê´€ë¦¬ì\", crud_operation AS \"ì‘ì—…\", policy_obj AS \"ì„¤ì •ê°ì²´\", access AS \"ì ‘ì†ë°©ë²•\", ip AS \"ì ‘ì†IP\" | sort -ì‹œê°„ | head 20",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Config Changes"
    },
    "ds_policy_traffic": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer type=\"traffic\" policyid=* action=$action_filter$ devname=$device_type$ | stats count as hits, sum(sentbyte) as sent, sum(rcvdbyte) as rcvd, dc(srcip) as src_count, dc(dstip) as dst_count, values(action) as actions, values(devname) as devices by policyid, policyname | eval total_gb = round((sent+rcvd)/1073741824, 2) | sort -hits | head 20 | rename policyid AS \"ì •ì±…ID\", policyname AS \"ì •ì±…ëª…\", hits AS \"ë§¤ì¹­íšŸìˆ˜\", total_gb AS \"íŠ¸ë˜í”½(GB)\", src_count AS \"ì†ŒìŠ¤IPìˆ˜\", dst_count AS \"ëª©ì ì§€IPìˆ˜\", actions AS \"ë™ì‘\", devices AS \"ì¥ë¹„\"",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Policy Traffic"
    },
    "ds_blocked_detail": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer type=\"traffic\" (action=\"deny\" OR action=\"drop\" OR action=\"blocked\") | eval timestamp = strftime(_time, \"%Y-%m-%d %H:%M:%S\") | eval block_reason = case(match(msg, \"(?i)policy.*denied\"), \"ì •ì±… ê±°ë¶€\", match(msg, \"(?i)invalid\"), \"ìœ íš¨í•˜ì§€ ì•Šì€ íŒ¨í‚·\", policyid=0, \"ì •ì±… ì—†ìŒ\", 1=1, \"ê¸°íƒ€\") | eval service_display = coalesce(service, dstport) | table timestamp, srcip, dstip, dstport, service_display, policyid, block_reason, devname | rename timestamp AS \"ì‹œê°„\", srcip AS \"ì¶œë°œì§€IP\", dstip AS \"ëª©ì ì§€IP\", dstport AS \"í¬íŠ¸\", service_display AS \"ì„œë¹„ìŠ¤\", policyid AS \"ì •ì±…ID\", block_reason AS \"ì°¨ë‹¨ì‚¬ìœ \", devname AS \"ì¥ë¹„\" | sort -ì‹œê°„ | head 30",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Blocked Traffic Detail"
    },
    "ds_top_src_ip": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer type=\"traffic\" action=$action_filter$ devname=$device_type$ | stats count as connections, sum(sentbyte) as sent, dc(dstip) as destinations by srcip | eval sent_gb = round(sent/1073741824, 2) | sort -connections | head 10 | rename srcip AS \"ì¶œë°œì§€IP\", connections AS \"ì—°ê²°ìˆ˜\", sent_gb AS \"ì†¡ì‹ (GB)\", destinations AS \"ëª©ì ì§€ìˆ˜\"",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Top Source IP"
    },
    "ds_top_dst_ip": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer type=\"traffic\" action=$action_filter$ devname=$device_type$ | stats count as connections, sum(rcvdbyte) as received, dc(srcip) as sources by dstip | eval received_gb = round(received/1073741824, 2) | sort -connections | head 10 | rename dstip AS \"ëª©ì ì§€IP\", connections AS \"ì—°ê²°ìˆ˜\", received_gb AS \"ìˆ˜ì‹ (GB)\", sources AS \"ì¶œë°œì§€ìˆ˜\"",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Top Destination IP"
    },
    "ds_top_services": {
      "type": "ds.search",
      "options": {
        "query": "index=fortianalyzer type=\"traffic\" action=$action_filter$ devname=$device_type$ | eval port_service = service + \" (\" + dstport + \")\" | stats count as hits, dc(srcip) as unique_src, dc(dstip) as unique_dst by port_service | sort -hits | head 10 | rename port_service AS \"ì„œë¹„ìŠ¤(í¬íŠ¸)\", hits AS \"ì‚¬ìš©íšŸìˆ˜\", unique_src AS \"ì†ŒìŠ¤ìˆ˜\", unique_dst AS \"ëª©ì ì§€ìˆ˜\"",
        "queryParameters": {
          "earliest": "$time_token.earliest$",
          "latest": "$time_token.latest$"
        }
      },
      "name": "Top Services"
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "earliest": "$time_token.earliest$",
            "latest": "$time_token.latest$"
          }
        }
      }
    }
  },
  "inputs": {
    "input_time_range": {
      "type": "input.timerange",
      "options": {
        "token": "time_token",
        "defaultValue": "-24h@h,now"
      },
      "title": "ì‹œê°„ ë²”ìœ„"
    },
    "input_device": {
      "type": "input.dropdown",
      "options": {
        "items": [
          {
            "label": "ì „ì²´",
            "value": "*"
          },
          {
            "label": "FortiGate",
            "value": "FortiGate*"
          }
        ],
        "defaultValue": "*",
        "token": "device_type"
      },
      "title": "ì¥ë¹„"
    },
    "input_action": {
      "type": "input.dropdown",
      "options": {
        "items": [
          {
            "label": "ì „ì²´",
            "value": "*"
          },
          {
            "label": "í—ˆìš©",
            "value": "accept"
          },
          {
            "label": "ì°¨ë‹¨",
            "value": "deny"
          }
        ],
        "defaultValue": "*",
        "token": "action_filter"
      },
      "title": "ë™ì‘"
    }
  },
  "layout": {
    "type": "absolute",
    "options": {
      "backgroundColor": "#F5F5F5",
      "display": "auto-scale",
      "width": 1280,
      "height": 2170
    },
    "structure": [
      {
        "item": "viz_device_list",
        "type": "block",
        "position": {
          "x": 0,
          "y": 0,
          "w": 1280,
          "h": 300
        }
      },
      {
        "item": "viz_critical_logs",
        "type": "block",
        "position": {
          "x": 0,
          "y": 320,
          "w": 1280,
          "h": 350
        }
      },
      {
        "item": "viz_config_changes",
        "type": "block",
        "position": {
          "x": 0,
          "y": 690,
          "w": 1280,
          "h": 350
        }
      },
      {
        "item": "viz_policy_traffic",
        "type": "block",
        "position": {
          "x": 0,
          "y": 1060,
          "w": 1280,
          "h": 400
        }
      },
      {
        "item": "viz_blocked_detail",
        "type": "block",
        "position": {
          "x": 0,
          "y": 1480,
          "w": 1280,
          "h": 350
        }
      },
      {
        "item": "viz_top_src_ip",
        "type": "block",
        "position": {
          "x": 0,
          "y": 1850,
          "w": 420,
          "h": 300
        }
      },
      {
        "item": "viz_top_dst_ip",
        "type": "block",
        "position": {
          "x": 440,
          "y": 1850,
          "w": 420,
          "h": 300
        }
      },
      {
        "item": "viz_top_services",
        "type": "block",
        "position": {
          "x": 880,
          "y": 1850,
          "w": 400,
          "h": 300
        }
      }
    ],
    "globalInputs": ["input_time_range", "input_device", "input_action"]
  },
  "description": "FortiGate íŠ¸ë˜í”½ ëŒ€ì‹œë³´ë“œ - ì—°ë™ ì¥ë¹„, Critical ë¡œê·¸, ì •ì±…ë³„ íŠ¸ë˜í”½, ì°¨ë‹¨ ìƒì„¸, Top í†µê³„",
  "title": "FortiGate Traffic Dashboard"
}
