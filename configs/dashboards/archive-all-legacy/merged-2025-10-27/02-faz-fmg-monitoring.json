{
  "visualizations": {
    "viz_header": {
      "type": "viz.markdown",
      "options": {
        "markdown": "# FortiAnalyzer & FortiManager Monitoring\n\n**Comprehensive monitoring of FAZ/FMG events and operations**\n\nData Source: `index=fw` | Auto-refresh: 30s"
      }
    },
    "viz_total_events": {
      "type": "splunk.singlevalue",
      "title": "Total Events (24h)",
      "dataSources": {
        "primary": "ds_total_events"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "trendValue": "> primary | seriesByIndex(0) | delta(-2)",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "unit": "events"
      }
    },
    "viz_critical_count": {
      "type": "splunk.singlevalue",
      "title": "Critical Events (24h)",
      "dataSources": {
        "primary": "ds_critical_count"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "backgroundColor": "#DC3545",
        "majorFontSize": 32
      }
    },
    "viz_high_severity": {
      "type": "splunk.singlevalue",
      "title": "High Severity (24h)",
      "dataSources": {
        "primary": "ds_high_severity"
      },
      "options": {
        "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
        "sparklineValues": "> primary | seriesByIndex(0)",
        "numberPrecision": 0,
        "backgroundColor": "#FFA500"
      }
    },
    "viz_event_timeline": {
      "type": "viz.area",
      "title": "Event Timeline by Severity",
      "dataSources": {
        "primary": "ds_timeline"
      },
      "options": {
        "xField": "_time",
        "yField": "count",
        "stackMode": "stacked",
        "seriesColors": ["#DC3545", "#FFA500", "#FFD700", "#32CD32"]
      }
    },
    "viz_top_attackers": {
      "type": "splunk.table",
      "title": "Top Attack Source IPs",
      "dataSources": {
        "primary": "ds_top_attackers"
      },
      "options": {
        "count": 15,
        "showRowNumbers": true,
        "columnFormat": {
          "threat_score": {
            "data": ">number",
            "colorPalette": "divergent"
          }
        }
      }
    },
    "viz_attack_types": {
      "type": "viz.bar",
      "title": "Attack Types Distribution",
      "dataSources": {
        "primary": "ds_attack_types"
      },
      "options": {
        "xField": "attack_type",
        "yField": "count",
        "orientation": "horizontal"
      }
    },
    "viz_geo_distribution": {
      "type": "viz.choropleth.svg",
      "title": "Geographic Distribution",
      "dataSources": {
        "primary": "ds_geo"
      },
      "options": {
        "backgroundColor": "transparent",
        "showLegend": true
      }
    },
    "viz_policy_changes": {
      "type": "splunk.table",
      "title": "Recent FMG Policy Changes",
      "dataSources": {
        "primary": "ds_policy_changes"
      },
      "options": {
        "count": 10,
        "showRowNumbers": false,
        "columnFormat": {
          "change_type": {
            "data": ">table"
          }
        }
      }
    },
    "viz_blocked_traffic": {
      "type": "viz.line",
      "title": "Blocked Traffic Trend",
      "dataSources": {
        "primary": "ds_blocked_trend"
      },
      "options": {
        "xField": "_time",
        "yField": "blocked_count",
        "lineWidth": 2,
        "showMarkers": true
      }
    }
  },
  "dataSources": {
    "ds_total_events": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_critical_count": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h severity=critical\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_high_severity": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h severity=high\n| timechart span=1h count",
        "refresh": "30s"
      }
    },
    "ds_timeline": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h\n| timechart span=30m count by severity",
        "refresh": "30s"
      }
    },
    "ds_top_attackers": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h action=blocked\n| stats count as attacks, dc(dst_ip) as targets, values(attack_name) as attack_types by src_ip\n| eval threat_score=attacks*2 + targets*5\n| sort -threat_score\n| head 15",
        "refresh": "60s"
      }
    },
    "ds_attack_types": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h attack_name=*\n| stats count by attack_name\n| sort -count\n| head 10\n| rename attack_name as attack_type",
        "refresh": "60s"
      }
    },
    "ds_geo": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h src_ip=*\n| iplocation src_ip\n| stats count by Country\n| rename Country as featureId\n| geom geo_countries",
        "refresh": "120s"
      }
    },
    "ds_policy_changes": {
      "type": "ds.search",
      "options": {
        "query": "index=fw sourcetype=fortimanager earliest=-24h\n| search msg IN (\"*policy*create*\", \"*policy*update*\", \"*policy*delete*\")\n| rex field=msg \"(?<change_type>create|update|delete)\"\n| table _time, user, change_type, policy_name, msg\n| sort -_time\n| head 10",
        "refresh": "60s"
      }
    },
    "ds_blocked_trend": {
      "type": "ds.search",
      "options": {
        "query": "index=fw earliest=-24h action=blocked\n| timechart span=30m count as blocked_count",
        "refresh": "30s"
      }
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "latest": "$global_time.latest$",
            "earliest": "$global_time.earliest$"
          }
        }
      }
    }
  },
  "inputs": {
    "input_global_trp": {
      "type": "input.timerange",
      "options": {
        "token": "global_time",
        "defaultValue": "-24h@h,now"
      },
      "title": "Time Range"
    },
    "input_severity": {
      "type": "input.dropdown",
      "options": {
        "items": [
          {
            "label": "All Severities",
            "value": "*"
          },
          {
            "label": "Critical Only",
            "value": "critical"
          },
          {
            "label": "High Only",
            "value": "high"
          },
          {
            "label": "Medium & Above",
            "value": "critical OR high OR medium"
          }
        ],
        "defaultValue": "*",
        "token": "severity_filter"
      },
      "title": "Severity Filter"
    }
  },
  "layout": {
    "type": "grid",
    "options": {
      "width": 1600,
      "height": 1200
    },
    "structure": [
      {
        "item": "viz_header",
        "type": "block",
        "position": {
          "x": 0,
          "y": 0,
          "w": 1600,
          "h": 80
        }
      },
      {
        "item": "viz_total_events",
        "type": "block",
        "position": {
          "x": 0,
          "y": 80,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_critical_count",
        "type": "block",
        "position": {
          "x": 400,
          "y": 80,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_high_severity",
        "type": "block",
        "position": {
          "x": 800,
          "y": 80,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_blocked_traffic",
        "type": "block",
        "position": {
          "x": 1200,
          "y": 80,
          "w": 400,
          "h": 150
        }
      },
      {
        "item": "viz_event_timeline",
        "type": "block",
        "position": {
          "x": 0,
          "y": 230,
          "w": 1600,
          "h": 300
        }
      },
      {
        "item": "viz_top_attackers",
        "type": "block",
        "position": {
          "x": 0,
          "y": 530,
          "w": 800,
          "h": 350
        }
      },
      {
        "item": "viz_attack_types",
        "type": "block",
        "position": {
          "x": 800,
          "y": 530,
          "w": 800,
          "h": 350
        }
      },
      {
        "item": "viz_geo_distribution",
        "type": "block",
        "position": {
          "x": 0,
          "y": 880,
          "w": 800,
          "h": 320
        }
      },
      {
        "item": "viz_policy_changes",
        "type": "block",
        "position": {
          "x": 800,
          "y": 880,
          "w": 800,
          "h": 320
        }
      }
    ]
  },
  "title": "FAZ/FMG Comprehensive Monitoring",
  "description": "FortiAnalyzer and FortiManager monitoring dashboard - No JavaScript required"
}
