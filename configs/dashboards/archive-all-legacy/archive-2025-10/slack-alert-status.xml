<form version="1.1">
  <label>Slack ì•Œë¦¼ ìƒíƒœ ëª¨ë‹ˆí„°ë§</label>
  <description>Slack ì•Œë¦¼ ë°œì†¡ í˜„í™© ë° ì œì–´ (GitHub í…œí”Œë¦¿ ê¸°ë°˜)</description>

  <!-- ì•Œë¦¼ ë°œì†¡ ë‚´ì—­ ê²€ìƒ‰ -->
  <search id="alert_fired">
    <query>
index=_audit action="alert_fired"
| search (savedsearch_name="FAZ_Critical_Alerts" OR savedsearch_name="FMG_Policy_Install" OR savedsearch_name="FMG_Policy_CRUD" OR savedsearch_name="FMG_Admin_Login")
| stats count as fired_count latest(_time) as last_fired by savedsearch_name
| eval last_fired_str=strftime(last_fired, "%Y-%m-%d %H:%M:%S")
| eval status=if(fired_count > 0, "ğŸŸ¢ ì •ìƒ", "âšª ëŒ€ê¸°")
| table savedsearch_name, status, fired_count, last_fired_str
| rename savedsearch_name as "ì•Œë¦¼ ì´ë¦„", status as "ìƒíƒœ", fired_count as "ë°œì†¡ íšŸìˆ˜", last_fired_str as "ë§ˆì§€ë§‰ ë°œì†¡"
    </query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <refresh>5m</refresh>
    <refreshType>delay</refreshType>
  </search>

  <!-- ìƒë‹¨ ìš”ì•½ -->
  <row>
    <panel>
      <title>ğŸ“Š ì•Œë¦¼ ë°œì†¡ ìš”ì•½ (ìµœê·¼ 24ì‹œê°„)</title>
      <single>
        <search base="alert_fired">
          <query>| stats sum(fired_count) as total</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0x6DB7C6","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="underLabel">ì´ ë°œì†¡ ê±´ìˆ˜</option>
      </single>
    </panel>
    <panel>
      <title>âœ… í™œì„± ì•Œë¦¼</title>
      <single>
        <search>
          <query>
| rest /services/saved/searches
| search title="FAZ_*" OR title="FMG_*"
| search disabled=0
| stats count
          </query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="underLabel">ì¼œì§„ ì•Œë¦¼ ìˆ˜</option>
      </single>
    </panel>
  </row>

  <!-- ì•Œë¦¼ë³„ ìƒíƒœ í…Œì´ë¸” -->
  <row>
    <panel>
      <title>ğŸ”” ì•Œë¦¼ ë°œì†¡ ë‚´ì—­</title>
      <table>
        <search base="alert_fired">
          <query>| sort -fired_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>

  <!-- ìµœê·¼ Slack ë©”ì‹œì§€ -->
  <row>
    <panel>
      <title>ğŸ“© ìµœê·¼ ë°œì†¡ëœ ì•Œë¦¼ (ìƒì„¸)</title>
      <table>
        <search>
          <query>
index=_audit action="alert_fired"
| search (savedsearch_name="FAZ_Critical_Alerts" OR savedsearch_name="FMG_Policy_Install" OR savedsearch_name="FMG_Policy_CRUD" OR savedsearch_name="FMG_Admin_Login")
| eval time_str=strftime(_time, "%Y-%m-%d %H:%M:%S")
| table time_str, savedsearch_name, user
| rename time_str as "ì‹œê°„", savedsearch_name as "ì•Œë¦¼ ì´ë¦„", user as "ì‚¬ìš©ì"
| head 20
          </query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <refresh>5m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

  <!-- ì•Œë¦¼ ON/OFF ì•ˆë‚´ -->
  <row>
    <panel>
      <html>
        <h3>âš™ï¸ ì•Œë¦¼ ì œì–´ ë°©ë²•</h3>
        <p><b>Settings â†’ Searches, reports, and alerts</b> ì—ì„œ ê° ì•Œë¦¼ì˜ <b>Enable</b> ì²´í¬ë°•ìŠ¤ë¡œ ON/OFF</p>
        <hr/>
        <h4>ì•Œë¦¼ ëª©ë¡:</h4>
        <ul>
          <li><b>FAZ_Critical_Alerts</b> - í¬ë¦¬í‹°ì»¬ ì´ë²¤íŠ¸</li>
          <li><b>FMG_Policy_Install</b> - ì •ì±… ì„¤ì¹˜</li>
          <li><b>FMG_Policy_CRUD</b> - ì„¤ì • ë³€ê²½</li>
          <li><b>FMG_Admin_Login</b> - ê´€ë¦¬ì ë¡œê·¸ì¸</li>
        </ul>
      </html>
    </panel>
  </row>

</form>
