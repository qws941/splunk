# Slack Alert Action Configuration
# For Fortinet Device Management Dashboard
#
# This file configures the Splunk Slack alert action plugin.
# Deploy to: $SPLUNK_HOME/etc/apps/fortigate/local/alert_actions.conf
#
# Alternative: Configure via Splunk Web UI
#   Settings ‚Üí Alert Actions ‚Üí Slack ‚Üí Configure Slack

# ==========================================
# Slack Bot Configuration
# ==========================================
[slack]
# Slack Bot User OAuth Token (required)
# Get from: https://api.slack.com/apps ‚Üí Your App ‚Üí OAuth & Permissions
# Format: xoxb-XXXXXXXXXXXX-XXXXXXXXXXXX-XXXXXXXXXXXXXXXXXXXXXXXX
param.token = xoxb-YOUR-BOT-TOKEN-HERE

# Default channel (can be overridden per alert)
# Use Channel ID (recommended) or channel name with #
param.channel = #C09DSD6JH2Q

# Bot display name in Slack
param.from_user = Splunk FortiGate Alert

# Icon for bot messages (emoji or custom image URL)
param.icon_emoji = :fire:
# Alternative: param.icon_url = https://your-domain.com/splunk-icon.png

# Message format (markdown or plain_text)
param.message_format = markdown

# Enable link names (convert @user and #channel to clickable links)
param.link_names = 1

# ==========================================
# Advanced Options
# ==========================================

# Attachment color (default: good=green, warning=yellow, danger=red)
# This can be overridden per alert with param.attachment parameter
# param.attachment = danger

# Timeout for Slack API calls (seconds)
# param.timeout = 10

# SSL certificate verification
# param.verify_ssl = 1

# ==========================================
# Usage in Saved Searches
# ==========================================
# Add these lines to your saved search:
#
# action.slack = 1
# action.slack.param.channel = C09DSD6JH2Q
# action.slack.param.message = *Alert Title*\n\n*Field:* $result.field$
#
# Example with priority-based formatting:
# action.slack.param.message = *üñ•Ô∏è Device Event*\n\n*Device:* $result.devname$\n*Status:* $result.status$\n*Count:* $result.event_count$\n\n```$result.logdesc$```

# ==========================================
# Message Formatting Guide
# ==========================================
#
# Markdown Syntax:
# - *Bold text* ‚Üí Bold
# - _Italic text_ ‚Üí Italic
# - ~Strikethrough~ ‚Üí Strikethrough
# - `Code text` ‚Üí Inline code
# - ```Multi-line code``` ‚Üí Code block
# - <URL|Link text> ‚Üí Hyperlink
# - <URL> ‚Üí Auto-linked URL
#
# Special Characters:
# - \n ‚Üí Newline
# - ‚Ä¢ ‚Üí Bullet point
# - ‚îÄ ‚Üí Horizontal line
#
# Emojis:
# - :fire: ‚Üí üî•
# - :warning: ‚Üí ‚ö†Ô∏è
# - :white_check_mark: ‚Üí ‚úÖ
# - :x: ‚Üí ‚ùå
# - Full list: https://www.webfx.com/tools/emoji-cheat-sheet/

# ==========================================
# Deployment Steps
# ==========================================
#
# Option 1: File-based Configuration (Recommended)
# -------------------------------------------------
# 1. Edit this file and set param.token to your Slack Bot Token
# 2. Copy to Splunk:
#    sudo cp alert_actions.conf $SPLUNK_HOME/etc/apps/fortigate/local/
# 3. Restart Splunk:
#    sudo $SPLUNK_HOME/bin/splunk restart
# 4. Verify:
#    $SPLUNK_HOME/bin/splunk btool alert_actions list slack
#
# Option 2: Web UI Configuration
# -------------------------------------------------
# 1. Go to: Settings ‚Üí Alert Actions
# 2. Find "Slack" and click "Configure Slack"
# 3. Enter Slack Bot Token
# 4. Set default channel
# 5. Click "Save"
# 6. Test with: Settings ‚Üí Searches ‚Üí Run test alert

# ==========================================
# Required Slack OAuth Scopes
# ==========================================
# Your Slack App must have these Bot Token Scopes:
#
# - chat:write              (Required) Send messages
# - chat:write.public       (Optional) Send to public channels without invitation
# - channels:read           (Optional) Read public channel information
# - groups:read             (Optional) Read private channel information
#
# Configure at: https://api.slack.com/apps ‚Üí Your App ‚Üí OAuth & Permissions

# ==========================================
# Troubleshooting
# ==========================================
#
# Issue: "invalid_auth" error
# Solution: Verify bot token is correct (starts with xoxb-)
#
# Issue: "channel_not_found" error
# Solution: Invite bot to channel: /invite @YourBot to #channel
#
# Issue: "not_in_channel" error
# Solution: Bot must be a member of the channel
#
# Issue: Messages not formatted
# Solution: Check param.message_format = markdown
#
# Check Splunk logs:
# tail -f $SPLUNK_HOME/var/log/splunk/splunkd.log | grep -i slack

# ==========================================
# Testing
# ==========================================
# Test from command line:
#
# 1. Create test alert:
#    cat > /tmp/test.json << 'EOF'
#    {"devname": "FG-TEST", "status": "Active", "event_count": 99}
#    EOF
#
# 2. Run saved search manually:
#    $SPLUNK_HOME/bin/splunk search "| savedsearch Fortinet_Device_Events_Alert"
#
# 3. Check Slack channel for message

# ==========================================
# Channel ID Reference
# ==========================================
# All alerts sent to: C09DSD6JH2Q (#splunk-alerts)
#
# To get channel ID:
# 1. Right-click channel in Slack
# 2. Select "Copy link"
# 3. Extract ID from URL: /archives/C09DSD6JH2Q
#
# Or use Slack API:
# curl -X GET "https://slack.com/api/conversations.list" \
#   -H "Authorization: Bearer SLACK_BOT_TOKEN_PLACEHOLDER" \
#   | grep -A 5 "splunk-alerts"
