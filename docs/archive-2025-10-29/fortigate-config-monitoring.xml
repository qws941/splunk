<!-- FortiGate Configuration Monitoring Dashboard v2.0
     Purpose: Comprehensive operational monitoring for FortiGate devices
     Created: 2025-10-29
     Data Source: index=fw (FortiAnalyzer logs via Splunk HEC)

     Features:
     - Configuration changes tracking (CLI/GUI)
     - Critical system events monitoring
     - HA events with severity levels
     - Time-based trend analysis
-->

<form version="1.1">
  <label>FortiGate Configuration Monitoring v2.0</label>
  <description>Operational monitoring for FortiGate devices - Configuration changes, Critical events, HA status</description>

  <!-- Time Picker -->
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_range">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>

  <!-- Row 1: Statistics Summary -->
  <row>
    <panel>
      <title>Configuration Changes (Last 24h)</title>
      <single>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system
    (logid=0100044546 OR logid=0100044547)
    (cfgpath="firewall.policy*" OR cfgpath="firewall.address*" OR cfgpath="firewall.service*" OR cfgpath="system.interface*" OR cfgpath="router.*" OR cfgpath="vpn.*")
| stats count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0x6DB7C6","0xF7BC38","0xF58F39","0xD93F3C"]</option>
        <option name="rangeValues">[0,10,50,100]</option>
        <option name="underLabel">Total Changes</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Critical Events (Last 24h)</title>
      <single>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system level=critical
    logid!=0100044546 logid!=0100044547 logid!=010032021
| search NOT msg="*Update Fail*" NOT msg="*Login Fail*"
| stats count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0xF7BC38","0xD93F3C"]</option>
        <option name="rangeValues">[0,5]</option>
        <option name="underLabel">Critical Issues</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>HA Events (Last 24h)</title>
      <single>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system logid=0103*
| stats count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65A637","0x6DB7C6","0xF7BC38","0xD93F3C"]</option>
        <option name="rangeValues">[0,3,10]</option>
        <option name="underLabel">HA Events</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- Row 2: Recent Configuration Changes -->
  <row>
    <panel>
      <title>Recent Configuration Changes (Top 50)</title>
      <table>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system
    (logid=0100044546 OR logid=0100044547)
    (cfgpath="firewall.policy*" OR cfgpath="firewall.address*" OR cfgpath="firewall.service*" OR cfgpath="system.interface*" OR cfgpath="router.*" OR cfgpath="vpn.*")
| dedup devname, user, cfgpath
| eval device = devname
| eval admin = coalesce(user, "system")
| eval access_method = case(logid="0100044546", "CLI", logid="0100044547", "GUI", 1=1, coalesce(ui, "N/A"))
| eval config_path = cfgpath
| eval action_type = coalesce(action, "Modified")
| eval object_name = coalesce(cfgobj, "-")
| eval details = case(isnull(cfgattr), "No details", 1=1, substr(cfgattr, 1, 100))
| table _time, device, admin, access_method, action_type, config_path, object_name, details
| sort -_time
| head 50</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <format type="color" field="access_method">
          <colorPalette type="map">{"CLI":"#F7BC38","GUI":"#6DB7C6"}</colorPalette>
        </format>
        <format type="color" field="action_type">
          <colorPalette type="map">{"Modified":"#F7BC38","Created":"#65A637","Deleted":"#D93F3C"}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 3: Configuration Change Trends -->
  <row>
    <panel>
      <title>Configuration Changes Over Time</title>
      <chart>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system
    (logid=0100044546 OR logid=0100044547)
| eval access_method = case(logid="0100044546", "CLI", logid="0100044547", "GUI", 1=1, "Other")
| timechart span=1h count by access_method</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Number of Changes</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[0xF7BC38,0x6DB7C6,0xD93F3C]</option>
      </chart>
    </panel>

    <panel>
      <title>Changes by Configuration Path</title>
      <chart>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system
    (logid=0100044546 OR logid=0100044547)
| eval config_area = case(
    match(cfgpath, "firewall.policy"), "Firewall Policy",
    match(cfgpath, "firewall.address"), "Address Objects",
    match(cfgpath, "firewall.service"), "Service Objects",
    match(cfgpath, "system.interface"), "Interfaces",
    match(cfgpath, "router"), "Routing",
    match(cfgpath, "vpn"), "VPN",
    1=1, "Other")
| stats count by config_area</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- Row 4: Critical Events -->
  <row>
    <panel>
      <title>Critical System Events (Excluding Update/Login Failures)</title>
      <table>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system level=critical
    logid!=0100044546 logid!=0100044547 logid!=010032021
| search NOT msg="*Update Fail*" NOT msg="*Login Fail*"
| dedup devname, logid
| eval device = devname
| eval log_id = logid
| eval severity = level
| eval description = coalesce(logdesc, msg, "No details available")
| table _time, device, log_id, severity, description
| sort -_time
| head 50</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <format type="color" field="severity">
          <colorPalette type="map">{"critical":"#D93F3C"}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 5: Critical Events Trend -->
  <row>
    <panel>
      <title>Critical Events Over Time</title>
      <chart>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system level=critical
    logid!=0100044546 logid!=0100044547 logid!=010032021
| search NOT msg="*Update Fail*" NOT msg="*Login Fail*"
| timechart span=1h count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Critical Events Count</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.seriesColors">[0xD93F3C]</option>
      </chart>
    </panel>
  </row>

  <!-- Row 6: HA Events -->
  <row>
    <panel>
      <title>High Availability (HA) Events</title>
      <table>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system logid=0103*
| dedup devname, logid, level
| eval device = devname
| eval log_id = logid
| eval severity = level
| eval description = coalesce(logdesc, msg, "HA event occurred")
| eval icon = case(level="critical", "ðŸ”´", level="error", "ðŸŸ ", level="warning", "ðŸŸ¡", 1=1, "ðŸ”µ")
| table _time, icon, device, log_id, severity, description
| sort -_time
| head 50</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <format type="color" field="severity">
          <colorPalette type="map">{"critical":"#D93F3C","error":"#F58F39","warning":"#F7BC38","info":"#6DB7C6"}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 7: HA Events Trends -->
  <row>
    <panel>
      <title>HA Events by Severity</title>
      <chart>
        <search>
          <query>index=fw earliest=$time_range.earliest$ latest=$time_range.latest$ type=event subtype=system logid=0103*
| eval severity = level
| timechart span=1h count by severity</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">HA Events Count</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[0xD93F3C,0xF58F39,0xF7BC38,0x6DB7C6]</option>
      </chart>
    </panel>
  </row>

</form>
