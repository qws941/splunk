# FortiGate Shared Macros
# Purpose: Centralized configuration for all alerts
# Last Updated: 2025-11-03

# Index Configuration
[fortigate_index]
definition = index=fw
iseval = 0

# Time Range Macros
[baseline_time_range]
definition = earliest=-8d latest=-1d
iseval = 0

[realtime_time_range]
definition = earliest=-10m latest=now
iseval = 0

# Threshold Macros
[cpu_high_threshold]
definition = 80
iseval = 0

[memory_high_threshold]
definition = 85
iseval = 0

[baseline_anomaly_multiplier]
definition = 2
iseval = 0

# ============================================================
# LogID Group Macros (모든 Alert 포함)
# ============================================================

# Alert 001: Configuration Change
[logids_config_change]
definition = (logid=0100044546 OR logid=0100044547)
iseval = 0

# Alert 001: FMG Install (Exclude from Config Change alerts)
[logids_fmg_install]
definition = (logid=0100044548 OR logid=0100044549 OR logid=0100044550)
iseval = 0

# Alert 002: VPN Tunnel
[logids_vpn_tunnel]
definition = (logid=0101037124 OR logid=0101037131 OR logid=0101037134)
iseval = 0

# Alert 006: CPU/Memory Baseline Anomaly
[logids_cpu_memory]
definition = (logid=0104043001 OR logid=0104043002)
iseval = 0

# Alert 007: Hardware Failure
[logids_hardware_failure]
definition = (logid=0103040001 OR logid=0103040002 OR logid=0103040003)
iseval = 0

# Alert 008: HA State Change
[logids_ha_state]
definition = (logid=0100020010 OR logid=0104043544 OR logid=0104043545)
iseval = 0

# Alert 010: Resource Limit
[logids_resource_limit]
definition = (logid=0104043003 OR logid=0104043004)
iseval = 0

# Alert 011: Admin Login Failure
[logids_admin_login]
definition = (logid=0105032003 OR logid=0105032004 OR logid=0105032005 OR logid=0105043001)
iseval = 0

# Alert 012: Link Monitor
[logids_link_monitor]
definition = (logid=0100032001 OR logid=0100020007)
iseval = 0

# Alert 013: SSL VPN Brute Force
[logids_ssl_vpn_failed]
definition = (logid=0101039424 OR logid=0101039426 OR logid=0100032003)
iseval = 0

# Alert 015: Abnormal Traffic Spike
[logids_traffic]
definition = (logid=0000000013 OR logid=0000000014 OR logid=0000000020)
iseval = 0

# Alert 016: System Reboot
[logids_system_reboot]
definition = (logid=0100032002 OR logid=0100032003 OR logid=0100032004)
iseval = 0

# Alert 017: License Expiry Warning
[logids_license_warning]
definition = (logid=0104043009 OR logid=0104043010 OR logid=0100032011)
iseval = 0

# ============================================================
# Lookup Enrichment Macro
# ============================================================

[enrich_with_logid_lookup]
definition = lookup fortigate_logid_lookup logid OUTPUT category,severity,notify_slack,notify_email,description as logid_description,available_fields,field_coverage
iseval = 0

# ============================================================
# Slack Channel Configuration (Reference Only)
# ============================================================
# NOTE: action.slack.param.channel cannot use macros directly
# These are for documentation and reference only

[slack_channel_security]
definition = #security-firewall-alert
iseval = 0

[slack_channel_network]
definition = #network-alerts
iseval = 0

[slack_channel_infrastructure]
definition = #infra-alerts
iseval = 0

[slack_channel_operations]
definition = #ops-alerts
iseval = 0

# ============================================================
# Common Alert Configuration Templates
# ============================================================
# NOTE: Splunk does NOT support macros for savedsearch parameters.
# These are documentation templates for consistent configuration.
# Copy-paste these blocks into savedsearches.conf for each alert.

# ------------------------------
# Template 1: Standard Real-time Scheduling (rt-10m)
# Used by: 001, 002, 007, 008, 010, 011, 012 (7 alerts)
# ------------------------------
# is_scheduled = 1
# realtime_schedule = 1
# dispatch.earliest_time = rt-10m
# dispatch.latest_time = rt

# ------------------------------
# Template 2: Extended Real-time Scheduling (rt-35m)
# Used by: 006 (CPU/Memory Anomaly only)
# ------------------------------
# is_scheduled = 1
# realtime_schedule = 1
# dispatch.earliest_time = rt-35m
# dispatch.latest_time = rt

# ------------------------------
# Template 3: Common Alert Configuration
# Used by: ALL 8 alerts
# ------------------------------
# alert.track = 1
# alert.condition = search count > 0

# ------------------------------
# Template 4: Severity 4 (Medium-High)
# Used by: 001, 006, 008, 012 (4 alerts)
# ------------------------------
# alert.severity = 4

# ------------------------------
# Template 5: Severity 5 (Critical)
# Used by: 002, 007, 010, 011 (4 alerts)
# ------------------------------
# alert.severity = 5

# ------------------------------
# Template 6: Slack Action Configuration
# Used by: ALL 8 alerts
# ------------------------------
# actions = slack
# action.slack = 1
# action.slack.param.channel = #security-firewall-alert
# action.slack.param.message = [Custom message per alert]
# action.slack.param.fields = [Custom fields per alert]

# ------------------------------
# Template 7: Standard Suppression (24h expiry)
# Used by: 001, 002, 006, 008, 010, 011, 012 (7 alerts)
# ------------------------------
# alert.suppress = 1
# alert.suppress.period = [5m/10m/15m/30m per alert]
# alert.suppress.fields = [Custom fields per alert]
# alert.expires = 24h

# ------------------------------
# Template 8: Extended Suppression (48h expiry)
# Used by: 007 (Hardware Failure only)
# ------------------------------
# alert.suppress = 1
# alert.suppress.period = 30m
# alert.suppress.fields = device,hardware_type
# alert.expires = 48h

# ------------------------------
# Template 9: Performance Optimization
# Used by: ALL 8 alerts
# ------------------------------
# dispatch.rt_backfill = 1
# auto_summarize = 0

# ============================================================
# Suppression Period Reference
# ============================================================
# 5m:  001_Config_Change, 011_Admin_Login_Failed
# 10m: 002_VPN_Tunnel_Down, 008_HA_State_Change, 010_Resource_Limit, 012_Interface_State_Change
# 15m: 006_CPU_Memory_Anomaly
# 30m: 007_Hardware_Failure

# ============================================================
# Alert Severity Reference
# ============================================================
# Severity 4 (Medium-High):
#   - 001_Config_Change
#   - 006_CPU_Memory_Anomaly
#   - 008_HA_State_Change
#   - 012_Interface_State_Change
#
# Severity 5 (Critical):
#   - 002_VPN_Tunnel_Down
#   - 007_Hardware_Failure
#   - 010_Resource_Limit
#   - 011_Admin_Login_Failed
