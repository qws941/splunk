# =============================================================================
# Cloudflare Workers Configuration - FAZ to Splunk HEC Integration
# =============================================================================
#
# Documentation: https://developers.cloudflare.com/workers/
#
# =============================================================================

name = "faz-splunk-hec-integration"
main = "src/worker.js"
compatibility_date = "2025-01-14"
workers_dev = true

# Account ID (get from Cloudflare dashboard)
# account_id = "your_account_id_here"

# Route configuration (optional - for custom domain)
# route = "https://faz-splunk.jclee.me/*"
# zone_id = "your_zone_id_here"

# =============================================================================
# Cron Triggers - Scheduled Execution
# =============================================================================
# Runs every 1 minute to collect FortiAnalyzer events
[triggers]
crons = ["* * * * *"]  # Every minute

# =============================================================================
# Environment Variables (Non-Secret)
# =============================================================================
[vars]
NODE_ENV = "production"
TZ = "Asia/Seoul"
LOG_LEVEL = "info"

# Polling configuration
POLLING_INTERVAL = "60000"
EVENT_BATCH_SIZE = "100"

# Alert thresholds
ALERT_THRESHOLD_CRITICAL = "10"
ALERT_THRESHOLD_HIGH = "50"

# Splunk Index (HEC Production Standard)
SPLUNK_INDEX_FORTIGATE = "fortianalyzer"

# Monitoring
METRICS_ENABLED = "true"
HEALTH_CHECK_ENABLED = "true"

# =============================================================================
# Secrets (Use wrangler secret commands)
# =============================================================================
# Deploy secrets using:
#
# wrangler secret put FAZ_HOST
# wrangler secret put FAZ_USERNAME
# wrangler secret put FAZ_PASSWORD
# wrangler secret put SPLUNK_HEC_HOST
# wrangler secret put SPLUNK_HEC_TOKEN
# wrangler secret put SLACK_BOT_TOKEN
# wrangler secret put SLACK_CHANNEL
#
# Required secrets:
# - FAZ_HOST: FortiAnalyzer hostname (e.g., fortianalyzer.example.com)
# - FAZ_PORT: FortiAnalyzer HTTPS port (default: 443)
# - FAZ_USERNAME: FortiAnalyzer admin username
# - FAZ_PASSWORD: FortiAnalyzer admin password
# - SPLUNK_HEC_HOST: Splunk hostname (e.g., splunk.jclee.me)
# - SPLUNK_HEC_PORT: Splunk HEC port (default: 8088)
# - SPLUNK_HEC_TOKEN: Splunk HEC token
# - SPLUNK_HEC_SCHEME: https
# - SLACK_BOT_TOKEN: Slack Bot token (xoxb-<example>)
# - SLACK_CHANNEL: Slack channel for alerts (e.g., splunk-alerts)
# - SLACK_ENABLED: Enable Slack notifications (true/false)
#
# =============================================================================

# =============================================================================
# Resource Limits
# =============================================================================
# Workers limits:
# - CPU time: 50ms (free), 50ms-30s (paid)
# - Memory: 128MB
# - Request size: 100MB
# - Response size: 100MB
#
# For large log volumes, consider Cloudflare Workers Unbound ($0.50/million requests)
# =============================================================================

# Uncomment for Unbound Workers (longer CPU time)
# [limits]
# cpu_ms = 30000  # 30 seconds max CPU time

# =============================================================================
# Build Configuration
# =============================================================================
[build]
command = "npm install"

# =============================================================================
# Development
# =============================================================================
# wrangler dev - Start local dev server
# wrangler tail - Stream logs from deployed worker
# wrangler publish - Deploy to production
#
# =============================================================================
