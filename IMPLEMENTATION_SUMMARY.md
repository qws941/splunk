# π›΅οΈ Fortinet λ°©ν™”λ²½ μ •μ±… ν™•μΈ λ„κµ¬ κµ¬ν„ μ™„λ£

## π“‹ κµ¬ν„ ν„ν™©

### β… μ™„λ£λ κΈ°λ¥λ“¤

#### 1. **λ°©ν™”λ²½ μ •μ±… ν™•μΈ μ‹μ¤ν…**
- **μ¶λ°μ§€ β†’ λ©μ μ§€ νΈλν”½ λ¶„μ„**: μ‚¬μ©μκ°€ μ…λ ¥ν• IP μ£Όμ†μ™€ ν¬νΈμ— λ€ν•΄ ν—μ©/μ°¨λ‹¨ μ—¬λ¶€ μ‹¤μ‹κ°„ ν™•μΈ
- **μ •μ±… ν‰κ°€ μ—”μ§„**: FortiGateμ μ •μ±… ν‰κ°€ μμ„λ¥Ό μ •ν™•ν λ°μν• μ•κ³ λ¦¬μ¦ κµ¬ν„
- **μ£Όμ† κ°μ²΄ ν•΄μ„**: FortiManagerμ μ£Όμ† κ°μ²΄ μλ™ ν•΄μ„ λ° IP/μ„λΈλ„· λ§¤μΉ­
- **μ„λΉ„μ¤ κ°μ²΄ ν•΄μ„**: ν¬νΈ/ν”„λ΅ν† μ½ μ„λΉ„μ¤ κ°μ²΄ μλ™ ν•΄μ„

#### 2. **FortiManager μ§μ ‘ μ—°λ™**
```javascript
// ν™•μ¥λ FortiManager μ»¤λ„¥ν„° λ©”μ„λ“
- queryPoliciesForVerification(): μ •μ±… κ²€μƒ‰
- evaluatePolicyMatch(): μ •μ±… ν‰κ°€
- resolveAddressObject(): μ£Όμ† κ°μ²΄ ν•΄μ„
- resolveServiceObject(): μ„λΉ„μ¤ κ°μ²΄ ν•΄μ„
- getManagedDevices(): κ΄€λ¦¬ μ¥λΉ„ λ©λ΅
- ipMatchesAddress(): IP λ§¤μΉ­ λ΅μ§
- portMatchesService(): ν¬νΈ λ§¤μΉ­ λ΅μ§
```

#### 3. **μ›Ή κΈ°λ° μ‚¬μ©μ μΈν„°νμ΄μ¤**
- **μ§κ΄€μ μΈ μ…λ ¥ νΌ**: μ¶λ°μ§€/λ©μ μ§€ IP, ν”„λ΅ν† μ½, ν¬νΈ μ…λ ¥
- **μ‹¤μ‹κ°„ κ²€μ¦**: IP μ£Όμ† ν•μ‹ μ ν¨μ„± μ‹¤μ‹κ°„ κ²€μ‚¬
- **λ°μ‘ν• λ””μμΈ**: λ¨λ°”μΌ μΉν™”μ  μΈν„°νμ΄μ¤
- **μ‹κ°μ  ν”Όλ“λ°±**: ν—μ©(β…)/μ°¨λ‹¨(β) κ²°κ³Όλ¥Ό μƒ‰μƒκ³Ό μ•„μ΄μ½μΌλ΅ κµ¬λ¶„
- **κ³ κΈ‰ μµμ…**: μ¥λΉ„/VDOM μ„ νƒ, μ„λΉ„μ¤ κ°μ²΄ μ§μ ‘ μ…λ ¥

#### 4. **RESTful API μ—”λ“ν¬μΈνΈ**
```http
GET  /health                    # μ„λ²„ μƒνƒ ν™•μΈ
POST /api/policy/verify         # μ •μ±… ν™•μΈ (ν•µμ‹¬ κΈ°λ¥)
GET  /api/fortimanager/devices  # κ΄€λ¦¬ μ¥λΉ„ λ©λ΅
GET  /api/policy/:policyId      # νΉμ • μ •μ±… μƒμ„Έ μ •λ³΄
POST /api/fortimanager/test     # μ—°κ²° ν…μ¤νΈ
```

#### 5. **λ‹¤μ¤‘ μ¥λΉ„ λ° VDOM μ§€μ›**
- **80+ FortiGate μ¥λΉ„**: μ „μ²΄ λλ” νΉμ • μ¥λΉ„ μ„ νƒ κ°€λ¥
- **Multi-VDOM**: κ°€μƒ λ„λ©”μΈλ³„ μ •μ±… ν™•μΈ μ§€μ›
- **μ‹¤μ‹κ°„ μ¥λΉ„ μƒνƒ**: μ—°κ²°λ FortiGate μ¥λΉ„ μƒνƒ ν‘μ‹

## π—οΈ μ‹μ¤ν… μ•„ν‚¤ν…μ²

### κµ¬ν„λ μ»΄ν¬λ„νΈ
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                     μ›Ή λΈλΌμ°μ €                                    β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚           policy-verification-web.html                    β”‚  β”‚
β”‚  β”‚  β€Ά μ‚¬μ©μ μΈν„°νμ΄μ¤                                         β”‚  β”‚
β”‚  β”‚  β€Ά μ‹¤μ‹κ°„ μ ν¨μ„± κ²€μ‚¬                                        β”‚  β”‚
β”‚  β”‚  β€Ά κ²°κ³Ό μ‹κ°ν™”                                              β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                       β”‚ HTTPS/JSON
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                Policy Verification Server                       β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β”‚  β”‚           policy-verification-server.js                 β”‚    β”‚
β”‚  β”‚  β€Ά Express.js μ›Ή μ„λ²„                                    β”‚    β”‚
β”‚  β”‚  β€Ά RESTful API μ—”λ“ν¬μΈνΈ                                β”‚    β”‚
β”‚  β”‚  β€Ά μ”μ²­ μ²λ¦¬ λ° κ²€μ¦                                      β”‚    β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                       β”‚ JSON-RPC
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              FortiManager Direct Connector                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β”‚  β”‚        fortimanager-direct-connector.js                 β”‚    β”‚
β”‚  β”‚  β€Ά μ •μ±… μΏΌλ¦¬ λ° ν‰κ°€ μ—”μ§„                                 β”‚    β”‚
β”‚  β”‚  β€Ά μ£Όμ†/μ„λΉ„μ¤ κ°μ²΄ ν•΄μ„                                  β”‚    β”‚
β”‚  β”‚  β€Ά IP/ν¬νΈ λ§¤μΉ­ λ΅μ§                                      β”‚    β”‚
β”‚  β”‚  β€Ά μ¥λΉ„ κ΄€λ¦¬ κΈ°λ¥                                         β”‚    β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                       β”‚ JSON-RPC 2.0
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    FortiManager                                 β”‚
β”‚  β€Ά μ •μ±… κ΄€λ¦¬                                                    β”‚
β”‚  β€Ά μ¥λΉ„ κ΄€λ¦¬ (80+ FortiGate)                                    β”‚
β”‚  β€Ά Multi-VDOM μ§€μ›                                             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π”§ μ‚¬μ© λ°©λ²•

### 1. μ„λ²„ μ‹μ‘
```bash
# μμ΅΄μ„± μ„¤μΉ
npm install

# μ„λ²„ μ‹¤ν–‰
npm run policy-server

# κ°λ° λ¨λ“ (μλ™ μ¬μ‹μ‘)
npm run policy-server:dev
```

### 2. μ›Ή μΈν„°νμ΄μ¤ μ ‘κ·Ό
```
λΈλΌμ°μ €: http://localhost:3001
```

### 3. API μ‚¬μ© μμ‹
```bash
# μ •μ±… ν™•μΈ
curl -X POST http://localhost:3001/api/policy/verify \
  -H "Content-Type: application/json" \
  -d '{
    "sourceIP": "192.168.1.100",
    "destIP": "10.0.0.100",
    "protocol": "TCP",
    "port": 80
  }'

# μ‘λ‹µ μμ‹
{
  "matches": false,
  "policy": null,
  "result": "BLOCK",
  "evaluation": {
    "sourceIP": "192.168.1.100",
    "destIP": "10.0.0.100",
    "port": 80,
    "protocol": "TCP",
    "reason": "No matching policy - default deny"
  }
}
```

## π― ν•µμ‹¬ κΈ°λ¥ μ‹μ—°

### β… ν…μ¤νΈ μ™„λ£λ κΈ°λ¥λ“¤

#### 1. **IP λ§¤μΉ­ λ΅μ§**
```javascript
// μ„λΈλ„· λ§¤μΉ­
192.168.1.100 matches 192.168.1.0/24: β… true
192.168.2.100 matches 192.168.1.0/24: β false

// μ •ν™•ν• λ§¤μΉ­
10.0.0.1 matches 10.0.0.1: β… true

// Any λ§¤μΉ­
1.2.3.4 matches 0.0.0.0/0: β… true
```

#### 2. **ν¬νΈ λ§¤μΉ­ λ΅μ§**
```javascript
// μ •ν™•ν• ν¬νΈ
Port 80/TCP matches TCP:80: β… true

// ν¬νΈ λ²”μ„
Port 443/TCP matches TCP:80-443: β… true

// Any ν”„λ΅ν† μ½/ν¬νΈ
Port 22/TCP matches any:any: β… true
```

#### 3. **API μ—”λ“ν¬μΈνΈ**
```bash
# μ„λ²„ μƒνƒ: β… healthy
curl http://localhost:3001/health
{
  "status": "healthy",
  "timestamp": "2025-09-25T15:30:45.656Z",
  "fmgConnected": true
}

# μ •μ±… ν™•μΈ: β… μ‘λ™
curl -X POST http://localhost:3001/api/policy/verify [...]
# μ •ν™•ν• κ²°κ³Ό λ°ν™ ν™•μΈ
```

## π€ μ΄μ ν™κ²½ λ°°ν¬

### ν™κ²½ λ³€μ μ„¤μ •
```bash
export FMG_HOST=fortimanager.jclee.me
export FMG_USERNAME=admin
export FMG_PASSWORD=your_password
export FMG_ADOM=Global
export PORT=3001
```

### Docker λ°°ν¬
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY src/ ./src/
EXPOSE 3001
CMD ["npm", "run", "policy-server"]
```

### ν”„λ΅λ•μ… κ³ λ ¤μ‚¬ν•­
```yaml
λ³΄μ•:
  - HTTPS/TLS κµ¬μ„±
  - μΈμ¦/κ¶ν• μ‹μ¤ν…
  - API μ ‘κ·Ό μ ν•
  - λ΅κ·Έ λ³΄μ• (IP λ§μ¤ν‚Ή)

λ¨λ‹ν„°λ§:
  - Splunk μ—°λ™ μ™„λ£
  - μ‹¤μ‹κ°„ λ©”νΈλ¦­
  - μ¤λ¥ μ•λ¦Ό (Slack)
  - μ„±λ¥ λ¨λ‹ν„°λ§

ν™•μ¥μ„±:
  - λ΅λ“ λ°Έλ°μ„ κµ¬μ„±
  - Redis μΊμ‹±
  - ν΄λ¬μ¤ν„°λ§
  - λ°±μ—…/λ³µκµ¬ μ μ°¨
```

## π“ κµ¬ν„ μ„±κ³Ό

### β… μ”κµ¬μ‚¬ν•­ λ‹¬μ„±λ„

| μ”κµ¬μ‚¬ν•­ | κµ¬ν„ μƒνƒ | μ„¤λ… |
|---------|----------|------|
| μ¶λ°μ§€ β†’ λ©μ μ§€ μ…λ ¥ | β… μ™„λ£ | μ›Ή μΈν„°νμ΄μ¤ λ° API μ κ³µ |
| μ°¨λ‹¨/ν—μ© μ—¬λ¶€ νλ‹¨ | β… μ™„λ£ | μ •μ±… ν‰κ°€ μ—”μ§„ κµ¬ν„ |
| μ •μ±… μ μ© μƒνƒ | β… μ™„λ£ | λ§¤μΉ­λ μ •μ±… μ •λ³΄ ν‘μ‹ |
| λ‹¤μ¤‘ μ¥λΉ„ μ§€μ› | β… μ™„λ£ | 80+ FortiGate μ¥λΉ„ μ§€μ› |
| λ‹¤μΆ… VDOM μ§€μ› | β… μ™„λ£ | Virtual Domainλ³„ μ •μ±… ν™•μΈ |

### π― μ¶”κ°€ κµ¬ν„λ κΈ°λ¥λ“¤
- **μ‹¤μ‹κ°„ μ ν¨μ„± κ²€μ‚¬**: IP μ£Όμ† ν•μ‹ κ²€μ¦
- **κ³ κΈ‰ ν•„ν„°λ§**: μ¥λΉ„/VDOM/μ„λΉ„μ¤ κ°μ²΄ μ„ νƒ
- **μƒμ„Έ κ²°κ³Ό ν‘μ‹**: λ§¤μΉ­λ μ •μ±…μ λ¨λ“  μ„¤μ •κ°’
- **λ¨λ°”μΌ μΉν™”μ **: λ°μ‘ν• μ›Ή λ””μμΈ
- **RESTful API**: λ‹¤λ¥Έ μ‹μ¤ν…κ³Όμ μ—°λ™ μ§€μ›

## π“ κµ¬ν„λ νμΌ λ©λ΅

```
src/
β”β”€β”€ fortimanager-direct-connector.js    # ν™•μ¥λ FMG μ»¤λ„¥ν„°
β”β”€β”€ policy-verification-server.js       # Express μ›Ή μ„λ²„
β”β”€β”€ policy-verification-web.html        # μ›Ή μΈν„°νμ΄μ¤
β”β”€β”€ test-policy-verification.js         # ν…μ¤νΈ μ¤ν¬λ¦½νΈ
β””β”€β”€ policy-verification-demo.js         # λ°λ¨ μ¤ν¬λ¦½νΈ

λ¬Έμ„/
β”β”€β”€ POLICY_VERIFICATION_README.md       # μƒμ„Έ μ‚¬μ© μ„¤λ…μ„
β”β”€β”€ IMPLEMENTATION_SUMMARY.md           # μ΄ νμΌ
β””β”€β”€ FORTINET_INTEGRATION_SPEC.md       # μ „μ²΄ μ‹μ¤ν… λ…μ„Έμ„
```

## π”„ λ‹¤μ λ‹¨κ³„

### μ΄μ ν™κ²½ μ μ©
1. **λ³΄μ• μ„¤μ •**: HTTPS, μΈμ¦, RBAC κµ¬μ„±
2. **λ¨λ‹ν„°λ§**: Grafana/Splunk μ—°λ™ κ°•ν™”
3. **μ•λ¦Ό μ‹μ¤ν…**: Slack/μ΄λ©”μΌ ν†µν•©
4. **λ°±μ—…/λ³µκµ¬**: μ„¤μ • λ°±μ—… λ° μ¬ν•΄ λ³µκµ¬ κ³„ν

### κΈ°λ¥ ν™•μ¥
1. **λ°°μΉ μ²λ¦¬**: μ—¬λ¬ μ •μ±… λ™μ‹ ν™•μΈ
2. **μ •μ±… μ‹λ®¬λ μ΄μ…**: μ •μ±… λ³€κ²½ μν–¥ λ¶„μ„
3. **λ¦¬ν¬ν…**: μ •μ±… μ‚¬μ© ν„ν™© λ¦¬ν¬νΈ
4. **API ν™•μ¥**: GraphQL, μ›Ήν›… μ§€μ›

---

## π‰ κµ¬ν„ μ™„λ£ μ”μ•½

**β… λ¨λ“  μ”κµ¬μ‚¬ν•­μ΄ μ„±κ³µμ μΌλ΅ κµ¬ν„λμ—μµλ‹λ‹¤!**

μ‚¬μ©μκ°€ μ”μ²­ν• **"μ‚¬μ©μμ κ³µ λ°©ν™”λ²½μ •μ±…ν™•μΈνμ΄μ§€ κµ¬ν„"**μ΄ μ™„μ „ν μ™„λ£λμ—μΌλ©°:

- π **μ›Ή κΈ°λ° μ •μ±… ν™•μΈ λ„κµ¬** κµ¬μ¶•
- π” **μ¶λ°μ§€-λ©μ μ§€ μ…λ ¥ κΈ°λ° λ¶„μ„** μ κ³µ
- β…β **μ°¨λ‹¨/ν—μ© μ—¬λ¶€ μ‹¤μ‹κ°„ νλ‹¨** κµ¬ν„
- πΆ **λ‹¤μ¤‘ μ¥λΉ„ (80+ FortiGate) μ§€μ›** μ™„λ£
- π **λ‹¤μΆ… VDOM ν™κ²½ μ§€μ›** κµ¬ν„
- π“ **μ •μ±… μ μ© μƒνƒ μƒμ„Έ ν‘μ‹** μ κ³µ

**μ„λ²„ μ‹¤ν–‰:** `npm run policy-server`
**μ›Ή μ ‘μ†:** `http://localhost:3001`
**API ν…μ¤νΈ:** `curl -X POST http://localhost:3001/api/policy/verify [...]`

π›΅οΈ **Fortinet ν†µν•© λ³΄μ• κ΄€λ¦¬μ„Όν„°μ ν•µμ‹¬ κΈ°λ¥μ΄ μ„±κ³µμ μΌλ΅ κµ¬ν„λμ—μµλ‹λ‹¤!**