#!/bin/bash
#
# Splunk Issues Diagnostic Script
# Checks Real-time search limits and JavaScript settings
#

echo "ğŸ” Splunk ë¬¸ì œ ì§„ë‹¨ (Diagnostic Report)"
echo "========================================"
echo ""

# Issue 1: Real-time Search Limit
echo "ğŸ“Š Issue 1: Real-time ê²€ìƒ‰ ì œí•œ (Search Limit)"
echo "-------------------------------------------"
echo ""
echo "í˜„ì¬ ìƒíƒœ:"
echo "  - ì œí•œ: 70ê°œ ë™ì‹œ Real-time ê²€ìƒ‰"
echo "  - ìŠ¤í‚µë¥ : 24.6% (2,031/8,265)"
echo "  - ìƒíƒœ: ğŸ”´ CRITICAL (20% ì´ˆê³¼)"
echo ""
echo "â“ ì™œ ì´ëŸ° ì¼ì´?"
echo "  â†’ 70ê°œë³´ë‹¤ ë§ì€ Real-time ê²€ìƒ‰ì´ ìŠ¤ì¼€ì¤„ë˜ì–´ ìˆìŒ"
echo "  â†’ ê²€ìƒ‰ 2ê°œ ë„ë©´ â†’ ëŒ€ê¸° ì¤‘ì¸ ë‹¤ë¥¸ ê²€ìƒ‰ì´ ìŠ¬ë¡¯ ì°¨ì§€ (í’ì„  íš¨ê³¼)"
echo ""

# Issue 2: JavaScript
echo "ğŸ“Š Issue 2: JavaScript ë¬¸ì œ"
echo "-------------------------------------------"
echo ""
echo "âŒ ì´ ë‘˜ì€ **ê´€ê³„ ì—†ìŠµë‹ˆë‹¤**:"
echo ""
echo "  Real-time ê²€ìƒ‰ ì œí•œ â‰  JavaScript ë¹„í™œì„±í™”"
echo ""
echo "  - Real-time ì œí•œ: ê²€ìƒ‰ ì‹¤í–‰ ê°œìˆ˜ ì œí•œ"
echo "  - JavaScript ë¹„í™œì„±í™”: ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥ ì œí•œ"
echo ""
echo "JavaScript ë¬¸ì œ í™•ì¸ ë°©ë²•:"
echo "  1. Splunk UI â†’ Settings â†’ Server Settings â†’ General Settings"
echo "  2. ë˜ëŠ” /opt/splunk/etc/system/local/web.conf í™•ì¸"
echo "  3. enable_javascript = false ì¸ì§€ í™•ì¸"
echo ""

# Solution
echo "ğŸ“Š í•´ê²° ë°©ë²• (Solutions)"
echo "-------------------------------------------"
echo ""
echo "ğŸ¯ Real-time ê²€ìƒ‰ ë¬¸ì œ í•´ê²°:"
echo ""
echo "1ï¸âƒ£ ê¸‰í•œ ê²½ìš° (Quick Fix):"
echo "   ./scripts/increase-realtime-limit.sh"
echo "   â†’ 70ê°œ â†’ 140ê°œë¡œ ì¦ê°€"
echo "   â†’ Splunk ì¬ì‹œì‘ í•„ìš”"
echo ""
echo "2ï¸âƒ£ ê·¼ë³¸ í•´ê²° (Proper Fix):"
echo "   ì•„ë˜ SPL ì¿¼ë¦¬ë¡œ ë²”ì¸ ì°¾ê¸°:"
echo ""
echo "   | rest /services/saved/searches"
echo "   | search is_scheduled=1 realtime_schedule=1 disabled=0"
echo "   | stats count by eai:acl.app"
echo "   | sort -count"
echo ""
echo "   ê·¸ ë‹¤ìŒ:"
echo "   - ë¶ˆí•„ìš”í•œ ê²€ìƒ‰ ë¹„í™œì„±í™”"
echo "   - Real-time â†’ Scheduled ì „í™˜ (5ë¶„ë§ˆë‹¤)"
echo ""
echo "ğŸ¯ JavaScript ë¬¸ì œ í•´ê²°:"
echo ""
echo "1ï¸âƒ£ JavaScript í™œì„±í™” í•„ìš”:"
echo "   configs/dashboards/slack-control-no-js.xml ì‚¬ìš©"
echo "   â†’ JavaScript ì—†ì´ ì‘ë™í•˜ëŠ” ë²„ì „"
echo ""
echo "2ï¸âƒ£ ë˜ëŠ” JavaScript í™œì„±í™”:"
echo "   Settings â†’ Configuration Files â†’ web.conf"
echo "   [settings]"
echo "   enable_javascript = true"
echo "   â†’ Splunk ì¬ì‹œì‘"
echo ""

echo "ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ (Next Steps)"
echo "-------------------------------------------"
echo ""
echo "1. Splunk UIì—ì„œ SPL ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì–´ë–¤ ì•±ì´ Real-time ê²€ìƒ‰ ë§ì´ ë§Œë“œëŠ”ì§€ í™•ì¸"
echo "2. ê²°ê³¼ ë³´ê³  â†’ 70ê°œ ì´ˆê³¼ë©´ ì¦ê°€ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰"
echo "3. JavaScript ë¬¸ì œëŠ” ë³„ë„ë¡œ web.conf í™•ì¸"
echo ""
